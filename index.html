<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">

<!-- ════ SEO META TAGS ════ -->
<title>Gokurakugai Community · Discord Hub &amp; Fan Site</title>
<meta name="description" content="A fan-run wiki and Discord community dedicated to Gokurakugai — the action-supernatural manga by Yuto Sano.">
<meta name="keywords" content="Gokurakugai, 極楽街, manga, Yuto Sano, Jump SQ, Gokurakugai community, Gokurakugai Discord, Gokurakugai server, Gokurakugai Discord Server, Gokurakugai anime, Gokurakugai manga, Gokurakugai anime manga fans">
<meta name="robots" content="index, follow">
<meta name="author" content="Gokurakugai Fan Community">
<link rel="canonical" href="https://paradise-district.github.io/gokurakugai/">

<!-- ════ OPEN GRAPH ════ -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://paradise-district.github.io/gokurakugai/">
<meta property="og:title" content="Gokurakugai Community · Discord Hub &amp; Fan Site">
<meta property="og:description" content="A fan-run wiki and Discord community dedicated to Gokurakugai — the action-supernatural manga by Yuto Sano.">
<meta property="og:image" content="https://paradise-district.github.io/gokurakugai/assets/images/og-image.jpg">
<meta property="og:site_name" content="Gokurakugai Community">
<meta property="og:locale" content="en_US">

<!-- ════ TWITTER CARD ════ -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Gokurakugai Community · Discord Hub &amp; Fan Site">
<meta name="twitter:description" content="Fan-run Gokurakugai community and Discord hub. News, releases, countdowns, and resources">
<meta name="twitter:image" content="https://paradise-district.github.io/gokurakugai/assets/images/og-image.jpg">

<!-- ════ FAVICONS ════ -->
<link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16.png">
<link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32.png">
<link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/favicon-180.png">

<!-- ════ STRUCTURED DATA ════ -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"WebSite",
  "name":"Gokurakugai Community",
  "url":"https://paradise-district.github.io/gokurakugai/",
  "description":"A fan-run wiki and Discord community dedicated to Gokurakugai — the action-supernatural manga by Yuto Sano.",
  "potentialAction":{
    "@type":"SearchAction",
    "target":"https://paradise-district.github.io/gokurakugai/?q={search_term_string}",
    "query-input":"required name=search_term_string"
  }
}
</script>

<link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Cinzel:wght@400;600;700;900&family=Crimson+Pro:ital,wght@0,300;0,400;0,600;1,300;1,400&display=swap" rel="stylesheet">
<style>
/* ════════════════════════════════════════
   VARIABLES
════════════════════════════════════════ */
:root{
  --crimson:#8B1A1A;--crimson-deep:#5C0F0F;--crimson-bright:#C0272D;
  --gold:#C9A84C;--gold-light:#E8C96A;
}
[data-theme="dark"]{
  --bg:#0A0303;--bg2:#130808;--surface:#1A0808;--surface2:#220D0D;--surface3:#2C1010;
  --text:#F0DFC0;--text-dim:#A08060;--text-muted:#6B4A30;
  --accent:var(--gold);--accent2:var(--gold-light);
  --border-img:url('assets/images/light-border.png');
  --pattern:url('assets/images/pattern-dark.png');
  --header-bg:url('assets/images/header-bg-dark.jpg');
  --nav-bg:rgba(10,3,3,0.97);
  --card-bg:rgba(26,8,8,0.93);
  --glow:0 0 18px rgba(201,168,76,0.3);
  --glow2:0 0 35px rgba(201,168,76,0.14);
  --hr:rgba(201,168,76,0.22);
  --modal-bg:rgba(0,0,0,0.9);
  --in-bg:#180606;--in-border:rgba(201,168,76,0.28);
  --tag-bg:rgba(201,168,76,0.1);
  --disc:var(--accent);
}
[data-theme="light"]{
  --bg:#FFF5E8;--bg2:#FAE8D0;--surface:#FFF0E0;--surface2:#FAE5CE;--surface3:#F5D8B8;
  --text:#1A0505;--text-dim:#5C2020;--text-muted:#8B3A3A;
  --accent:var(--crimson);--accent2:var(--crimson-bright);
  --border-img:url('assets/images/dark-border.png');
  --pattern:url('assets/images/pattern-light.png');
  --header-bg:url('assets/images/header-bg-light.jpg');
  --nav-bg:rgba(255,245,232,0.97);
  --card-bg:rgba(255,240,224,0.93);
  --glow:0 0 18px rgba(139,26,26,0.2);
  --glow2:0 0 35px rgba(139,26,26,0.1);
  --hr:rgba(139,26,26,0.22);
  --modal-bg:rgba(40,5,5,0.87);
  --in-bg:#FFF8F0;--in-border:rgba(139,26,26,0.28);
  --tag-bg:rgba(139,26,26,0.08);
  --disc:var(--accent);
}

/* ════════════════════════════════════════
   BASE
════════════════════════════════════════ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
body{font-family:'Crimson Pro',Georgia,serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;transition:background .4s,color .4s;}
body::before{content:'';position:fixed;inset:0;background:var(--pattern);background-size:80px 80px;opacity:.055;pointer-events:none;z-index:0;}
::-webkit-scrollbar{width:5px;}
::-webkit-scrollbar-track{background:var(--bg2);}
::-webkit-scrollbar-thumb{background:var(--accent);border-radius:3px;}
a{color:inherit;text-decoration:none;}
img{max-width:100%;}
p{line-height:1.8;}

/* ════════════════════════════════════════
   SVG ICON SYSTEM
════════════════════════════════════════ */
.icon{width:1.2em;height:1.2em;stroke:currentColor;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;display:inline-block;vertical-align:middle;flex-shrink:0;}
.icon-fill{fill:currentColor;stroke:none;}
.icon-sm{width:.9em;height:.9em;}
.icon-md{width:1.5rem;height:1.5rem;}
.icon-lg{width:2rem;height:2rem;}
.icon-xl{width:2.4rem;height:2.4rem;}
.icon-accent{color:var(--accent);}

/* ════════════════════════════════════════
   COUNTDOWN
════════════════════════════════════════ */
#cd-bar{
  position:sticky;top:0;z-index:101;
  background:linear-gradient(110deg,#3a0a0a,var(--crimson-deep) 40%,var(--crimson) 80%,#3a0a0a);
  color:#fff;text-align:center;padding:.5rem 1rem;
  display:flex;align-items:center;justify-content:center;gap:1rem;flex-wrap:wrap;
  box-shadow:0 2px 12px rgba(0,0,0,.5);
}
#cd-bar.hidden{display:none;}
.cd-label{font-family:'Cinzel',serif;font-size:.65rem;letter-spacing:.22em;opacity:.8;white-space:nowrap;}
.cd-units{display:flex;gap:.6rem;align-items:center;}
.cd-unit{display:flex;flex-direction:column;align-items:center;min-width:38px;}
.cd-n{font-family:'Cinzel',serif;font-size:1.25rem;font-weight:700;line-height:1;text-shadow:0 0 10px rgba(255,255,255,.35);}
.cd-t{font-size:.5rem;letter-spacing:.15em;opacity:.65;text-transform:uppercase;margin-top:.1rem;}
.cd-sep{font-size:1rem;opacity:.45;margin-bottom:.25rem;}
.cd-ev{font-family:'Cinzel',serif;font-size:.68rem;letter-spacing:.14em;opacity:.88;white-space:nowrap;}
.cd-x{cursor:pointer;opacity:.55;font-size:.75rem;padding:.2rem .45rem;background:rgba(255,255,255,.14);border:none;color:#fff;border-radius:2px;transition:opacity .2s;flex-shrink:0;display:flex;align-items:center;justify-content:center;}
.cd-x:hover{opacity:1;}

/* ════════════════════════════════════════
   HEADER
════════════════════════════════════════ */
#hdr{
  position:relative;width:100%;min-height:310px;
  background:var(--header-bg) center/cover no-repeat;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  overflow:hidden;z-index:1;
}
#hdr::before{
  content:'';position:absolute;inset:0;z-index:1;
  background:linear-gradient(to bottom,rgba(4,0,0,.52) 0%,rgba(4,0,0,.18) 45%,rgba(4,0,0,.72) 100%);
}
[data-theme="light"] #hdr::before{background:linear-gradient(to bottom,rgba(255,240,220,.45) 0%,rgba(255,240,220,.1) 45%,rgba(255,240,220,.62) 100%);}
.hdr-inner{position:relative;z-index:2;text-align:center;padding:1.5rem 1rem;}
.glitch-wrap{position:relative;display:inline-block;cursor:pointer;height:75px;min-width:260px;}
.logo-en-gl,.logo-jp-gl{max-height:82px;width:auto;display:block;position:absolute;top:0;left:50%;transform:translateX(-50%);filter:drop-shadow(0 0 11px var(--accent));}
.logo-jp-gl{opacity:0;}
.gl-r,.gl-b{position:absolute;top:0;left:50%;transform:translateX(-50%);pointer-events:none;}
.gl-r img,.gl-b img{max-height:82px;width:auto;display:block;opacity:0;position:relative;}
.logo-en-gl{animation:enShow 8s steps(1) infinite;}
.logo-jp-gl{animation:jpShow 8s steps(1) infinite;}
.gl-r img{animation:glR2 8s steps(1) infinite;filter:hue-rotate(175deg) saturate(2.5) drop-shadow(3px 0 0 #ff003c);}
.gl-b img{animation:glB2 8s steps(1) infinite;filter:hue-rotate(-50deg) saturate(2.5) drop-shadow(-3px 0 0 #00a8ff);}
@keyframes enShow{0%,74.9%{opacity:1;}75%,89.9%{opacity:0;}90%,100%{opacity:1;}}
@keyframes jpShow{0%,77.9%{opacity:0;}78%,87.9%{opacity:1;}88%,100%{opacity:0;}}
@keyframes glR2{0%,74.9%,77.9%,89.9%,100%{opacity:0;clip-path:inset(100% 0 0 0);}75%{opacity:.85;clip-path:inset(8% 0 68% 0);transform:translateX(-4px);}75.5%{opacity:.85;clip-path:inset(45% 0 38% 0);transform:translateX(4px);}76%{opacity:.85;clip-path:inset(72% 0 12% 0);transform:translateX(-2px);}77%{opacity:0;}88%{opacity:.85;clip-path:inset(15% 0 62% 0);transform:translateX(4px);}88.5%{opacity:.85;clip-path:inset(55% 0 22% 0);transform:translateX(-4px);}89%{opacity:0;}}
@keyframes glB2{0%,74.9%,77.9%,89.9%,100%{opacity:0;clip-path:inset(100% 0 0 0);}75%{opacity:.85;clip-path:inset(72% 0 12% 0);transform:translateX(4px);}75.5%{opacity:.85;clip-path:inset(38% 0 45% 0);transform:translateX(-4px);}76%{opacity:.85;clip-path:inset(8% 0 68% 0);transform:translateX(2px);}77%{opacity:0;}88%{opacity:.85;clip-path:inset(62% 0 15% 0);transform:translateX(-4px);}88.5%{opacity:.85;clip-path:inset(22% 0 55% 0);transform:translateX(4px);}89%{opacity:0;}}
@media(max-width:768px){.glitch-wrap{height:62px;min-width:200px;}.logo-en-gl,.logo-jp-gl,.gl-r img,.gl-b img{max-height:62px;}}
.hdr-tag{font-family:'Cinzel',serif;font-size:.68rem;letter-spacing:.38em;color:var(--accent);text-transform:uppercase;margin-top:.65rem;opacity:.88;}

/* ════════════════════════════════════════
   NAV
════════════════════════════════════════ */
#nav{
  position:sticky;top:0;z-index:100;
  background:var(--nav-bg);border-bottom:1px solid var(--accent);
  backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px);
  box-shadow:0 2px 22px rgba(0,0,0,.38),var(--glow);
}
.nav-in{max-width:1200px;margin:0 auto;display:flex;align-items:stretch;justify-content:space-between;padding:0 .8rem;}
.nav-tabs{display:flex;list-style:none;overflow-x:auto;scrollbar-width:none;flex-shrink:1;min-width:0;}
.nav-tabs::-webkit-scrollbar{display:none;}
.nav-tabs li{position:relative;flex-shrink:0;}
.nav-tabs li>a,.nav-tabs li>button{display:flex;align-items:center;gap:.22rem;padding:.82rem .82rem;font-family:'Cinzel',serif;font-size:.64rem;font-weight:600;letter-spacing:.09em;text-transform:uppercase;color:var(--text-dim);cursor:pointer;background:none;border:none;border-bottom:3px solid transparent;transition:all .2s;white-space:nowrap;text-decoration:none;}
.nav-tabs li>a:hover,.nav-tabs li>button:hover{color:var(--accent);border-bottom-color:var(--accent);}
.nav-tabs li>a.active,.nav-tabs li>button.active{color:var(--accent2);border-bottom-color:var(--accent2);}
.da{font-size:.5rem;transition:transform .2s;}
.has-dd:hover .da{transform:rotate(180deg);}
.dd-menu{position:absolute;top:100%;left:50%;transform:translateX(-50%);background:var(--surface);border:1px solid var(--accent);border-top:none;min-width:150px;box-shadow:0 8px 24px rgba(0,0,0,.42);display:none;z-index:200;}
.has-dd:hover .dd-menu{display:block;}
.dd-menu a{display:block;padding:.58rem .95rem;font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.09em;text-transform:uppercase;color:var(--text-dim);text-decoration:none;transition:all .14s;border-bottom:1px solid var(--hr);}
.dd-menu a:last-child{border-bottom:none;}
.dd-menu a:hover{background:var(--surface2);color:var(--accent);padding-left:1.25rem;}
.dd-menu a.active{color:var(--accent2);background:var(--surface2);}
.nav-ctrl{display:flex;align-items:center;gap:.45rem;padding-left:.4rem;flex-shrink:0;}
.tt{display:flex;align-items:center;gap:.35rem;}
.tt-track{position:relative;width:38px;height:19px;background:var(--surface2);border-radius:10px;border:1px solid var(--accent);cursor:pointer;flex-shrink:0;}
.tt-thumb{position:absolute;top:2px;left:2px;width:13px;height:13px;background:var(--accent);border-radius:50%;transition:transform .3s;box-shadow:0 0 5px var(--accent);}
[data-theme="light"] .tt-thumb{transform:translateX(19px);}
.tt-icon{font-size:.78rem;color:var(--accent);display:flex;align-items:center;}
.dc-zone{position:relative;}
#dc-login-btn{display:flex;align-items:center;gap:.4rem;padding:.38rem .72rem;font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.09em;text-transform:uppercase;background:var(--accent);color:var(--bg);border:none;cursor:pointer;border-radius:3px;transition:opacity .2s;white-space:nowrap;}
#dc-login-btn:hover{opacity:.83;}
#dc-login-btn svg{width:15px;height:15px;flex-shrink:0;}
#dc-user-wrap{display:none;position:relative;}
.dc-btn{display:flex;align-items:center;gap:.42rem;padding:.28rem .55rem;background:var(--surface2);border:1px solid var(--hr);border-radius:4px;cursor:pointer;transition:border-color .2s;}
.dc-btn:hover{border-color:var(--accent);}
.dc-av{width:24px;height:24px;border-radius:50%;border:1px solid var(--accent);object-fit:cover;flex-shrink:0;}
.dc-av-ph{width:24px;height:24px;border-radius:50%;background:var(--accent);display:flex;align-items:center;justify-content:center;color:#fff;font-size:.62rem;font-family:'Cinzel',serif;flex-shrink:0;}
.dc-uname{font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.05em;color:var(--text);max-width:85px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.dc-dot{width:7px;height:7px;background:#57F287;border-radius:50%;flex-shrink:0;box-shadow:0 0 5px #57F287;}

/* ── Mini glass popout dropdown ───────────────────────── */
.dc-dd{
  position:absolute;top:calc(100% + 8px);right:0;width:160px;z-index:400;display:none;
  background:var(--dd-bg, rgba(14,7,7,.86));
  backdrop-filter:blur(24px) saturate(1.6);
  -webkit-backdrop-filter:blur(24px) saturate(1.6);
  border:1px solid var(--hr);
  border-radius:7px;
  box-shadow:0 16px 48px rgba(0,0,0,.7),0 0 0 1px rgba(255,255,255,.04) inset;
  overflow:hidden;
}
[data-theme="light"] .dc-dd{background:rgba(255,245,232,.92);box-shadow:0 12px 40px rgba(80,10,10,.18);}
.dc-dd.open{display:block;animation:fadeUp .16s ease;}
.dc-dd.drop-up{top:auto;bottom:calc(100% + 8px);}
.dc-dd.drop-up.open{animation:fadeDown .16s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(5px);}to{opacity:1;transform:translateY(0);}}
@keyframes fadeDown{from{opacity:0;transform:translateY(-5px);}to{opacity:1;transform:translateY(0);}}
.dc-dd-item{
  display:flex;align-items:center;gap:.6rem;width:100%;padding:.7rem 1rem;
  background:none;border:none;text-align:left;cursor:pointer;
  font-family:'Cinzel',serif;font-size:.66rem;letter-spacing:.1em;text-transform:uppercase;
  color:var(--text-dim);transition:background .14s,color .14s;box-sizing:border-box;
}
.dc-dd-item:hover{background:rgba(201,168,76,.1);color:var(--accent);}
[data-theme="light"] .dc-dd-item:hover{background:rgba(139,26,26,.07);}
.dc-dd-item svg{width:14px;height:14px;flex-shrink:0;opacity:.65;}
.dc-dd-sep{height:1px;background:var(--hr);margin:0;}
.dc-dd-item.dc-out{color:rgba(220,80,80,.9);}
.dc-dd-item.dc-out:hover{background:rgba(192,39,45,.12);color:#f87171;}
[data-theme="light"] .dc-dd-item.dc-out{color:#b91c1c;}
[data-theme="light"] .dc-dd-item.dc-out:hover{background:rgba(192,39,45,.08);color:#991b1b;}

/* ── Profile modal overlay — must be at body level to escape nav's
   backdrop-filter stacking context (which traps position:fixed children) */
#prof-ov{
  position:fixed;inset:0;z-index:9999;
  display:none;align-items:center;justify-content:center;
  background:rgba(0,0,0,.75);
  backdrop-filter:blur(18px) saturate(1.5);
  -webkit-backdrop-filter:blur(18px) saturate(1.5);
  padding:1rem;box-sizing:border-box;
}
[data-theme="light"] #prof-ov{background:rgba(15,3,3,.62);}
#prof-ov.open{display:flex;animation:ovFade .22s ease;}
@keyframes ovFade{from{opacity:0;}to{opacity:1;}}

/* ── Profile modal card ───────────────────────────────── */
#prof-modal{
  width:min(440px,96vw);
  max-height:min(88vh,700px);
  overflow-y:auto;
  margin:auto;
  flex-shrink:0;
  background:var(--surface);
  border:1px solid var(--hr);
  border-radius:12px;
  box-shadow:0 28px 80px rgba(0,0,0,.85),0 0 0 1px rgba(201,168,76,.08) inset;
  position:relative;
  animation:modalPop .24s cubic-bezier(.22,.61,.36,1);
}
[data-theme="light"] #prof-modal{
  background:var(--surface);
  border-color:rgba(139,26,26,.2);
  box-shadow:0 24px 72px rgba(80,10,10,.22);
}
@keyframes modalPop{from{opacity:0;transform:scale(.94) translateY(14px);}to{opacity:1;transform:none;}}
#prof-modal::-webkit-scrollbar{width:4px;}
#prof-modal::-webkit-scrollbar-thumb{background:var(--accent);border-radius:2px;}

/* Banner */
.pm-banner{height:180px;background:linear-gradient(135deg,var(--crimson-deep) 0%,var(--crimson) 55%,#1a0303 100%);position:relative;overflow:hidden;}
[data-theme="light"] .pm-banner{background:linear-gradient(135deg,#7a0e0e 0%,var(--crimson) 55%,#4a0808 100%);}
.pm-banner-img{width:100%;height:100%;object-fit:cover;position:absolute;inset:0;display:none;}
.pm-banner-loading{width:100%;height:100%;background:var(--surface2);position:absolute;inset:0;display:flex;align-items:center;justify-content:center;}
.pm-banner-loading::after{content:'';width:22px;height:22px;border:2px solid var(--hr);border-top-color:var(--accent);border-radius:50%;animation:spin .7s linear infinite;}
.pm-banner-fallback{width:100%;height:100%;position:absolute;inset:0;background:var(--header-bg) center/cover no-repeat;display:none;align-items:center;justify-content:center;}
.pm-banner-fallback::before{content:'';position:absolute;inset:0;backdrop-filter:blur(10px) saturate(1.3);-webkit-backdrop-filter:blur(10px) saturate(1.3);background:rgba(0,0,0,.48);}
[data-theme="light"] .pm-banner-fallback::before{background:rgba(255,240,220,.55);}
.pm-banner-nobanner{position:relative;z-index:1;font-family:'Cinzel',serif;font-size:.58rem;letter-spacing:.26em;color:rgba(255,255,255,.38);text-transform:uppercase;border:1px solid rgba(255,255,255,.14);padding:.3rem .85rem;border-radius:3px;}
[data-theme="light"] .pm-banner-nobanner{color:rgba(0,0,0,.3);border-color:rgba(0,0,0,.15);}
.pm-close{
  position:absolute;top:.65rem;right:.7rem;z-index:10;
  background:rgba(0,0,0,.5);border:none;color:#fff;
  cursor:pointer;border-radius:50%;width:28px;height:28px;
  display:flex;align-items:center;justify-content:center;
  font-size:.85rem;line-height:1;transition:background .15s;
}
.pm-close:hover{background:rgba(192,39,45,.75);}

/* Avatar zone */
.pm-av-zone{
  display:flex;align-items:flex-end;justify-content:space-between;
  padding:0 1.5rem;margin-top:-44px;margin-bottom:.75rem;
  position:relative;z-index:1;
}
.pm-av-wrap{position:relative;flex-shrink:0;}
.pm-av{
  width:88px;height:88px;border-radius:50%;
  background:var(--surface2);
  border:5px solid var(--surface);
  overflow:hidden;display:flex;align-items:center;justify-content:center;
  font-family:'Cinzel',serif;font-size:2rem;color:var(--accent);
  box-shadow:0 4px 20px rgba(0,0,0,.45);
}
[data-theme="light"] .pm-av{border-color:var(--surface);box-shadow:0 4px 18px rgba(80,10,10,.18);}
.pm-av img{width:100%;height:100%;object-fit:cover;}
.pm-av-dot{
  position:absolute;bottom:5px;right:5px;
  width:18px;height:18px;border-radius:50%;
  background:#57F287;border:3px solid var(--surface);
  box-shadow:0 0 8px rgba(87,242,135,.6);display:none;
}

/* Member badge (top-right of av-zone) */
.pm-member-badge{
  align-self:flex-start;margin-top:10px;
  font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.09em;
  padding:.3rem .8rem;border-radius:20px;display:inline-flex;align-items:center;gap:.35rem;
  font-weight:600;
}
.pm-badge-yes{
  background:rgba(87,242,135,.12);color:#4ade80;
  border:1px solid rgba(87,242,135,.35);
}
[data-theme="light"] .pm-badge-yes{background:rgba(22,163,74,.1);color:#15803d;border-color:rgba(22,163,74,.35);}
.pm-badge-no{
  background:rgba(239,68,68,.1);color:#f87171;
  border:1px solid rgba(239,68,68,.3);
}
[data-theme="light"] .pm-badge-no{background:rgba(185,28,28,.09);color:#b91c1c;border-color:rgba(185,28,28,.3);}

/* Name block */
.pm-body{padding:.2rem 1.5rem 0;}
.pm-displayname{
  font-family:'Cinzel',serif;font-size:1.2rem;font-weight:700;
  color:var(--text);letter-spacing:.04em;margin-bottom:.2rem;line-height:1.2;
}
.pm-sub{
  font-size:.8rem;color:var(--text-muted);
  display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;
  margin-bottom:1.1rem;
}
.pm-uid{
  font-family:monospace;font-size:.72rem;color:var(--text-muted);
  background:var(--surface2);padding:.1rem .38rem;border-radius:3px;
  border:1px solid var(--hr);
}
[data-theme="light"] .pm-uid{background:var(--surface3);}

/* Info rows */
.pm-divider{height:1px;background:var(--hr);margin:.9rem 0;}
.pm-info-grid{display:flex;flex-direction:column;gap:.85rem;padding-bottom:.2rem;}
.pm-info-row{}
.pm-info-label{
  font-family:'Cinzel',serif;font-size:.56rem;letter-spacing:.18em;
  color:var(--text-muted);text-transform:uppercase;margin-bottom:.22rem;
}
.pm-info-val{font-size:.87rem;color:var(--text-dim);line-height:1.45;}
[data-theme="light"] .pm-info-val{color:var(--text-dim);}

/* Role pills */
.pm-roles-wrap{display:flex;flex-wrap:wrap;gap:.38rem;margin-top:.25rem;}
.pm-role-pill{
  font-size:.68rem;font-weight:600;padding:.24rem .62rem;border-radius:4px;
  letter-spacing:.03em;display:inline-flex;align-items:center;gap:.3rem;
  font-family:'Cinzel',serif;
}
.pm-role-pill::before{
  content:'';display:inline-block;width:9px;height:9px;
  border-radius:50%;background:currentColor;opacity:.85;flex-shrink:0;
}

/* Footer */
.pm-footer{
  border-top:1px solid var(--hr);margin-top:1.2rem;
  padding:.85rem 1.5rem;display:flex;justify-content:flex-start;
}
.pm-logout-btn{
  display:flex;align-items:center;gap:.48rem;
  font-family:'Cinzel',serif;font-size:.68rem;letter-spacing:.12em;text-transform:uppercase;
  color:#fff;background:#1a0808;
  border:1px solid rgba(255,255,255,.1);border-radius:6px;
  padding:.54rem 1.15rem;cursor:pointer;transition:all .18s;
}
.pm-logout-btn:hover{background:#2d0c0c;border-color:rgba(239,68,68,.45);color:#fca5a5;}
[data-theme="light"] .pm-logout-btn{color:#fff;background:#1a0505;border-color:rgba(0,0,0,.18);}
[data-theme="light"] .pm-logout-btn:hover{background:#2d0808;border-color:#b91c1c;}


/* ════════════════════════════════════════
   FOOTER
════════════════════════════════════════ */
#ft{background:var(--tag-bg);border-top:2px solid var(--accent);padding:2.8rem 1.5rem 0;}
.ft-grid{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:1.2fr 1fr 0.8fr 1fr;gap:2.5rem;padding-bottom:2.2rem;}
@media(max-width:760px){.ft-grid{grid-template-columns:1fr 1fr;}}
@media(max-width:460px){.ft-grid{grid-template-columns:1fr;}}
.ft-col-title{font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.18em;color:var(--accent);text-transform:uppercase;margin-bottom:1rem;font-weight:700;}
.ft-col-brand{font-family:'Cinzel',serif;font-size:.88rem;color:var(--accent);letter-spacing:.1em;font-weight:700;margin-bottom:.7rem;}
.ft-col-desc{font-size:.85rem;color:var(--text-muted);line-height:1.72;max-width:220px;}
.ft-col ul{list-style:none;}
.ft-col ul li{margin-bottom:.48rem;}
.ft-col ul a{font-size:.85rem;color:var(--text-muted);transition:color .18s;display:flex;align-items:center;gap:.38rem;}
.ft-col ul a::before{content:'↗';font-size:.62rem;opacity:.45;}
.ft-col ul a:hover{color:var(--accent);}
.ft-disc-label{font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.18em;color:var(--accent);text-transform:uppercase;margin-bottom:.6rem;font-weight:700;}
.ft-disc-btn{display:inline-flex;align-items:center;gap:.5rem;background:var(--accent);color:var(--bg);font-family:'Cinzel',serif;font-size:.72rem;letter-spacing:.09em;padding:.55rem 1rem;cursor:pointer;text-decoration:none;transition:background .2s,transform .15s;}
.ft-disc-btn:hover{background:var(--accent);transform:translateY(-1px);}
.ft-divider{max-width:1100px;margin:0 auto;height:1px;background:rgba(255,255,255,.07);}
.ft-bottom{max-width:1100px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:.85rem 0;flex-wrap:wrap;gap:.4rem;}
.ft-copy{font-size:.76rem;color:var(--text-muted);}
.ft-rights{font-size:.76rem;color:var(--text-muted);}

/* ════ Discord widget ════ */
.dc-wgt-v2{background:var(--surface);border:1px solid var(--accent);padding:1.2rem 1.5rem;margin-bottom:1.5rem;display:flex;align-items:center;gap:1.2rem;flex-wrap:wrap;}
.dc-wgt-v2-left{flex:1;min-width:170px;}
.dc-wgt-v2-title{font-family:'Cinzel',serif;font-size:.82rem;color:var(--accent);letter-spacing:.1em;margin-bottom:.32rem;}
.dc-wgt-v2-count{display:flex;align-items:center;gap:.45rem;font-size:.93rem;color:var(--text-dim);}
.dc-wgt-v2-count .od{width:9px;height:9px;border-radius:50%;background:#57F287;flex-shrink:0;animation:pulse 2s ease-in-out infinite;}
@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(87,242,135,.5);}50%{box-shadow:0 0 0 5px rgba(87,242,135,0);}}

/* ════════════════════════════════════════
   MAIN CONTENT
════════════════════════════════════════ */
#content{position:relative;z-index:1;max-width:1100px;margin:0 auto;padding:2.8rem 1.5rem 6rem;}
.sec{display:none;}
.sec.active{display:block;animation:fi .32s ease;}
.subsec{display:none;}
.subsec.active{display:block;animation:fi .32s ease;}
@keyframes fi{from{opacity:0;transform:translateY(9px);}to{opacity:1;transform:translateY(0);}}

/* ════════════════════════════════════════
   TYPOGRAPHY
════════════════════════════════════════ */
.sec-hdr{text-align:center;padding:2rem 1rem 1.6rem;margin-bottom:.5rem;}
.sec-hdr .jp{font-family:'Ma Shan Zheng',serif;font-size:2.2rem;color:var(--accent);display:block;margin-bottom:.15rem;letter-spacing:.05em;line-height:1.1;}
.sec-hdr .en{font-family:'Cinzel',serif;font-size:1.42rem;font-weight:700;letter-spacing:.14em;color:var(--text);display:block;}
.sec-hdr .sub{font-size:.97rem;color:var(--text-dim);max-width:560px;margin:.7rem auto 0;line-height:1.7;}
.st{font-family:'Cinzel',serif;font-size:1.2rem;font-weight:700;color:var(--accent);text-align:center;letter-spacing:.14em;margin-bottom:.25rem;}
.st-jp{font-family:'Ma Shan Zheng',serif;font-size:.9rem;color:var(--text-muted);text-align:center;letter-spacing:.28em;margin-bottom:1.5rem;}
.sdiv{display:flex;align-items:center;gap:.9rem;margin-bottom:1.8rem;}
.sdiv::before,.sdiv::after{content:'';flex:1;height:1px;background:linear-gradient(to right,transparent,var(--accent),transparent);}
.sdiv span{font-family:'Ma Shan Zheng',serif;font-size:1.2rem;color:var(--accent);}
.orn{display:flex;align-items:center;gap:.9rem;margin:1.8rem 0;color:var(--accent);font-family:'Ma Shan Zheng',serif;font-size:1.05rem;}
.orn::before,.orn::after{content:'';flex:1;height:1px;background:var(--accent);opacity:.3;}

/* ════════════════════════════════════════
   BUTTONS
════════════════════════════════════════ */
.btn{display:inline-flex;align-items:center;gap:.38rem;padding:.52rem 1rem;font-family:'Cinzel',serif;font-size:.65rem;letter-spacing:.11em;text-transform:uppercase;border:1px solid var(--accent);color:var(--accent);background:transparent;cursor:pointer;transition:all .2s;}
.btn:hover{background:var(--accent);color:var(--bg);box-shadow:var(--glow);}
.btn-p{background:var(--accent);color:var(--bg);}
.btn-p:hover{background:var(--accent2);border-color:var(--accent2);}
.btn-sm{padding:.32rem .65rem;font-size:.58rem;}
.btn-dc{background:var(--accent);border-color:var(--accent);color:var(--bg);}
.btn-dc:hover{background:var(--accent);border-color:var(--accent);color:var(--bg);}
.subnav{display:flex;gap:.45rem;margin-bottom:2rem;justify-content:center;flex-wrap:wrap;}
.sn-btn{padding:.45rem .95rem;font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.09em;text-transform:uppercase;border:1px solid var(--hr);color:var(--text-dim);background:transparent;cursor:pointer;transition:all .2s;}
.sn-btn:hover{border-color:var(--accent);color:var(--accent);}
.sn-btn.active{border-color:var(--accent);color:var(--accent);background:var(--tag-bg);}

/* ════════════════════════════════════════
   CARDS
════════════════════════════════════════ */
.card{background:var(--surface);border:1px solid var(--hr);padding:1.4rem;transition:border-color .22s;}
.card:hover{border-color:var(--accent);}
.fbox{position:relative;border:1px solid var(--accent);background:var(--card-bg);padding:1.7rem;}
.fbox::before{content:'';position:absolute;top:4px;left:4px;right:4px;bottom:4px;border:1px solid var(--accent);opacity:.18;pointer-events:none;}
.igrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.85rem;margin-top:1.6rem;}
.ic{background:var(--surface);border:1px solid var(--hr);padding:1rem;text-align:center;transition:all .2s;}
.ic:hover{border-color:var(--accent);transform:translateY(-2px);box-shadow:var(--glow);}
.ic .icl{font-family:'Cinzel',serif;font-size:.58rem;letter-spacing:.18em;color:var(--text-muted);text-transform:uppercase;margin-bottom:.28rem;}
.ic .icv{font-size:.95rem;font-weight:600;color:var(--accent);}
.qlinks{display:flex;flex-wrap:wrap;gap:.65rem;margin-top:1.6rem;justify-content:center;}

/* ════════════════════════════════════════
   ABOUT
════════════════════════════════════════ */
.about-g{display:grid;grid-template-columns:1fr 1fr;gap:2.2rem;align-items:start;margin-bottom:2.2rem;}
@media(max-width:680px){.about-g{grid-template-columns:1fr;}}
.about-text .lead{font-size:1.18rem;font-style:italic;color:var(--text-dim);border-left:3px solid var(--accent);padding-left:.95rem;margin-bottom:1.2rem;}
.about-text p{font-size:1.02rem;line-height:1.85;margin-bottom:.9rem;}
.synopsis h3{font-family:'Cinzel',serif;font-size:.75rem;letter-spacing:.18em;color:var(--accent);margin-bottom:.65rem;}
.synopsis p{font-size:.98rem;line-height:1.8;font-style:italic;}

/* ════════════════════════════════════════
   NEWS
════════════════════════════════════════ */
.nc{display:grid;grid-template-columns:72px 1fr;gap:1.1rem;background:var(--surface);border:1px solid var(--hr);padding:1.2rem;transition:all .22s;cursor:default;}
.nc:hover{border-color:var(--accent);box-shadow:var(--glow2);}
.nc-date{display:flex;flex-direction:column;align-items:center;gap:.1rem;padding-top:.15rem;}
.nc-d{font-family:'Cinzel',serif;font-size:1.5rem;font-weight:700;color:var(--accent);line-height:1;}
.nc-m{font-family:'Cinzel',serif;font-size:.55rem;letter-spacing:.14em;color:var(--text-muted);text-transform:uppercase;}
.nc-y{font-size:.68rem;color:var(--text-muted);}
.nc-cat{display:inline-block;padding:.12rem .45rem;border:1px solid var(--accent);font-family:'Cinzel',serif;font-size:.55rem;letter-spacing:.08em;color:var(--accent);margin-bottom:.42rem;}
.nc-title{font-family:'Cinzel',serif;font-size:.95rem;color:var(--text);margin-bottom:.42rem;letter-spacing:.04em;}
.nc-exc{font-size:.93rem;line-height:1.68;color:var(--text-dim);}
.nc-meta{display:flex;gap:.9rem;margin-top:.6rem;font-size:.76rem;color:var(--text-muted);}
@media(max-width:440px){.nc{grid-template-columns:55px 1fr;gap:.7rem;padding:.9rem;}.nc-d{font-size:1.2rem;}}
.art-card{background:var(--surface);border:1px solid var(--hr);margin-bottom:1.2rem;overflow:hidden;transition:border-color .22s;}
.art-card:hover{border-color:var(--accent);}
.art-card-body{padding:1.3rem;}
.art-cat{display:inline-block;padding:.12rem .45rem;border:1px solid var(--accent);font-family:'Cinzel',serif;font-size:.55rem;letter-spacing:.08em;color:var(--accent);margin-bottom:.42rem;}
.art-title{font-family:'Cinzel',serif;font-size:1.05rem;color:var(--text);margin-bottom:.5rem;letter-spacing:.04em;}
.art-meta{font-size:.78rem;color:var(--text-muted);margin-bottom:.7rem;}
.art-body{font-size:.97rem;line-height:1.78;color:var(--text-dim);}
.post-box{background:var(--surface);border:1px solid var(--accent);padding:1.4rem;margin-bottom:1.8rem;}
.post-box label{display:block;font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.14em;color:var(--accent);margin-bottom:.38rem;text-transform:uppercase;}
.post-box select,.post-box textarea,.post-box input{width:100%;background:var(--in-bg);border:1px solid var(--in-border);color:var(--text);font-family:'Crimson Pro',serif;font-size:1rem;padding:.65rem .88rem;transition:border-color .2s;}
.post-box select:focus,.post-box textarea:focus,.post-box input:focus{outline:none;border-color:var(--accent);}
.post-box textarea{min-height:95px;resize:vertical;}
.post-box .fr{margin-bottom:.95rem;}
.post-box select{appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='11' height='7'%3E%3Cpath d='M1 1l4.5 4.5L10 1' stroke='%23C9A84C' fill='none' stroke-width='1.5'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .9rem center;}
[data-theme="light"] .post-box select{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='11' height='7'%3E%3Cpath d='M1 1l4.5 4.5L10 1' stroke='%238B1A1A' fill='none' stroke-width='1.5'/%3E%3C/svg%3E");}
.dp{background:var(--surface);border:1px solid var(--hr);padding:1.15rem;margin-bottom:.9rem;transition:border-color .2s;}
.dp:hover{border-color:var(--accent);}
.dp-top{display:flex;align-items:center;gap:.75rem;margin-bottom:.65rem;}
.dp-av{width:34px;height:34px;border-radius:50%;background:var(--surface2);border:1px solid var(--hr);overflow:hidden;display:flex;align-items:center;justify-content:center;font-family:'Cinzel',serif;font-size:.75rem;color:var(--accent);flex-shrink:0;}
.dp-av img{width:100%;height:100%;object-fit:cover;}
.dp-n{font-family:'Cinzel',serif;font-size:.78rem;color:var(--accent);}
.dp-t{font-size:.72rem;color:var(--text-muted);}
.dp-body{font-size:.97rem;line-height:1.72;}
.dp-acts{display:flex;gap:.75rem;margin-top:.62rem;}
.dp-act{background:none;border:none;color:var(--text-muted);font-family:'Crimson Pro',serif;font-size:.83rem;cursor:pointer;transition:color .2s;padding:0;}
.dp-act:hover{color:var(--accent);}
.gate{text-align:center;padding:2.5rem 1.5rem;background:var(--surface);border:1px dashed var(--accent);}
.gate-ico{color:var(--accent);opacity:.5;display:flex;justify-content:center;margin-bottom:.9rem;}
.gate h3{font-family:'Cinzel',serif;color:var(--accent);font-size:1.05rem;margin-bottom:.55rem;letter-spacing:.1em;}
.gate p{font-size:.93rem;color:var(--text-dim);line-height:1.7;max-width:440px;margin:0 auto 1.1rem;}

/* ════════════════════════════════════════
   THEORIES
════════════════════════════════════════ */
.th-card{background:var(--surface);border:1px solid var(--hr);padding:1.3rem;margin-bottom:1.1rem;transition:border-color .22s;}
.th-card:hover{border-color:var(--accent);}
.th-page-header{text-align:center;padding:2rem 1rem 1.5rem;margin-bottom:2rem;position:relative;}
.th-page-header h2{font-family:'Cinzel',serif;font-size:1.6rem;font-weight:700;color:var(--accent);letter-spacing:.14em;margin-bottom:.3rem;display:flex;align-items:center;justify-content:center;gap:.6rem;}
.th-page-header p{font-size:.97rem;color:var(--text-dim);max-width:560px;margin:0 auto;line-height:1.72;}
.th-guidelines{background:var(--surface);border:2px solid var(--accent);padding:1.5rem 1.8rem;margin-bottom:2rem;position:relative;overflow:hidden;}
.th-guidelines::before{content:'';position:absolute;inset:0;background:var(--tag-bg);pointer-events:none;}
.th-guidelines h3{font-family:'Cinzel',serif;font-size:.88rem;letter-spacing:.12em;color:var(--accent);margin-bottom:1rem;display:flex;align-items:center;gap:.5rem;position:relative;}
.th-gl-list{list-style:none;display:flex;flex-direction:column;gap:.55rem;position:relative;}
.th-gl-list li{display:flex;align-items:flex-start;gap:.65rem;font-size:.95rem;color:var(--text-dim);line-height:1.6;}
.th-gl-list li::before{content:'✦';color:var(--accent);font-size:.7rem;flex-shrink:0;margin-top:.2rem;}
.th-submit-wrap{background:var(--surface);border:2px solid var(--accent);padding:1.8rem;margin-bottom:2.5rem;position:relative;overflow:hidden;}
.th-submit-wrap::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--accent),var(--accent2),var(--accent));pointer-events:none;}
.th-form-title{font-family:'Cinzel',serif;font-size:1.2rem;color:var(--accent);letter-spacing:.1em;margin-bottom:1.5rem;}
.th-form-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem;}
@media(max-width:560px){.th-form-grid{grid-template-columns:1fr;}}
.th-form-group{margin-bottom:1rem;}
.th-form-group label{display:block;font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.14em;color:var(--accent);margin-bottom:.38rem;text-transform:uppercase;}
.th-form-group input,.th-form-group select,.th-form-group textarea{width:100%;background:var(--in-bg);border:1px solid var(--in-border);color:var(--text);font-family:'Crimson Pro',serif;font-size:.97rem;padding:.68rem .9rem;transition:border-color .2s;}
.th-form-group input:focus,.th-form-group select:focus,.th-form-group textarea:focus{outline:none;border-color:var(--accent);}
.th-form-group select{appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='11' height='7'%3E%3Cpath d='M1 1l4.5 4.5L10 1' stroke='%23C9A84C' fill='none' stroke-width='1.5'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .9rem center;}
[data-theme="light"] .th-form-group select{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='11' height='7'%3E%3Cpath d='M1 1l4.5 4.5L10 1' stroke='%238B1A1A' fill='none' stroke-width='1.5'/%3E%3C/svg%3E");}
.th-form-group textarea{min-height:120px;resize:vertical;}
.th-char-count{font-size:.72rem;color:var(--text-muted);margin-top:.25rem;text-align:right;}
.th-hr{border:none;border-top:1px solid var(--hr);margin:1.3rem 0;}
.th-check-row{display:flex;align-items:flex-start;gap:.75rem;margin-bottom:.85rem;cursor:pointer;}
.th-check-row input[type=checkbox]{width:16px;height:16px;margin-top:.12rem;accent-color:var(--accent);flex-shrink:0;cursor:pointer;}
.th-check-row span{font-size:.93rem;color:var(--text-dim);line-height:1.5;}
.th-check-row strong{color:var(--text);}
.th-submit-btn{width:100%;padding:.88rem;background:var(--accent);color:var(--bg);font-family:'Cinzel',serif;font-size:.82rem;letter-spacing:.15em;text-transform:uppercase;border:none;cursor:pointer;transition:all .22s;display:flex;align-items:center;justify-content:center;gap:.6rem;}
.th-submit-btn:hover{background:var(--accent2);box-shadow:var(--glow);}
.th-popular-title{font-family:'Cinzel',serif;font-size:1.2rem;color:var(--accent);letter-spacing:.12em;text-align:center;margin:2.5rem 0 1.5rem;display:flex;align-items:center;justify-content:center;gap:.6rem;}
.th-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1.2rem;}
@media(max-width:620px){.th-grid{grid-template-columns:1fr;}}
.th-gc{background:var(--surface);border:1px solid var(--accent);padding:1.2rem;transition:all .25s;position:relative;overflow:hidden;}
.th-gc:hover{box-shadow:var(--glow2);transform:translateY(-2px);}
.th-gc-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:.75rem;}
.th-gc-cat{font-family:'Cinzel',serif;font-size:.6rem;letter-spacing:.08em;padding:.2rem .55rem;background:var(--tag-bg);color:var(--accent);border:1px solid var(--accent);}
.th-gc-likes{display:flex;align-items:center;gap:.3rem;font-size:.82rem;color:var(--text-muted);}
.th-gc-likes span{color:var(--accent);font-size:.95rem;}
.th-gc-title{font-family:'Cinzel',serif;font-size:.95rem;color:var(--text)!important;margin-bottom:.4rem;line-height:1.38;letter-spacing:.03em;}
.th-gc-body{font-size:.87rem;color:var(--text-dim)!important;line-height:1.65;margin-bottom:.6rem;}
.th-gc-footer{font-size:.76rem;color:var(--text-muted)!important;}
.th-gc-meta{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem;flex-wrap:wrap;}
.th-gc-av{width:24px;height:24px;border-radius:50%;background:var(--surface2);border:1px solid var(--hr);overflow:hidden;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-family:'Cinzel',serif;font-size:.58rem;color:var(--accent);}
.th-gc-av img{width:100%;height:100%;object-fit:cover;}
.th-gc-date{font-size:.73rem;color:var(--text-muted);}
.th-gc-actions{display:flex;align-items:center;gap:.5rem;padding-top:.6rem;border-top:1px solid var(--hr);margin-top:.5rem;}
.th-vote-up,.th-vote-down{display:flex;align-items:center;gap:.28rem;background:none;border:1px solid var(--hr);color:var(--text-muted);font-size:.78rem;padding:.2rem .55rem;cursor:pointer;transition:all .2s;}
.th-vote-up:hover,.th-vote-up.active{border-color:#57F287;color:#57F287;background:rgba(87,242,135,.1);}
.th-vote-down:hover,.th-vote-down.active{border-color:var(--crimson-bright);color:var(--crimson-bright);background:rgba(192,39,45,.1);}
.th-vote-score{font-family:'Cinzel',serif;font-size:.82rem;color:var(--accent);min-width:24px;text-align:center;margin-left:auto;}
.th-readonly{background:var(--surface2)!important;border-color:var(--hr)!important;color:var(--text-dim)!important;cursor:default!important;opacity:1!important;}
.th-readonly:focus{border-color:var(--hr)!important;}
.th-autofill-notice{display:flex;align-items:center;gap:.5rem;font-size:.82rem;color:var(--text);font-style:italic;margin-bottom:1rem;padding:.55rem .85rem;background:rgba(201,168,76,.08);border-left:2px solid var(--accent);}

/* ════════════════════════════════════════
   RULES
════════════════════════════════════════ */
.rules-page-hdr{text-align:center;padding:2rem 1rem 1.5rem;margin-bottom:2.2rem;}
.rules-page-hdr h2{font-family:'Cinzel',serif;font-size:1.65rem;font-weight:700;color:var(--accent);letter-spacing:.14em;margin-bottom:.7rem;}
.rules-page-hdr p{font-size:.97rem;color:var(--text-dim);max-width:540px;margin:0 auto;line-height:1.72;}
.rules-card-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1.2rem;margin-bottom:2.5rem;}
@media(max-width:640px){.rules-card-grid{grid-template-columns:1fr;}}
.rule-card{background:var(--surface);border:2px solid var(--accent);padding:1.4rem 1.4rem 1.4rem 1.2rem;display:flex;gap:1.1rem;align-items:flex-start;transition:all .22s;}
.rule-card:hover{background:var(--surface2);box-shadow:var(--glow2);transform:translateY(-2px);}
.rule-card-icon{width:50px;height:50px;border-radius:50%;border:2px solid var(--accent);display:flex;align-items:center;justify-content:center;flex-shrink:0;background:var(--tag-bg);color:var(--accent);}
.rule-card-body h4{font-family:'Cinzel',serif;font-size:.88rem;color:var(--accent);letter-spacing:.07em;margin-bottom:.5rem;}
.rule-card-body p{font-size:.9rem;line-height:1.72;color:var(--text-dim);}
.consequences-box{background:var(--surface);border:2px solid var(--accent);padding:2rem 1.8rem;margin-bottom:1.5rem;position:relative;overflow:hidden;}
.consequences-box::before{content:'';position:absolute;inset:0;background:var(--tag-bg);pointer-events:none;}
.consequences-title{font-family:'Cinzel',serif;font-size:1.15rem;color:var(--accent);letter-spacing:.1em;text-align:center;margin-bottom:1.8rem;position:relative;}
.consequences-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1.2rem;position:relative;}
@media(max-width:600px){.consequences-grid{grid-template-columns:1fr;}}
.cq-item{text-align:center;}
.cq-icon{width:52px;height:52px;border-radius:50%;border:2px solid var(--accent);display:flex;align-items:center;justify-content:center;margin:0 auto .9rem;background:var(--tag-bg);color:var(--accent);}
.cq-title{font-family:'Cinzel',serif;font-size:.82rem;letter-spacing:.1em;color:var(--text);margin-bottom:.6rem;}
.cq-body{font-size:.88rem;line-height:1.68;color:var(--text-dim);}
.cq-body strong{color:var(--text);}
.strikes-wrap{margin-bottom:1.5rem;}
.strikes-title{font-family:'Cinzel',serif;font-size:1rem;letter-spacing:.15em;color:var(--accent);text-transform:uppercase;margin-bottom:1.2rem;text-align:center;}
.strikes-list{display:flex;flex-direction:column;gap:.75rem;}
.sk{display:flex;align-items:flex-start;gap:1rem;padding:1rem 1.3rem;background:var(--surface);border:1px solid var(--hr);transition:background .2s;}
.sk:hover{background:var(--surface2);}
.sk-num{font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.1em;color:#fff;padding:.22rem .55rem;white-space:nowrap;flex-shrink:0;margin-top:.12rem;font-weight:700;}
.sk-num.s1,.sk-num.s2,.sk-num.s3,.sk-num.s4{background:var(--accent);color:var(--bg);}
.sk-num.s5{background:var(--crimson);}
.sk-num.s6{background:var(--crimson-deep);}
.sk-body h4{font-family:'Cinzel',serif;font-size:.78rem;color:var(--accent);margin-bottom:.3rem;letter-spacing:.07em;}
.sk.s5 .sk-body h4,.sk.s6 .sk-body h4{color:var(--crimson-bright);}
.sk-body p{font-size:.93rem;line-height:1.7;}
.questions-box{background:var(--surface);border:2px solid var(--accent);padding:2.2rem 1.8rem;text-align:center;position:relative;overflow:hidden;}
.questions-box::before{content:'';position:absolute;inset:0;background:var(--tag-bg);pointer-events:none;}
.qb-icon{color:var(--accent);display:flex;justify-content:center;margin-bottom:.8rem;position:relative;}
.qb-title{font-family:'Cinzel',serif;font-size:1.1rem;color:var(--accent);letter-spacing:.1em;margin-bottom:.7rem;position:relative;}
.qb-body{font-size:.97rem;color:var(--text-dim);line-height:1.72;max-width:500px;margin:0 auto 1.3rem;position:relative;}

/* ════════════════════════════════════════
   GALLERY — FOLDER SYSTEM
════════════════════════════════════════ */
.gal-folders-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:1.2rem;margin-top:1.6rem;}
.gal-folder{background:var(--surface);border:1px solid var(--hr);padding:1.8rem 1.2rem 1.4rem;text-align:center;cursor:pointer;transition:all .22s;position:relative;overflow:hidden;}
.gal-folder::after{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--accent);transform:scaleX(0);transform-origin:left;transition:transform .3s;}
.gal-folder:hover::after{transform:scaleX(1);}
.gal-folder:hover{border-color:var(--accent);box-shadow:var(--glow2);transform:translateY(-3px);}
.gal-folder-icon{color:var(--accent);margin-bottom:.9rem;display:flex;justify-content:center;}
.gal-folder-name{font-family:'Cinzel',serif;font-size:.75rem;letter-spacing:.1em;color:var(--text);margin-bottom:.35rem;line-height:1.4;}
.gal-folder-count{font-size:.72rem;color:var(--text-muted);}
.gal-folder-view{margin-top:1.8rem;}
.gal-folder-header{display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:1px solid var(--hr);}
.gal-back-btn{display:flex;align-items:center;gap:.4rem;background:none;border:1px solid var(--accent);color:var(--accent);padding:.38rem .85rem;font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.1em;cursor:pointer;transition:all .2s;text-transform:uppercase;}
.gal-back-btn:hover{background:var(--accent);color:var(--bg);}
.gal-folder-header h3{font-family:'Cinzel',serif;font-size:1rem;color:var(--accent);letter-spacing:.1em;}
.gal-folder-empty{text-align:center;padding:3.5rem 2rem;background:var(--surface);border:1px dashed var(--hr);}
.gal-folder-empty .gal-empty-icon{color:var(--accent);opacity:.35;display:flex;justify-content:center;margin-bottom:.85rem;}
.gal-folder-empty p{font-family:'Cinzel',serif;font-size:.82rem;letter-spacing:.1em;color:var(--text-muted);margin-top:.4rem;font-style:italic;}
.gal-folder-empty .gal-empty-sub{font-family:'Crimson Pro',serif;font-size:.88rem;color:var(--text-muted);margin-top:.5rem;letter-spacing:0;font-style:normal;opacity:.7;}
.gal-images-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:.85rem;}
.gal-img-thumb{position:relative;overflow:hidden;border:1px solid var(--hr);cursor:pointer;transition:all .25s;background:var(--surface);}
.gal-img-thumb:hover{border-color:var(--accent);box-shadow:var(--glow2);transform:translateY(-2px);}
.gal-img-thumb img{width:100%;height:160px;object-fit:cover;display:block;transition:transform .5s;}
.gal-img-thumb:hover img{transform:scale(1.06);}
.gal-img-thumb-caption{padding:.55rem .75rem;font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.08em;color:var(--text-dim);text-overflow:ellipsis;overflow:hidden;white-space:nowrap;}
/* Lightbox */
.gal-lightbox-ov{position:fixed;inset:0;background:rgba(0,0,0,.94);z-index:2000;display:none;align-items:center;justify-content:center;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);}
.gal-lightbox-ov.open{display:flex;animation:fi .2s ease;}
.gal-lightbox{position:relative;max-width:90vw;max-height:90vh;display:flex;flex-direction:column;align-items:center;}
.gal-lb-close{position:absolute;top:-2.5rem;right:0;background:none;border:1px solid rgba(255,255,255,.3);color:#fff;width:32px;height:32px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:border-color .2s;border-radius:2px;}
.gal-lb-close:hover{border-color:var(--accent);color:var(--accent);}
.gal-lb-img-wrap{display:flex;align-items:center;justify-content:center;}
.gal-lb-img-wrap img{max-width:78vw;max-height:70vh;object-fit:contain;display:block;border:1px solid rgba(255,255,255,.1);}
.gal-lb-prev,.gal-lb-next{position:fixed;top:50%;transform:translateY(-50%);background:rgba(0,0,0,.65);border:1px solid rgba(255,255,255,.2);color:#fff;width:48px;height:48px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;z-index:10;border-radius:2px;}
.gal-lb-prev{left:1rem;}
.gal-lb-next{right:1rem;}
.gal-lb-prev:hover,.gal-lb-next:hover{background:var(--accent);border-color:var(--accent);color:var(--bg);}
.gal-lb-info{margin-top:.85rem;text-align:center;}
.gal-lb-title{font-family:'Cinzel',serif;font-size:.8rem;letter-spacing:.1em;color:rgba(255,255,255,.8);margin-bottom:.7rem;}
.gal-lb-downloads{display:flex;align-items:center;gap:.5rem;justify-content:center;flex-wrap:wrap;}
.gal-lb-dl-label{font-family:'Cinzel',serif;font-size:.6rem;letter-spacing:.14em;color:rgba(255,255,255,.5);text-transform:uppercase;}
.gal-lb-dl-btn{padding:.3rem .8rem;font-family:'Cinzel',serif;font-size:.6rem;letter-spacing:.1em;text-transform:uppercase;border:1px solid var(--accent);color:var(--accent);background:transparent;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:.3rem;}
.gal-lb-dl-btn:hover{background:var(--accent);color:var(--bg);}
.gal-lb-counter{font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.1em;color:rgba(255,255,255,.4);margin-top:.4rem;}

/* ════════════════════════════════════════
   CHARACTERS
════════════════════════════════════════ */
.ch-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1.6rem;}
.ch{display:grid;grid-template-columns:105px 1fr;gap:.95rem;background:var(--surface);border:1px solid var(--hr);padding:1rem;transition:all .28s;position:relative;overflow:hidden;}
.ch::after{content:'';position:absolute;top:0;left:0;width:3px;height:0;background:var(--accent);transition:height .28s;}
.ch:hover{border-color:var(--accent);box-shadow:var(--glow2);}
.ch:hover::after{height:100%;}
.ch-img{width:105px;height:105px;object-fit:cover;object-position:top;border:1px solid var(--hr);}
.ch-info h3{font-family:'Cinzel',serif;font-size:.88rem;color:var(--accent);margin-bottom:.1rem;letter-spacing:.06em;}
.ch-info .ct{font-size:.73rem;color:var(--text-muted);font-style:italic;margin-bottom:.45rem;}
.ch-info p{font-size:.84rem;line-height:1.62;}
.ch-tag{display:inline-block;padding:.1rem .42rem;border:1px solid var(--accent);font-family:'Cinzel',serif;font-size:.56rem;letter-spacing:.07em;color:var(--accent);margin-top:.42rem;}
@media(max-width:640px){.ch-grid{grid-template-columns:1fr;}.ch{grid-template-columns:88px 1fr;}.ch-img{width:88px;height:88px;}}

/* ════════════════════════════════════════
   INFO
════════════════════════════════════════ */
  /* Separator between @username and ID */
.pm-pipe {
  color: var(--text-muted);font-size: .8rem; margin: 0 .25rem;}
/* Member badge text uppercase */
.pm-member-badge {text-transform: uppercase;}
.sl-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(188px,1fr));gap:.72rem;}
.sl{display:flex;align-items:center;gap:.72rem;padding:.72rem .95rem;background:var(--surface);border:1px solid var(--hr);color:var(--text);transition:all .2s;font-size:.86rem;}
.sl:hover{border-color:var(--accent);background:var(--surface2);color:var(--accent);transform:translateX(3px);}
.sl-ico{color:var(--accent);display:flex;align-items:center;flex-shrink:0;}
.sl-name{font-family:'Cinzel',serif;font-size:.65rem;letter-spacing:.09em;color:var(--accent);}
.sl-sub{font-size:.73rem;color:var(--text-muted);}
.ls-sec{margin-bottom:2rem;}
.ls-sec h3{font-family:'Cinzel',serif;font-size:.78rem;letter-spacing:.18em;color:var(--accent);text-transform:uppercase;margin-bottom:.85rem;padding-bottom:.42rem;border-bottom:1px solid var(--hr);}
.au-card{display:flex;gap:1.6rem;align-items:center;padding:1.6rem;background:var(--surface);border:1px solid var(--accent);}
.au-img{width:105px;height:105px;object-fit:cover;border:2px solid var(--accent);flex-shrink:0;}
.au-info h3{font-family:'Cinzel',serif;font-size:1.05rem;color:var(--accent);margin-bottom:.18rem;letter-spacing:.07em;}
.au-info .au-jp{font-family:'Ma Shan Zheng',serif;font-size:.95rem;color:var(--text-muted);margin-bottom:.62rem;}
.au-info p{font-size:.92rem;line-height:1.7;margin-bottom:.85rem;}
@media(max-width:560px){.au-card{flex-direction:column;align-items:flex-start;}.au-img{width:80px;height:80px;}}

/* ════════════════════════════════════════
   STAFF
════════════════════════════════════════ */
.staff-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(195px,1fr));gap:1.2rem;margin-bottom:2.2rem;}
.sc{background:var(--surface);border:1px solid var(--hr);overflow:hidden;text-align:center;transition:all .28s;cursor:pointer;position:relative;}
.sc:hover{border-color:var(--accent);box-shadow:var(--glow2);transform:translateY(-4px);}
.sc img{width:100%;height:158px;object-fit:cover;object-position:top;display:block;filter:saturate(.82);transition:filter .3s,transform .5s;}
.sc:hover img{filter:saturate(1.1);transform:scale(1.06);}
.sc-body{padding:.95rem .85rem;}
.sc-role{font-family:'Cinzel',serif;font-size:.55rem;letter-spacing:.2em;color:var(--accent);text-transform:uppercase;margin-bottom:.22rem;}
.sc-name{font-family:'Cinzel',serif;font-size:.88rem;font-weight:600;color:var(--text);margin-bottom:.14rem;}
.sc-handle{font-size:.76rem;color:var(--text-muted);font-style:italic;}
.sc-view{position:absolute;bottom:0;left:0;right:0;background:var(--accent);color:var(--bg);font-family:'Cinzel',serif;font-size:.58rem;letter-spacing:.14em;text-transform:uppercase;padding:.38rem;text-align:center;transform:translateY(100%);transition:transform .22s;border:none;cursor:pointer;width:100%;}
.sc:hover .sc-view{transform:translateY(0);}

/* ════════════════════════════════════════
   DISCORD-STYLE STAFF MODAL
════════════════════════════════════════ */
.dc-modal-ov{position:fixed;inset:0;background:rgba(0,0,0,.88);z-index:1000;display:none;align-items:center;justify-content:center;padding:1rem;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);}
.dc-modal-ov.open{display:flex;animation:fi .22s ease;}
.dc-staff-modal{background:var(--surface);border:1px solid rgba(255,255,255,.07);max-width:480px;width:100%;max-height:92vh;overflow-y:auto;position:relative;border-radius:10px;box-shadow:0 28px 80px rgba(0,0,0,.82);}
.dc-staff-modal::-webkit-scrollbar{width:3px;}
.dc-staff-modal::-webkit-scrollbar-thumb{background:var(--accent);border-radius:2px;}

/* ── Banner ── */
.dc-sm-banner{height:160px;position:relative;overflow:hidden;flex-shrink:0;border-radius:10px 10px 0 0;}
.dc-sm-banner-real{width:100%;height:100%;object-fit:cover;display:block;}
.dc-sm-banner-fallback{width:100%;height:100%;background:var(--header-bg) center/cover no-repeat;position:relative;display:flex;align-items:center;justify-content:center;}
.dc-sm-banner-fallback::before{content:'';position:absolute;inset:0;backdrop-filter:blur(10px) saturate(1.3);-webkit-backdrop-filter:blur(10px) saturate(1.3);background:rgba(0,0,0,.48);}
[data-theme="light"] .dc-sm-banner-fallback::before{background:rgba(255,240,220,.55);}
.dc-sm-banner-nobanner{position:relative;z-index:1;font-family:'Cinzel',serif;font-size:.58rem;letter-spacing:.26em;color:rgba(255,255,255,.38);text-transform:uppercase;border:1px solid rgba(255,255,255,.14);padding:.3rem .85rem;border-radius:3px;}
[data-theme="light"] .dc-sm-banner-nobanner{color:rgba(0,0,0,.3);border-color:rgba(0,0,0,.15);}
.dc-sm-banner-loading{width:100%;height:100%;background:var(--surface2);display:flex;align-items:center;justify-content:center;}
.dc-sm-banner-loading::after{content:'';width:22px;height:22px;border:2px solid var(--hr);border-top-color:var(--accent);border-radius:50%;animation:spin .7s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}

/* ── Close ── */
.dc-sm-close{position:absolute;top:.7rem;right:.7rem;z-index:10;background:rgba(0,0,0,.62);border:none;color:rgba(255,255,255,.75);width:30px;height:30px;cursor:pointer;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all .18s;}
.dc-sm-close:hover{background:rgba(192,39,45,.8);color:#fff;}

/* ── Avatar row ── */
.dc-sm-avatar-row{display:flex;align-items:flex-end;justify-content:space-between;padding:0 1.2rem;margin-top:-50px;position:relative;z-index:2;margin-bottom:.6rem;}
.dc-sm-avatar-wrap{position:relative;flex-shrink:0;}
.dc-sm-avatar{width:94px;height:94px;border-radius:50%;border:6px solid var(--surface);overflow:hidden;background:var(--surface2);display:flex;align-items:center;justify-content:center;font-family:'Cinzel',serif;font-size:2rem;font-weight:700;color:var(--accent);}
.dc-sm-avatar img{width:100%;height:100%;object-fit:cover;}
.dc-sm-status-dot{position:absolute;bottom:6px;right:6px;width:18px;height:18px;border-radius:50%;border:4px solid var(--surface);background:#747f8d;}
.dc-sm-status-dot.online{background:#57F287;}
.dc-sm-status-dot.idle{background:#FEE75C;}
.dc-sm-status-dot.dnd{background:#ED4245;}

/* ── Badges strip ── */
.dc-sm-badges{display:flex;gap:.35rem;flex-wrap:wrap;align-items:flex-end;padding-bottom:.55rem;}
.dc-sm-badge{font-family:'Cinzel',serif;font-size:.55rem;letter-spacing:.1em;padding:.22rem .65rem;border:1px solid var(--accent);color:var(--accent);background:var(--tag-bg);border-radius:3px;}

/* ── Body ── */
.dc-sm-body{padding:.2rem 1.2rem 1.4rem;}
.dc-sm-name{font-family:'Cinzel',serif;font-size:1.22rem;font-weight:700;color:var(--text);letter-spacing:.04em;line-height:1.2;margin-bottom:.1rem;}
.dc-sm-handle-row{display:flex;align-items:center;gap:.45rem;flex-wrap:wrap;margin-bottom:.1rem;}
.dc-sm-handle{font-size:.82rem;color:var(--text-muted);}
.dc-sm-uid{font-family:monospace;font-size:.68rem;color:var(--text-muted);background:var(--surface2);padding:.1rem .42rem;border-radius:3px;border:1px solid var(--hr);}
.dc-sm-divider{height:1px;background:var(--hr);margin:.85rem 0;opacity:.5;}
.dc-sm-label{font-family:'Cinzel',serif;font-size:.56rem;letter-spacing:.22em;color:var(--text-muted);text-transform:uppercase;margin-bottom:.35rem;display:block;}
.dc-sm-val{font-size:.92rem;color:var(--text-dim);line-height:1.75;white-space:pre-wrap;}
.dc-sm-field{margin-bottom:.85rem;}
.dc-sm-field:last-child{margin-bottom:0;}

/* ── Meta grid (age / tz / birthday) ── */
.dc-sm-meta-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:.55rem;}
@media(max-width:400px){.dc-sm-meta-grid{grid-template-columns:repeat(2,1fr);}}
.dc-sm-meta-item{background:var(--surface2);padding:.55rem .75rem;border-radius:5px;border:1px solid var(--hr);}
.dc-sm-meta-label{font-family:'Cinzel',serif;font-size:.52rem;letter-spacing:.16em;color:var(--text-muted);text-transform:uppercase;margin-bottom:.18rem;}
.dc-sm-meta-val{font-size:.84rem;color:var(--text);font-weight:600;}

/* ── Roles ── */
.dc-sm-roles{display:flex;flex-wrap:wrap;gap:.4rem;}
.dc-sm-role{font-family:'Cinzel',serif;font-size:.6rem;font-weight:700;padding:.2rem .6rem;letter-spacing:.04em;border-radius:4px;display:inline-flex;align-items:center;gap:.3rem;}
.dc-sm-role::before{content:'';display:inline-block;width:8px;height:8px;border-radius:50%;background:currentColor;opacity:.9;flex-shrink:0;}
.dc-sm-role-admin{background:rgba(201,168,76,.18);color:#C9A84C;border:1px solid rgba(201,168,76,.4);}
.dc-sm-role-mod{background:rgba(88,101,242,.18);color:#818cf8;border:1px solid rgba(88,101,242,.35);}
.dc-sm-role-trialmod{background:rgba(120,160,220,.18);color:#93b4e8;border:1px solid rgba(120,160,220,.35);}
.dc-sm-role-founder{background:rgba(192,39,45,.18);color:#e05a5f;border:1px solid rgba(192,39,45,.38);}
.dc-sm-role-member{background:rgba(130,130,160,.15);color:#a0a0c0;border:1px solid rgba(130,130,160,.3);}

/* ── Live role pill (color from Discord API) ── */
.dc-sm-role-live{
  font-family:'Cinzel',serif;font-size:.6rem;font-weight:700;
  padding:.22rem .62rem;letter-spacing:.04em;border-radius:4px;
  display:inline-flex;align-items:center;gap:.32rem;
}
.dc-sm-role-dot{
  display:inline-block;width:8px;height:8px;border-radius:50%;
  flex-shrink:0;opacity:.95;
}
.dc-sm-roles-loading{
  font-size:.84rem;color:var(--text-muted);font-style:italic;
}
.sc-av-wrap{width:100%;height:158px;overflow:hidden;position:relative;background:var(--surface2);display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.sc-av-wrap img{width:100%;height:100%;object-fit:cover;object-position:top center;filter:saturate(.82);transition:filter .3s,transform .5s;}
.sc:hover .sc-av-wrap img{filter:saturate(1.1);transform:scale(1.06);}
.sc-av-initials{font-family:'Cinzel',serif;font-size:2.5rem;font-weight:700;color:var(--accent);opacity:.7;transition:transform .5s;}
.sc:hover .sc-av-initials{transform:scale(1.06);}
.sc-status-dot{position:absolute;bottom:7px;right:7px;width:13px;height:13px;border-radius:50%;border:3px solid var(--surface);background:#747f8d;z-index:2;transition:background .3s;}
.sc-status-dot.online{background:#57F287;}
.sc-status-dot.idle{background:#FEE75C;}
.sc-status-dot.dnd{background:#ED4245;}
@media(max-width:768px){.sc-av-wrap{height:140px;}}

.th-img-drop{border:2px dashed var(--in-border);background:var(--in-bg);padding:1.5rem 1rem;text-align:center;cursor:pointer;transition:border-color .2s;min-height:110px;display:flex;flex-direction:column;align-items:center;justify-content:center;}
.th-img-drop:hover{border-color:var(--accent);}
.th-img-thumb-mini{width:60px;height:60px;object-fit:cover;border:1px solid var(--hr);border-radius:2px;}

/* ════════════════════════════════════════
   APPLY
════════════════════════════════════════ */
.apply-wrap{max-width:720px;margin:0 auto;}
.apply-intro{text-align:center;margin-bottom:2.2rem;}
.apply-intro p{font-size:1.02rem;color:var(--text-dim);line-height:1.8;}
.af .fr{margin-bottom:1.2rem;}
.af label{display:block;font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.14em;color:var(--accent);margin-bottom:.38rem;text-transform:uppercase;}
.af input,.af select,.af textarea{width:100%;background:var(--in-bg);border:1px solid var(--in-border);color:var(--text);font-family:'Crimson Pro',serif;font-size:1rem;padding:.7rem .95rem;transition:border-color .2s;}
.af input:focus,.af select:focus,.af textarea:focus{outline:none;border-color:var(--accent);}
.af select{appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='11' height='7'%3E%3Cpath d='M1 1l4.5 4.5L10 1' stroke='%23C9A84C' fill='none' stroke-width='1.5'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .9rem center;}
[data-theme="light"] .af select{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='11' height='7'%3E%3Cpath d='M1 1l4.5 4.5L10 1' stroke='%238B1A1A' fill='none' stroke-width='1.5'/%3E%3C/svg%3E");}
.af textarea{min-height:105px;resize:vertical;}
.af .fhint{font-size:.79rem;color:var(--text-muted);margin-top:.3rem;font-style:italic;}
.af .fg{display:grid;grid-template-columns:1fr 1fr;gap:1.1rem;}
@media(max-width:520px){.af .fg{grid-template-columns:1fr;}}
.apply-ok{display:none;text-align:center;padding:3rem;background:var(--surface);border:1px solid var(--accent);}
.apply-ok .ao-ico{color:var(--accent);display:flex;justify-content:center;margin-bottom:.9rem;}
.apply-ok h3{font-family:'Cinzel',serif;color:var(--accent);font-size:1.15rem;margin-bottom:.55rem;letter-spacing:.1em;}
.apply-ok p{font-size:.97rem;color:var(--text-dim);line-height:1.72;}

/* ════════════════════════════════════════
   NEWS REDESIGN
════════════════════════════════════════ */
.news-page-header{text-align:center;padding:2.5rem 1rem 2rem;position:relative;overflow:hidden;background:var(--surface);border:1px solid var(--hr);margin-bottom:2.5rem;}
.news-page-header::before{content:'';position:absolute;inset:0;background:var(--pattern);background-size:60px 60px;opacity:.08;pointer-events:none;}
.news-jp{font-family:'Ma Shan Zheng',serif;font-size:2.4rem;color:var(--accent);margin-bottom:.2rem;position:relative;}
.news-en{font-family:'Cinzel',serif;font-size:1.5rem;font-weight:700;letter-spacing:.12em;color:var(--text);margin-bottom:.8rem;position:relative;}
.news-desc{font-size:.97rem;color:var(--text-dim);max-width:560px;margin:0 auto;line-height:1.7;position:relative;}
.news-pinned{position:relative;border:2px solid var(--accent);display:grid;grid-template-columns:1fr 1fr;margin-bottom:2.5rem;background:var(--surface);overflow:hidden;cursor:pointer;}
@media(max-width:680px){.news-pinned{grid-template-columns:1fr;}}
.news-pin-badge{position:absolute;top:.9rem;left:.9rem;z-index:2;background:var(--accent);color:var(--bg);font-family:'Cinzel',serif;font-size:.6rem;letter-spacing:.12em;padding:.28rem .7rem;display:flex;align-items:center;gap:.35rem;}
.news-pin-img{position:relative;overflow:hidden;min-height:280px;}
@media(max-width:680px){.news-pin-img{min-height:200px;}}
.news-pin-img-bg{width:100%;height:100%;object-fit:cover;display:block;background:linear-gradient(135deg,var(--crimson-deep),#1a0505);min-height:280px;}
.news-pin-content{padding:2rem 1.8rem;display:flex;flex-direction:column;justify-content:flex-end;}
@media(max-width:680px){.news-pin-content{padding:1.4rem;}}
.news-pin-badges{display:flex;gap:.5rem;margin-bottom:.9rem;flex-wrap:wrap;}
.nb{font-family:'Cinzel',serif;font-size:.6rem;letter-spacing:.1em;padding:.25rem .65rem;font-weight:700;}
.nb-featured{background:var(--accent);color:var(--bg);}
.nb-editors{background:#F5A623;color:#fff;}
.nb-chapter{background:#7B2D8B;color:#fff;}
.nb-announce{background:#2ECC71;color:#fff;}
.nb-date{font-size:.8rem;color:var(--text-muted);}
.news-pin-title{font-family:'Cinzel',serif;font-size:1.4rem;color:var(--accent);margin-bottom:.9rem;line-height:1.35;letter-spacing:.04em;}
@media(max-width:680px){.news-pin-title{font-size:1.1rem;}}
.news-pin-body{font-size:.97rem;color:var(--text-dim);line-height:1.75;margin-bottom:1.2rem;}
.news-pin-author{display:flex;align-items:center;gap:.65rem;}
.np-av{width:32px;height:32px;border-radius:50%;background:var(--surface2);border:1px solid var(--accent);display:flex;align-items:center;justify-content:center;font-family:'Cinzel',serif;font-size:.72rem;color:var(--accent);flex-shrink:0;}
.np-name{font-family:'Cinzel',serif;font-size:.75rem;color:var(--text);letter-spacing:.05em;}
.np-stats{margin-left:auto;font-size:.78rem;color:var(--text-muted);display:flex;align-items:center;gap:.9rem;}
@media(max-width:500px){.np-stats{display:none;}}
.news-grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:1.3rem;margin-bottom:2rem;}
@media(max-width:900px){.news-grid-3{grid-template-columns:repeat(2,1fr);}}
@media(max-width:560px){.news-grid-3{grid-template-columns:1fr;}}
.ngc{background:var(--surface);border:1px solid var(--hr);overflow:hidden;transition:all .25s;display:flex;flex-direction:column;cursor:pointer;}
.ngc:hover{border-color:var(--accent);box-shadow:var(--glow2);transform:translateY(-3px);}
.ngc-img{position:relative;overflow:hidden;}
.ngc-img-inner{width:100%;height:165px;object-fit:cover;display:block;background:linear-gradient(135deg,var(--crimson-deep) 0%,#2a0808 100%);transition:transform .5s;}
.ngc:hover .ngc-img-inner{transform:scale(1.06);}
.ngc-badge{position:absolute;top:.65rem;left:.65rem;font-family:'Cinzel',serif;font-size:.55rem;letter-spacing:.1em;padding:.2rem .55rem;font-weight:700;color:#fff;text-transform:uppercase;}
.ngc-share{position:absolute;top:.55rem;right:.55rem;display:flex;flex-direction:column;gap:.3rem;opacity:0;transition:opacity .2s;}
.ngc:hover .ngc-share{opacity:1;}
.ngc-share-btn{width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.7rem;cursor:pointer;border:none;color:#fff;transition:transform .15s;}
.ngc-share-btn:hover{transform:scale(1.1);}
.ngc-timer{position:absolute;bottom:.55rem;left:.65rem;background:rgba(0,0,0,.7);color:#fff;font-size:.6rem;padding:.2rem .45rem;font-family:'Cinzel',serif;display:flex;align-items:center;gap:.25rem;}
.ngc-body{padding:1rem .95rem;flex:1;display:flex;flex-direction:column;}
.ngc-meta{display:flex;align-items:center;gap:.5rem;margin-bottom:.6rem;}
.ngc-av{width:22px;height:22px;border-radius:50%;background:var(--surface2);border:1px solid var(--hr);display:flex;align-items:center;justify-content:center;font-size:.55rem;font-family:'Cinzel',serif;color:var(--accent);flex-shrink:0;}
.ngc-author{font-family:'Cinzel',serif;font-size:.62rem;color:var(--text-dim);}
.ngc-date{font-size:.62rem;color:var(--text-muted);}
.ngc-title{font-family:'Cinzel',serif;font-size:.88rem;color:var(--accent);margin-bottom:.5rem;line-height:1.38;letter-spacing:.03em;}
.ngc-excerpt{font-size:.85rem;color:var(--text-dim);line-height:1.65;flex:1;margin-bottom:.8rem;}
.ngc-tags{display:flex;flex-wrap:wrap;gap:.35rem;margin-bottom:.75rem;}
.ngc-tag{padding:.12rem .45rem;border:1px solid var(--hr);border-radius:20px;font-size:.62rem;color:var(--text-muted);}
.ngc-footer{display:flex;align-items:center;justify-content:space-between;padding-top:.65rem;border-top:1px solid var(--hr);}
.ngc-likes{font-size:.78rem;color:var(--text-muted);display:flex;align-items:center;gap:.25rem;}
.ngc-read-btn{font-family:'Cinzel',serif;font-size:.6rem;letter-spacing:.1em;text-transform:uppercase;border:1px solid var(--accent);color:var(--accent);background:transparent;padding:.28rem .7rem;cursor:pointer;transition:all .2s;}
.ngc-read-btn:hover{background:var(--accent);color:var(--bg);}
.news-filters{display:flex;gap:.5rem;flex-wrap:wrap;align-items:center;margin-bottom:1.5rem;}
.nf-btn{padding:.38rem .85rem;font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.09em;border:1px solid var(--hr);color:var(--text-dim);background:transparent;cursor:pointer;border-radius:20px;transition:all .2s;}
.nf-btn:hover{border-color:var(--accent);color:var(--accent);}
.nf-btn.active{border-color:var(--accent);color:var(--accent);background:var(--tag-bg);}
.news-section-title{display:flex;align-items:center;gap:.9rem;margin:2.2rem 0 1.3rem;}
.news-section-title h3{font-family:'Cinzel',serif;font-size:.88rem;letter-spacing:.15em;color:var(--text);text-transform:uppercase;}
.news-section-title::after{content:'';flex:1;height:1px;background:var(--hr);}
.never-miss{text-align:center;padding:2.5rem 2rem;background:var(--surface);border:2px solid var(--accent);margin-top:2.5rem;position:relative;overflow:hidden;}
.never-miss::before{content:'';position:absolute;inset:0;background:var(--pattern);background-size:60px 60px;opacity:.06;pointer-events:none;}
.nm-icon{width:56px;height:56px;border-radius:50%;border:2px solid var(--accent);display:flex;align-items:center;justify-content:center;margin:0 auto 1rem;background:var(--tag-bg);position:relative;color:var(--accent);}
.never-miss h3{font-family:'Cinzel',serif;font-size:1.1rem;color:var(--accent);letter-spacing:.1em;margin-bottom:.6rem;position:relative;}
.never-miss p{font-size:.95rem;color:var(--text-dim);max-width:440px;margin:0 auto 1.4rem;line-height:1.7;position:relative;}
.disc-form-wrap{background:var(--surface);border:1px solid var(--accent);padding:1.2rem;margin-bottom:1.2rem;}
.disc-av-row{display:flex;align-items:center;gap:.8rem;margin-bottom:.8rem;}
.disc-form-av{width:38px;height:38px;border-radius:50%;background:var(--surface2);border:2px solid var(--accent);flex-shrink:0;overflow:hidden;display:flex;align-items:center;justify-content:center;font-family:'Cinzel',serif;font-size:.9rem;color:var(--accent);}
.disc-form-av img{width:100%;height:100%;object-fit:cover;}
.disc-select{width:100%;background:var(--in-bg);border:1px solid var(--in-border);color:var(--text);font-family:'Crimson Pro',serif;font-size:.95rem;padding:.5rem .75rem;}
.disc-textarea{width:100%;background:var(--in-bg);border:1px solid var(--in-border);color:var(--text);font-family:'Crimson Pro',serif;font-size:.97rem;padding:.7rem .95rem;min-height:90px;resize:vertical;margin-bottom:.75rem;display:block;transition:border-color .2s;}
.disc-textarea:focus{outline:none;border-color:var(--accent);}
.disc-list{display:flex;flex-direction:column;gap:.8rem;}
.news-empty{text-align:center;padding:3.5rem 2rem;background:var(--surface);border:1px dashed var(--hr);margin-bottom:1.5rem;}
.news-empty-ico{color:var(--accent);opacity:.45;display:flex;justify-content:center;margin-bottom:.7rem;}
.news-empty h3{font-family:'Cinzel',serif;font-size:.9rem;color:var(--text-muted);letter-spacing:.1em;margin-bottom:.4rem;}
.news-empty p{font-size:.88rem;color:var(--text-muted);}
.comment-gate{background:var(--surface);border:1px solid var(--accent);padding:1.2rem;text-align:center;margin-top:.5rem;}
.comment-gate p{font-size:.93rem;color:var(--text-dim);margin-bottom:.8rem;}

/* ════════════════════════════════════════
   STATS & OFFERS
════════════════════════════════════════ */
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1.1rem;margin-bottom:2.5rem;}
@media(max-width:640px){.stats-grid{grid-template-columns:repeat(2,1fr);}}
.stat-card{background:var(--surface);border:2px solid var(--accent);padding:1.5rem 1rem;text-align:center;position:relative;overflow:hidden;transition:transform .22s,box-shadow .22s;}
.stat-card:hover{transform:translateY(-3px);box-shadow:var(--glow2);}
.stat-card::before{content:'';position:absolute;inset:0;background:var(--tag-bg);pointer-events:none;}
.stat-icon{color:var(--accent);margin-bottom:.5rem;position:relative;display:flex;justify-content:center;}
.stat-val{font-family:'Cinzel',serif;font-size:2rem;font-weight:700;color:var(--accent);line-height:1;margin-bottom:.3rem;position:relative;text-shadow:0 0 12px rgba(201,168,76,.35);}
.stat-label{font-family:'Cinzel',serif;font-size:.6rem;letter-spacing:.18em;color:var(--text-muted);text-transform:uppercase;position:relative;}
.offer-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1.2rem;margin-bottom:2rem;}
@media(max-width:760px){.offer-grid{grid-template-columns:repeat(2,1fr);}}
@media(max-width:480px){.offer-grid{grid-template-columns:1fr;}}
.offer-card{background:var(--surface);border:1px solid var(--hr);padding:1.4rem;transition:all .22s;position:relative;}
.offer-card:hover{border-color:var(--accent);box-shadow:var(--glow2);transform:translateY(-2px);}
.offer-card::after{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--accent);transform:scaleX(0);transform-origin:left;transition:transform .3s;}
.offer-card:hover::after{transform:scaleX(1);}
.offer-icon{color:var(--accent);margin-bottom:.6rem;}
.offer-card h4{font-family:'Cinzel',serif;font-size:.82rem;color:var(--accent);letter-spacing:.1em;margin-bottom:.5rem;}
.offer-card p{font-size:.9rem;line-height:1.7;color:var(--text-dim);}
.read-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(195px,1fr));gap:.85rem;margin-top:1.8rem;}
.rc{border:1px solid var(--accent);padding:1rem 1.2rem;display:flex;align-items:center;gap:.85rem;background:var(--surface);transition:all .2s;color:var(--text);}
.rc:hover{background:var(--surface2);box-shadow:var(--glow);transform:translateX(4px);}
.rc-ico{color:var(--accent);flex-shrink:0;display:flex;align-items:center;}
.rc-title{font-family:'Cinzel',serif;font-size:.72rem;letter-spacing:.07em;color:var(--accent);}
.rc-sub{font-size:.8rem;color:var(--text-muted);}

/* ════════════════════════════════════════
   ARTICLE MODAL
════════════════════════════════════════ */
.art-modal-ov{position:fixed;inset:0;background:rgba(0,0,0,.88);z-index:1001;display:none;align-items:flex-start;justify-content:center;padding:1.5rem 1rem;overflow-y:auto;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);}
.art-modal-ov.open{display:flex;animation:fi .22s ease;}
.art-modal{background:var(--bg);border:1px solid var(--accent);max-width:720px;width:100%;position:relative;margin:auto;}
.art-modal-hero{position:relative;min-height:260px;overflow:hidden;background:linear-gradient(135deg,var(--crimson-deep),#3a0505);display:flex;align-items:flex-end;}
@media(max-width:540px){.art-modal-hero{min-height:180px;}}
.art-modal-hero-bg{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:6rem;opacity:.18;}
.art-modal-hero-overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,.85) 0%,rgba(0,0,0,.2) 60%,transparent 100%);}
.art-modal-hero-content{position:relative;z-index:2;padding:1.5rem 1.8rem 1.4rem;}
.art-modal-badges{display:flex;flex-wrap:wrap;gap:.45rem;margin-bottom:.75rem;}
.art-modal-title{font-family:'Cinzel',serif;font-size:1.4rem;color:#fff;line-height:1.3;letter-spacing:.04em;}
@media(max-width:540px){.art-modal-title{font-size:1.1rem;}}
.art-modal-close{position:absolute;top:.75rem;right:.75rem;z-index:10;width:34px;height:34px;border-radius:50%;background:rgba(0,0,0,.72);border:none;color:#fff;font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .2s;}
.art-modal-close:hover{background:var(--crimson);}
.art-modal-meta-bar{display:flex;align-items:center;gap:1rem;padding:.9rem 1.8rem;border-bottom:1px solid var(--hr);flex-wrap:wrap;}
.am-av{width:36px;height:36px;border-radius:50%;background:var(--surface2);border:1px solid var(--accent);display:flex;align-items:center;justify-content:center;font-family:'Cinzel',serif;font-size:.78rem;color:var(--accent);flex-shrink:0;}
.am-name{font-family:'Cinzel',serif;font-size:.82rem;color:var(--text);letter-spacing:.05em;}
.am-date{font-size:.78rem;color:var(--text-muted);}
.am-read{font-size:.78rem;color:var(--text-muted);display:flex;align-items:center;gap:.25rem;}
.am-stats{margin-left:auto;display:flex;gap:.9rem;font-size:.82rem;color:var(--text-muted);}
.art-modal-body{padding:1.6rem 1.8rem;}
@media(max-width:540px){.art-modal-body{padding:1.2rem 1.1rem;}}
.art-modal-body p{font-size:1.02rem;line-height:1.85;color:var(--text);margin-bottom:1.1rem;}
.art-modal-body p:last-child{margin-bottom:0;}
.art-modal-body h3{font-family:'Cinzel',serif;font-size:.92rem;color:var(--accent);letter-spacing:.1em;margin-bottom:.6rem;margin-top:1.2rem;}
.art-share-bar{display:flex;align-items:center;justify-content:space-between;padding:.85rem 1.8rem;border-top:1px solid var(--hr);border-bottom:1px solid var(--hr);}
.art-share-label{font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.18em;color:var(--text-muted);text-transform:uppercase;}
.art-share-btns{display:flex;gap:.5rem;}
.art-share-btn{width:36px;height:36px;border-radius:50%;border:1px solid var(--hr);background:var(--surface);display:flex;align-items:center;justify-content:center;font-size:.85rem;cursor:pointer;transition:border-color .2s,transform .15s;color:var(--text-dim);}
.art-share-btn:hover{border-color:var(--accent);transform:scale(1.1);}
.art-comments{padding:1.4rem 1.8rem;}
@media(max-width:540px){.art-comments{padding:1.1rem 1.1rem;}}
.art-comments-title{font-family:'Cinzel',serif;font-size:.95rem;color:var(--accent);letter-spacing:.1em;margin-bottom:1.2rem;display:flex;align-items:center;gap:.5rem;}
.ac{background:var(--surface);border:1px solid var(--hr);border-radius:2px;padding:1rem 1.1rem;margin-bottom:.9rem;}
.ac-top{display:flex;align-items:center;gap:.7rem;margin-bottom:.6rem;flex-wrap:wrap;}
.ac-av{width:32px;height:32px;border-radius:50%;background:var(--surface2);border:1px solid var(--hr);overflow:hidden;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-family:'Cinzel',serif;font-size:.7rem;color:var(--accent);}
.ac-av img{width:100%;height:100%;object-fit:cover;}
.ac-name{font-family:'Cinzel',serif;font-size:.78rem;color:var(--text)!important;}
.ac-date{font-size:.75rem;color:var(--text-muted);margin-left:auto;}
.ac-body{font-size:.95rem;line-height:1.7;color:var(--text-dim);margin-bottom:.55rem;}
.ac-acts{display:flex;gap:.75rem;}
.ac-act{background:none;border:none;font-size:.82rem;color:var(--text-muted);cursor:pointer;padding:0;transition:color .2s;font-family:'Crimson Pro',serif;}
.ac-act:hover{color:var(--accent);}
.ac-role{font-size:.58rem;font-family:'Cinzel',serif;letter-spacing:.1em;padding:.12rem .38rem;margin-left:.4rem;background:rgba(88,101,242,.2);color:#818cf8;border:1px solid rgba(88,101,242,.3);}
.ac-role.staff{background:rgba(201,168,76,.15);color:var(--accent);border-color:rgba(201,168,76,.3);}
.art-comment-form{padding:0 1.8rem 1.8rem;}
@media(max-width:540px){.art-comment-form{padding:0 1.1rem 1.2rem;}}
.art-disc-cta{border:2px dashed var(--accent);padding:1.4rem;text-align:center;}
.art-disc-cta p{font-size:.93rem;color:var(--text-dim);margin-bottom:1rem;}
.art-comment-input{width:100%;background:var(--in-bg);border:1px solid var(--in-border);color:var(--text);font-family:'Crimson Pro',serif;font-size:.97rem;padding:.7rem .95rem;min-height:80px;resize:vertical;transition:border-color .2s;margin-bottom:.75rem;display:block;}
.art-comment-input:focus{outline:none;border-color:var(--accent);}

/* ════════════════════════════════════════
   BACK TO TOP
════════════════════════════════════════ */
#back-to-top{
  position:fixed;bottom:1.8rem;right:1.5rem;z-index:500;
  width:44px;height:44px;
  background:var(--accent);color:var(--bg);
  border:none;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  opacity:0;transform:translateY(12px);
  transition:opacity .3s,transform .3s,background .2s;
  pointer-events:none;
  box-shadow:0 4px 18px rgba(0,0,0,.45);
}
#back-to-top.visible{opacity:1;transform:translateY(0);pointer-events:auto;}
#back-to-top:hover{background:var(--accent2);}

/* ════════════════════════════════════════
   TOAST
════════════════════════════════════════ */
#toast{position:fixed;bottom:5rem;right:1.3rem;z-index:2000;background:var(--surface);border:1px solid var(--accent);padding:.72rem 1.2rem;font-family:'Cinzel',serif;font-size:.68rem;letter-spacing:.07em;color:var(--accent);opacity:0;transform:translateY(8px);transition:opacity .28s,transform .28s;pointer-events:none;max-width:280px;}
#toast.show{opacity:1;transform:translateY(0);}
#toast.err{border-color:var(--crimson-bright);color:var(--crimson-bright);}

/* ════════════════════════════════════════
   MOBILE NAV
════════════════════════════════════════ */
.mob-bar,.mob-drawer,.mob-drawer-ov{display:none;}
.mob-drawer-ov{position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:998;}
.mob-drawer-ov.open{display:block;}
.mob-drawer{position:fixed;top:0;left:0;width:82%;max-width:360px;height:100%;background:var(--bg);border-right:2px solid var(--accent);transform:translateX(-100%);transition:transform .3s ease;z-index:999;display:flex;flex-direction:column;overflow:visible;}
.mob-drawer.open{transform:translateX(0);}
.mob-drawer-hdr{display:flex;justify-content:space-between;align-items:center;padding:1.2rem 1.4rem;border-bottom:1px solid var(--accent);}
.mob-drawer-title{font-family:'Cinzel',serif;font-size:.75rem;letter-spacing:.4em;color:var(--accent);}
.mob-drawer-close{background:none;border:none;color:var(--accent);font-size:1.2rem;cursor:pointer;line-height:1;display:flex;align-items:center;}
.mob-nav-list{list-style:none;padding:0;margin:0;flex:1;overflow-y:auto;overflow-x:visible;}
.mob-nav-item{border-bottom:1px solid rgba(201,168,76,.22);cursor:pointer;}
.mob-nav-label,.mob-nav-row{display:flex;justify-content:space-between;align-items:center;padding:1.2rem 1.4rem;font-family:'Cinzel',serif;font-size:.78rem;letter-spacing:.25em;text-transform:uppercase;color:var(--text-dim);cursor:pointer;}
.mob-nav-item.active{background:rgba(201,168,76,.08);}
.mob-nav-item.active .mob-nav-label{color:var(--accent);}
.mob-nav-arrow{font-size:1rem;transition:transform .2s;}
.mob-nav-item.sub-open .mob-nav-arrow{transform:rotate(180deg);}
.mob-sub-list{display:none;background:var(--bg);}
.mob-sub-item{padding:1rem 2rem;font-family:'Cinzel',serif;font-size:.7rem;letter-spacing:.18em;border-top:1px solid rgba(201,168,76,.15);color:var(--text-muted);cursor:pointer;}
.mob-sub-item:hover{color:var(--accent);}
.mob-drawer-ctrl{border-top:1px solid var(--accent);padding:1.1rem 1.4rem;display:flex;align-items:center;gap:1rem;flex-wrap:wrap;overflow:visible;position:relative;}
@media(max-width:768px){
  #nav{display:none!important;}
  .mob-bar{display:flex!important;position:sticky;top:0;z-index:500;align-items:center;justify-content:space-between;padding:.9rem 1.2rem;background:var(--nav-bg);border-top:2px solid var(--accent);border-bottom:1px solid var(--accent);}
  .mob-bar-label{font-family:'Cinzel',serif;font-size:.7rem;letter-spacing:.35em;color:var(--accent);}
  .mob-menu-btn{background:none;border:1px solid var(--accent);color:var(--accent);padding:.35rem .7rem;font-size:1.1rem;cursor:pointer;display:flex;align-items:center;}
  .mob-menu-btn:hover{background:rgba(201,168,76,.1);}
  .mob-drawer{display:flex!important;}
  .mob-drawer-ov.open{display:block!important;}
  #content{padding:1.6rem .9rem 4rem;}
  .staff-grid{grid-template-columns:repeat(auto-fill,minmax(155px,1fr));}
  .sc img{height:140px;}
  .gal-folders-grid{grid-template-columns:repeat(auto-fill,minmax(165px,1fr));}
  .about-g{gap:1.6rem;}
  .igrid{grid-template-columns:repeat(auto-fit,minmax(140px,1fr));}
}
@media(max-width:560px){
  .nav-in{padding:0 .3rem;}
  .dc-uname{display:none;}
  .au-card{flex-direction:column;}
  .staff-grid{grid-template-columns:repeat(2,1fr);}
  #back-to-top{bottom:1rem;right:1rem;}
}
@media(max-width:380px){
  .staff-grid{grid-template-columns:repeat(2,1fr);}
  .cd-ev{display:none;}
}

/* ── Member-gate form fields disable ── */
.form-member-locked input:not(.th-readonly),
.form-member-locked select,
.form-member-locked textarea,
.form-member-locked .th-img-drop,
.form-member-locked .th-check-row input,
.form-member-locked .th-submit-btn,
.form-member-locked button[type=submit]{
  opacity:.35;
  pointer-events:none;
  user-select:none;
  cursor:not-allowed;
}
.form-gate-banner{
  display:none;
  align-items:center;
  gap:.7rem;
  background:var(--tag-bg);
  border:1px solid var(--accent);
  border-radius:3px;
  padding:.85rem 1.1rem;
  margin-bottom:1rem;
}
.form-gate-banner.visible{ display:flex; }
.form-gate-banner span{ font-family:'Crimson Pro',serif; font-size:.95rem; color:var(--text); }
.form-gate-banner a{ color:var(--accent); text-decoration:underline; }

</style>
</head>
<body>

<!-- ════ SVG ICON SPRITE ════ -->
<svg xmlns="http://www.w3.org/2000/svg" style="display:none" aria-hidden="true">
  <defs>
    <!-- shield -->
    <symbol id="i-shield" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></symbol>
    <!-- message -->
    <symbol id="i-msg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></symbol>
    <!-- alert-triangle -->
    <symbol id="i-warn" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></symbol>
    <!-- ban/slash -->
    <symbol id="i-ban" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></symbol>
    <!-- book-open -->
    <symbol id="i-book" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></symbol>
    <!-- palette -->
    <symbol id="i-palette" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="13.5" cy="6.5" r=".5" fill="currentColor"/><circle cx="17.5" cy="10.5" r=".5" fill="currentColor"/><circle cx="8.5" cy="7.5" r=".5" fill="currentColor"/><circle cx="6.5" cy="12.5" r=".5" fill="currentColor"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/></symbol>
    <!-- globe -->
    <symbol id="i-globe" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></symbol>
    <!-- users -->
    <symbol id="i-users" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></symbol>
    <!-- volume-x -->
    <symbol id="i-volx" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/></symbol>
    <!-- file-text -->
    <symbol id="i-file" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></symbol>
    <!-- bell -->
    <symbol id="i-bell" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></symbol>
    <!-- mail -->
    <symbol id="i-mail" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></symbol>
    <!-- lock -->
    <symbol id="i-lock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></symbol>
    <!-- arrow-up -->
    <symbol id="i-arrowup" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></symbol>
    <!-- arrow-left -->
    <symbol id="i-arrowleft" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></symbol>
    <!-- arrow-right -->
    <symbol id="i-arrowright" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></symbol>
    <!-- folder -->
    <symbol id="i-folder" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></symbol>
    <!-- download -->
    <symbol id="i-dl" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></symbol>
    <!-- x/close -->
    <symbol id="i-x" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></symbol>
    <!-- check -->
    <symbol id="i-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></symbol>
    <!-- star -->
    <symbol id="i-star" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></symbol>
    <!-- image -->
    <symbol id="i-image" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></symbol>
    <!-- newspaper -->
    <symbol id="i-news" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 0-2 2zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/><path d="M18 14h-8"/><path d="M15 18h-5"/><path d="M10 6h8v4h-8V6z"/></symbol>
    <!-- clipboard -->
    <symbol id="i-clip" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></symbol>
    <!-- heart -->
    <symbol id="i-heart" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></symbol>
    <!-- clock -->
    <symbol id="i-clock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></symbol>
    <!-- moon -->
    <symbol id="i-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></symbol>
    <!-- sun -->
    <symbol id="i-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></symbol>
    <!-- user -->
    <symbol id="i-user" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></symbol>
    <!-- menu -->
    <symbol id="i-menu" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></symbol>
    <!-- book (volumes) -->
    <symbol id="i-booksolid" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></symbol>
    <!-- sword (staff) -->
    <symbol id="i-sword" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="14.5 17.5 3 6 3 3 6 3 17.5 14.5"/><line x1="13" y1="19" x2="19" y2="13"/><line x1="16" y1="16" x2="20" y2="20"/><line x1="19" y1="21" x2="21" y2="19"/></symbol>
    <!-- link / handshake -->
    <symbol id="i-link" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></symbol>
    <!-- sparkles/crystal -->
    <symbol id="i-sparkle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3l1.5 4.5L18 9l-4.5 1.5L12 15l-1.5-4.5L6 9l4.5-1.5z"/><path d="M19 15l.75 2.25L22 18l-2.25.75L19 21l-.75-2.25L16 18l2.25-.75z"/><path d="M4 3l.75 2.25L7 6l-2.25.75L4 9l-.75-2.25L1 6l2.25-.75z"/></symbol>
    <!-- archive -->
    <symbol id="i-archive" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="21 8 21 21 3 21 3 8"/><rect x="1" y="3" width="22" height="5"/><line x1="10" y1="12" x2="14" y2="12"/></symbol>
    <!-- twitter/X -->
    <symbol id="i-x-brand" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-4.714-6.231-5.401 6.231H2.748l7.73-8.835L1.254 2.25H8.08l4.26 5.625zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></symbol>
    <!-- instagram -->
    <symbol id="i-insta" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></symbol>
    <!-- facebook -->
    <symbol id="i-fb" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></symbol>
    <!-- reddit -->
    <symbol id="i-reddit" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></symbol>
    <!-- bluesky -->
    <symbol id="i-bsky" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479.815 2.736 3.713 3.66 6.383 3.364.136-.02.275-.039.415-.056-.138.022-.276.04-.415.056-3.912.58-7.387 2.005-2.83 7.078 5.013 5.19 6.87-1.113 7.823-4.308.953 3.195 2.05 9.271 7.733 4.308 4.267-4.308 1.172-6.498-2.74-7.078a8.741 8.741 0 0 1-.415-.056c.14.017.279.036.415.056 2.67.297 5.568-.628 6.383-3.364.246-.828.624-5.79.624-6.478 0-.69-.139-1.861-.902-2.204-.659-.299-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8z"/></symbol>
    <!-- tiktok -->
    <symbol id="i-tiktok" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-2.88 2.5 2.89 2.89 0 0 1-2.89-2.89 2.89 2.89 0 0 1 2.89-2.89c.28 0 .54.04.79.1V9.01a6.33 6.33 0 0 0-.79-.05 6.34 6.34 0 0 0-6.34 6.34 6.34 6.34 0 0 0 6.34 6.34 6.34 6.34 0 0 0 6.33-6.34V8.58a8.22 8.22 0 0 0 4.83 1.55V6.69a4.85 4.85 0 0 1-1.06-.0z"/></symbol>
    <!-- threads -->
    <symbol id="i-threads" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12.186 24h-.007c-3.581-.024-6.334-1.205-8.184-3.509C2.35 18.44 1.5 15.586 1.472 12.01v-.017c.03-3.579.879-6.43 2.525-8.482C5.845 1.205 8.6.024 12.18 0h.014c2.746.02 5.043.725 6.826 2.098 1.677 1.29 2.858 3.13 3.509 5.467l-2.04.569c-1.104-3.96-3.898-5.984-8.304-6.015-2.91.022-5.11.936-6.54 2.717C4.307 6.504 3.616 8.914 3.589 12c.027 3.086.718 5.496 2.057 7.164 1.43 1.783 3.631 2.698 6.54 2.717 2.623-.02 4.358-.631 5.8-2.045 1.647-1.613 1.618-3.593 1.09-4.798-.31-.71-.873-1.3-1.634-1.75-.192 1.352-.622 2.446-1.284 3.272-.886 1.102-2.14 1.704-3.73 1.79-1.202.065-2.361-.218-3.259-.801-1.063-.689-1.685-1.74-1.752-2.964-.065-1.19.408-2.285 1.33-3.082.88-.76 2.119-1.207 3.583-1.291a13.853 13.853 0 0 1 3.02.142c-.126-.742-.375-1.332-.75-1.757-.513-.586-1.308-.883-2.365-.89h-.029c-.78 0-1.896.218-2.584 1.231l-1.64-1.239c.85-1.261 2.282-1.978 4.244-1.978h.044c3.057.019 4.877 1.883 5.002 5.07.509.179.991.42 1.44.724 1.448.998 2.287 2.434 2.408 4.041.201 2.682-.779 5.248-2.961 7.24-1.865 1.717-4.309 2.597-7.382 2.618z"/></symbol>
  </defs>
</svg>

<!-- ════ COUNTDOWN ════ -->
<div id="cd-bar">
  <span class="cd-label">Next Chapter Drop</span>
  <div class="cd-units">
    <div class="cd-unit"><span class="cd-n" id="cd-d">--</span><span class="cd-t">Days</span></div>
    <span class="cd-sep">:</span>
    <div class="cd-unit"><span class="cd-n" id="cd-h">--</span><span class="cd-t">Hrs</span></div>
    <span class="cd-sep">:</span>
    <div class="cd-unit"><span class="cd-n" id="cd-m">--</span><span class="cd-t">Min</span></div>
    <span class="cd-sep">:</span>
    <div class="cd-unit"><span class="cd-n" id="cd-s">--</span><span class="cd-t">Sec</span></div>
  </div>
  <span class="cd-ev">— Chapter Release —</span>
  <button class="cd-x" id="cd-x" aria-label="Close"><svg class="icon icon-sm" style="width:12px;height:12px;"><use href="#i-x"/></svg></button>
</div>

<!-- ════ HEADER ════ -->
<header id="hdr">
  <div class="hdr-inner">
    <div class="glitch-wrap" id="gl">
      <img src="assets/images/logo-en.png" alt="Gokurakugai" class="logo-en-gl" id="logo-main">
      <img src="assets/images/logo-jp.png" alt="極楽街" class="logo-jp-gl" id="logo-jp-gl">
      <div class="gl-r"><img src="assets/images/logo-en.png" alt="" aria-hidden="true"></div>
      <div class="gl-b"><img src="assets/images/logo-en.png" alt="" aria-hidden="true"></div>
    </div>
    <p class="hdr-tag">Fan Community · Est. 2022</p>
  </div>
</header>

<div class="mob-bar" id="mob-bar">
  <span class="mob-bar-label">NAVIGATION</span>
  <button class="mob-menu-btn" id="mob-menu-btn" aria-label="Open navigation">
    <svg class="icon" style="width:20px;height:20px;"><use href="#i-menu"/></svg>
  </button>
</div>

<nav id="nav">
  <div class="nav-in">
    <ul class="nav-tabs">
      <li><a href="#about" class="tab active" data-tab="about">About</a></li>
      <li><a href="#manga" class="tab" data-tab="manga">Manga</a></li>
      <li><a href="#news" class="tab" data-tab="news">News</a></li>
      <li><a href="#theories" class="tab" data-tab="theories">Theories</a></li>
      <li><a href="#rules" class="tab" data-tab="rules">Rules</a></li>
      <li><a href="#info" class="tab" data-tab="info">Info</a></li>
      <li><a href="#staff" class="tab" data-tab="staff">Staff</a></li>
    </ul>
    <div class="nav-ctrl">
      <div class="tt" title="Toggle theme">
        <span class="tt-icon"><svg class="icon" style="width:14px;height:14px;"><use href="#i-moon"/></svg></span>
        <div class="tt-track" id="tt" role="switch" tabindex="0">
          <div class="tt-thumb"></div>
        </div>
        <span class="tt-icon"><svg class="icon" style="width:14px;height:14px;"><use href="#i-sun"/></svg></span>
      </div>
      <div class="dc-zone" id="dc-zone">
        <button id="dc-login-btn" title="Login with Discord">
          <svg viewBox="0 0 71 55" fill="currentColor"><path d="M60.1 4.9A58.5 58.5 0 0 0 45.4.6a.2.2 0 0 0-.2.1c-.6 1.1-1.3 2.5-1.8 3.7a54.1 54.1 0 0 0-16.2 0 38 38 0 0 0-1.8-3.7.22.22 0 0 0-.2-.1A58.4 58.4 0 0 0 10.5 4.9a.2.2 0 0 0-.1.1C1.6 18.1-.9 31 .3 43.6a.2.2 0 0 0 .1.2 58.8 58.8 0 0 0 17.7 8.9.22.22 0 0 0 .2-.1 42 42 0 0 0 3.6-5.9.2.2 0 0 0-.1-.3 38.7 38.7 0 0 1-5.5-2.6.2.2 0 0 1 0-.3l1.1-.9a.2.2 0 0 1 .2 0c11.5 5.3 24 5.3 35.4 0a.2.2 0 0 1 .2 0l1.1.9a.2.2 0 0 1 0 .3 36.1 36.1 0 0 1-5.5 2.6.2.2 0 0 0-.1.3 47.1 47.1 0 0 0 3.6 5.9.2.2 0 0 0 .2.1 58.6 58.6 0 0 0 17.7-8.9.2.2 0 0 0 .1-.2c1.5-14.8-2.5-27.7-10.4-39.1a.2.2 0 0 0-.1-.1zM23.7 36.2c-3.5 0-6.4-3.2-6.4-7.1s2.9-7.1 6.4-7.1c3.5 0 6.4 3.2 6.4 7.1-.1 3.9-2.9 7.1-6.4 7.1zm23.6 0c-3.5 0-6.4-3.2-6.4-7.1s2.9-7.1 6.4-7.1c3.5 0 6.4 3.2 6.4 7.1 0 3.9-2.9 7.1-6.4 7.1z"/></svg>
          <span>Login</span>
        </button>
        <div id="dc-user-wrap">
          <div class="dc-btn" id="dc-btn">
            <div class="dc-av-ph" id="dc-av-ph">?</div>
            <img class="dc-av" id="dc-av-img" src="" alt="" style="display:none">
            <span class="dc-uname" id="dc-uname">User</span>
            <div class="dc-dot" id="dc-dot" style="display:none" title="Server Member"></div>
          </div>
          <!-- Mini dropdown: Profile + Logout only -->
         <div class="dc-dd" id="dc-dd">
  <button class="dc-dd-item" id="dc-profile-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg>Profile</button>
  <div class="dc-dd-sep"></div>
  <button class="dc-dd-item dc-out" id="dc-logout"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>Logout</button>
</div>
        </div>

      </div>
    </div>
  </div>
</nav>

<!-- ════ PROFILE MODAL — lives at body level so position:fixed works correctly
     (backdrop-filter on #nav creates a stacking context that traps fixed children) ════ -->
<div id="prof-ov" onclick="if(event.target===this)closeProfile()">
  <div id="prof-modal">
    <!-- Banner -->
    <div class="pm-banner" id="pm-banner">
      <div class="pm-banner-loading" id="pm-banner-loading"></div>
      <img class="pm-banner-img" id="pm-banner-img" src="" alt="" style="display:none;" crossorigin="anonymous">
      <div class="pm-banner-fallback" id="pm-banner-fallback" style="display:none;">
        <span class="pm-banner-nobanner">No Banner Detected</span>
      </div>
      <button class="pm-close" onclick="closeProfile()" title="Close">✕</button>
    </div>
    <!-- Avatar + member badge row -->
    <div class="pm-av-zone">
      <div class="pm-av-wrap">
        <div class="pm-av" id="pm-av"></div>
        <div class="pm-av-dot" id="pm-av-dot"></div>
      </div>
      <div id="pm-badge-wrap"></div>
    </div>
    <!-- Name block -->
    <div class="pm-body">
      <div class="pm-displayname" id="pm-displayname">—</div>
      <div class="pm-sub">
        <span id="pm-username">@—</span>
        <span class="pm-pipe">|</span>
        <span class="pm-uid" id="pm-uid">—</span>
      </div>
      <div class="pm-divider"></div>
      <!-- Info rows -->
      <div class="pm-info-grid">
        <div class="pm-info-row">
          <div class="pm-info-label">Roles</div>
          <div class="pm-roles-wrap" id="pm-roles">
            <span class="pm-info-val">—</span>
          </div>
        </div>
        <div class="pm-info-row">
          <div class="pm-info-label">Account Created</div>
          <div class="pm-info-val" id="pm-created">—</div>
        </div>
        <div class="pm-info-row">
          <div class="pm-info-label">Joined Server</div>
          <div class="pm-info-val" id="pm-joined">—</div>
        </div>
        <div class="pm-info-row">
          <div class="pm-info-label">Position</div>
          <div class="pm-info-val" id="pm-position">—</div>
        </div>
      </div>
    </div>
    <!-- Footer -->
    <div class="pm-footer">
      <button class="pm-logout-btn" onclick="doLogout();closeProfile();">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        Logout
      </button>
    </div>
  </div>
</div>

<!-- Mobile nav drawer -->
<div class="mob-drawer-ov" id="mob-drawer-ov" onclick="closeMobDrawer()"></div>
<div class="mob-drawer" id="mob-drawer">
  <div class="mob-drawer-hdr">
    <span class="mob-drawer-title">NAVIGATION</span>
    <button class="mob-drawer-close" id="mob-drawer-close" onclick="closeMobDrawer()">
      <svg class="icon" style="width:18px;height:18px;"><use href="#i-x"/></svg>
    </button>
  </div>
  <ul class="mob-nav-list" id="mob-nav-list">
    <li class="mob-nav-item active" data-tab="about"><span class="mob-nav-label">ABOUT</span></li>
    <li class="mob-nav-item has-sub" data-tab="manga">
      <div class="mob-nav-row"><span>MANGA</span><span class="mob-nav-arrow">&#8964;</span></div>
      <ul class="mob-sub-list" id="mob-manga-sub" style="display:none;">
        <li class="mob-sub-item" data-tab="manga" data-sub="gallery">Gallery</li>
        <li class="mob-sub-item" data-tab="manga" data-sub="chars">Characters</li>
      </ul>
    </li>
    <li class="mob-nav-item" data-tab="rules"><span class="mob-nav-label">RULES</span></li>
    <li class="mob-nav-item" data-tab="info"><span class="mob-nav-label">INFO</span></li>
    <li class="mob-nav-item" data-tab="news"><span class="mob-nav-label">NEWS</span></li>
    <li class="mob-nav-item" data-tab="theories"><span class="mob-nav-label">THEORIES</span></li>
    <li class="mob-nav-item" data-tab="staff"><span class="mob-nav-label">STAFF</span></li>
  </ul>
  <div class="mob-drawer-ctrl" id="mob-drawer-ctrl"></div>
</div>

<!-- ════ MAIN ════ -->
<main id="content">

<!-- ══ ABOUT ══ -->
<section id="about" class="sec active">
  <div class="sec-hdr">
    <span class="jp">極楽街へようこそ</span>
    <span class="en">Welcome to Gokurakugai</span>
  </div>
  <div class="sdiv"><span>✦</span></div>
  <div class="about-g">
    <div class="about-text">
      <p class="lead">"In the labyrinthine streets of a crimson city, two unlikely partners navigate the shadows between the living and the damned."</p>
      <p>Welcome to the <strong style="color:var(--accent)">Gokurakugai Fan Community</strong> — your premier destination for everything related to Yuto Sano's thrilling manga series. Whether you're a longtime devotee or just discovering the world of Alma and Tao, you've found your home.</p>
      <p>This community brings together fans from across the globe to discuss, celebrate, and explore the atmospheric underworld of Gokurakugai. Share your theories, connect with fellow fans, and stay updated on all the latest news from the series.</p>
      <div class="qlinks">
        <a href="https://discord.gg/gokurakugai" target="_blank" class="btn btn-p">Join Community</a>
        <a href="https://www.reddit.com/r/Saragi/" target="_blank" class="btn">Reddit</a>
        <a href="https://mangaplus.shueisha.co.jp/titles/100230" target="_blank" class="btn">Read Manga</a>
      </div>
    </div>
    <div class="fbox synopsis">
      <h3>Series Synopsis</h3>
      <p>In <em>Gokurakugai</em>, an unassuming town district harbors a dark secret — a sanctuary where lost souls and sinister entities find refuge. Enter Tao and Alma: a composed, gun-wielding exterminator and her impulsive, demon-blood companion, who together take on supernatural assignments in the district's treacherous underworld.</p>
      <br>
      <p>Part action, part dark fantasy, Yuto Sano's series blends kinetic fight sequences with rich worldbuilding and deeply compelling characters, set against an aesthetic fusing Chinese aesthetics with gritty noir.</p>
    </div>
  </div>
  <div class="orn">❧ Manga Details ❧</div>
  <div class="igrid">
    <div class="ic"><div class="icl">Title</div><div class="icv">Gokurakugai</div></div>
    <div class="ic"><div class="icl">Japanese</div><div class="icv">極楽街</div></div>
    <div class="ic"><div class="icl">Author</div><div class="icv">Yuto Sano</div></div>
    <div class="ic"><div class="icl">Magazine</div><div class="icv">Jump SQ</div></div>
    <div class="ic"><div class="icl">Publisher</div><div class="icv">Shueisha</div></div>
    <div class="ic"><div class="icl">English</div><div class="icv">VIZ Media</div></div>
    <div class="ic"><div class="icl">Genre</div><div class="icv">Action · Dark Fantasy</div></div>
    <div class="ic"><div class="icl">Status</div><div class="icv">Ongoing ✦</div></div>
  </div>
  <div class="orn">❧ Read Online ❧</div>
  <p style="text-align:center;max-width:540px;margin:0 auto 1.4rem;font-size:.97rem;color:var(--text-dim);">Support the official release. Read Gokurakugai through legitimate platforms.</p>
  <div class="read-grid">
    <a href="https://mangaplus.shueisha.co.jp/titles/100230" target="_blank" class="rc">
      <div class="rc-ico"><svg class="icon-md icon-accent"><use href="#i-book"/></svg></div>
      <div><div class="rc-title">Manga Plus</div><div class="rc-sub">Free · Official · English</div></div>
    </a>
    <a href="https://www.viz.com/shonenjump/chapters/gokurakugai" target="_blank" class="rc">
      <div class="rc-ico"><svg class="icon-md icon-accent"><use href="#i-booksolid"/></svg></div>
      <div><div class="rc-title">VIZ Media</div><div class="rc-sub">Official English Release</div></div>
    </a>
    <a href="https://jumpsq.shueisha.co.jp/rensai/gokurakugai/" target="_blank" class="rc">
      <div class="rc-ico"><svg class="icon-md icon-accent"><use href="#i-news"/></svg></div>
      <div><div class="rc-title">Jump SQ</div><div class="rc-sub">Official Japanese</div></div>
    </a>
    <a href="https://jumpsq.shueisha.co.jp/sqrise/2020winter/gokuraku.html" target="_blank" class="rc">
      <div class="rc-ico"><svg class="icon-md icon-accent"><use href="#i-sparkle"/></svg></div>
      <div><div class="rc-title">Original Oneshot</div><div class="rc-sub">Winter 2020 · Jump SQ Rise</div></div>
    </a>
  </div>
  <div class="orn">❧ Community Stats ❧</div>
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon"><svg class="icon-lg icon-accent"><use href="#i-users"/></svg></div>
      <div class="stat-val" id="stat-discord">—</div>
      <div class="stat-label">Discord Members</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><svg class="icon-lg icon-accent"><use href="#i-book"/></svg></div>
      <div class="stat-val" id="stat-chapters">—</div>
      <div class="stat-label">Chapters Released</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><svg class="icon-lg icon-accent"><use href="#i-booksolid"/></svg></div>
      <div class="stat-val" id="stat-volumes">6</div>
      <div class="stat-label">Volumes Published</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><svg class="icon-lg icon-accent"><use href="#i-sword"/></svg></div>
      <div class="stat-val" id="stat-staff">—</div>
      <div class="stat-label">Staff Members</div>
    </div>
  </div>
  <div class="orn">❧ What We Offer ❧</div>
  <div class="offer-grid">
    <div class="offer-card">
      <div class="offer-icon"><svg class="icon-md icon-accent"><use href="#i-msg"/></svg></div>
      <h4>Chapter Discussions</h4>
      <p>Dive into in-depth discussions for every new chapter the moment it drops, with dedicated spoiler-safe channels for every reading pace.</p>
    </div>
    <div class="offer-card">
      <div class="offer-icon"><svg class="icon-md icon-accent"><use href="#i-sparkle"/></svg></div>
      <h4>Fan Theories</h4>
      <p>Submit and explore community fan theories on characters, plot, and hidden symbolism — upvote your favorites and spark new conversations.</p>
    </div>
    <div class="offer-card">
      <div class="offer-icon"><svg class="icon-md icon-accent"><use href="#i-palette"/></svg></div>
      <h4>Fan Art Gallery</h4>
      <p>Browse and share original fan artwork celebrating the world of Gokurakugai, with regular community art contests and showcases.</p>
    </div>
    <div class="offer-card">
      <div class="offer-icon"><svg class="icon-md icon-accent"><use href="#i-news"/></svg></div>
      <h4>News &amp; Updates</h4>
      <p>Stay up to date with the latest official announcements, volume releases, author news, and community milestones all in one place.</p>
    </div>
    <div class="offer-card">
      <div class="offer-icon"><svg class="icon-md icon-accent"><use href="#i-clip"/></svg></div>
      <h4>Community Rules</h4>
      <p>A welcoming, well-moderated space with clear, fair rules enforced by a dedicated volunteer staff team passionate about Gokurakugai.</p>
    </div>
    <div class="offer-card">
      <div class="offer-icon"><svg class="icon-md icon-accent"><use href="#i-heart"/></svg></div>
      <h4>Join the Team</h4>
      <p>Passionate about the series? Apply to join our staff team and help shape the community as a moderator or content creator.</p>
    </div>
  </div>
</section>

<!-- ══ MANGA ══ -->
<section id="manga" class="sec">
  <div class="sec-hdr">
    <span class="jp">極楽街</span>
    <span class="en">Manga</span>
  </div>
  <div class="subnav" id="manga-subnav">
    <button class="sn-btn active" data-sub="gallery" data-parent="manga">Gallery</button>
    <button class="sn-btn" data-sub="chars" data-parent="manga">Characters</button>
  </div>

  <!-- Gallery -->
  <div id="gallery" class="subsec active">
    <h2 class="st">Gallery</h2><p class="st-jp">ギャラリー</p>
    <div class="sdiv"><span>✦</span></div>

    <!-- Folder browser (default view) -->
    <div id="gal-folders-view">
      <p style="text-align:center;font-size:.9rem;color:var(--text-muted);margin-bottom:1.5rem;">Select a folder to browse its images.</p>
      <div class="gal-folders-grid">
        <div class="gal-folder" onclick="openGalFolder('chapter-covers')">
          <div class="gal-folder-icon"><svg class="icon-xl icon-accent"><use href="#i-folder"/></svg></div>
          <div class="gal-folder-name">Chapter Colored Covers</div>
          <div class="gal-folder-count" id="fc-chapter-covers">0 images</div>
        </div>
        <div class="gal-folder" onclick="openGalFolder('volume-covers')">
          <div class="gal-folder-icon"><svg class="icon-xl icon-accent"><use href="#i-folder"/></svg></div>
          <div class="gal-folder-name">Volume Covers</div>
          <div class="gal-folder-count" id="fc-volume-covers">0 images</div>
        </div>
        <div class="gal-folder" onclick="openGalFolder('official-illustrations')">
          <div class="gal-folder-icon"><svg class="icon-xl icon-accent"><use href="#i-folder"/></svg></div>
          <div class="gal-folder-name">Official Illustrations</div>
          <div class="gal-folder-count" id="fc-official-illustrations">0 images</div>
        </div>
        <div class="gal-folder" onclick="openGalFolder('extra-illustrations')">
          <div class="gal-folder-icon"><svg class="icon-xl icon-accent"><use href="#i-folder"/></svg></div>
          <div class="gal-folder-name">Extra Illustrations</div>
          <div class="gal-folder-count" id="fc-extra-illustrations">0 images</div>
        </div>
        <div class="gal-folder" onclick="openGalFolder('magazines')">
          <div class="gal-folder-icon"><svg class="icon-xl icon-accent"><use href="#i-folder"/></svg></div>
          <div class="gal-folder-name">Magazines</div>
          <div class="gal-folder-count" id="fc-magazines">0 images</div>
        </div>
        <div class="gal-folder" onclick="openGalFolder('archived-illustrations')">
          <div class="gal-folder-icon"><svg class="icon-xl icon-accent"><use href="#i-archive"/></svg></div>
          <div class="gal-folder-name">Archived Illustrations</div>
          <div class="gal-folder-count" id="fc-archived-illustrations">0 images</div>
        </div>
      </div>
    </div>

    <!-- Folder inner view -->
    <div id="gal-folder-view" style="display:none;">
      <div class="gal-folder-header">
        <button class="gal-back-btn" onclick="closeGalFolder()">
          <svg class="icon icon-sm"><use href="#i-arrowleft"/></svg> Back
        </button>
        <h3 id="gal-folder-title">Folder Name</h3>
      </div>
      <div id="gal-folder-images">
        <!-- images or empty state rendered by JS -->
      </div>
    </div>
    <p style="text-align:center;margin-top:1.8rem;font-size:.82rem;color:var(--text-muted);font-style:italic;">All artwork © Yuto Sano / Shueisha. Fan use only.</p>
  </div>

  <!-- Characters -->
  <div id="chars" class="subsec">
    <h2 class="st">Characters</h2><p class="st-jp">登場人物</p>
    <div class="sdiv"><span>✦</span></div>
    <div class="ch-grid">
      <div class="ch"><img src="assets/characters/Alma-profile.png" alt="Alma" class="ch-img"><div class="ch-info"><h3>Alma</h3><div class="ct">アルマ</div><p>He has exceptional physical abilities and a huge appetite. He is a "Half-Maga child," born between a human and a monster known as a "Maga," creatures created from the corpses of humans and animals. Just as his heart was on the verge of fully turning into a Maga, Tao found and took him in.</p><span class="ch-tag">Protagonist</span></div></div>
      <div class="ch"><img src="assets/characters/Tao-profile.png" alt="Tao" class="ch-img"><div class="ch-info"><h3>Tao</h3><div class="ct">タオ</div><p>She has a dry, no-nonsense personality and can be terrifying when angry. On the surface, she runs a "problem-solving" business, but behind the scenes, she works as a hitman specializing in eliminating Maga.</p><span class="ch-tag">Protagonist</span></div></div>
      <div class="ch"><img src="assets/characters/Tatsuomi-profile.png" alt="Tatsuomi" class="ch-img"><div class="ch-info"><h3>Tatsuomi</h3><div class="ct">タツオミ</div><p>An informant operating in Gokurakugai, where bizarre incidents constantly occur. His information doesn't come cheap—but since he has a weakness for women, he sells it to Tao at a discount.</p><span class="ch-tag">Supporting</span></div></div>
      <div class="ch"><img src="assets/characters/Nei-profile.png" alt="Nei" class="ch-img"><div class="ch-info"><h3>Nei</h3><div class="ct">ネイ</div><p>A highly skilled young swordswoman affiliated with Saragi. Her blood has a triggering effect on Maga.</p><span class="ch-tag">Supporting</span></div></div>
      <div class="ch"><img src="assets/characters/Yoki-profile.png" alt="Yoki" class="ch-img"><div class="ch-info"><h3>Yoki</h3><div class="ct">ヨキ</div><p>A member of Saragi. A cheerful and kind beastman who crafts weapons for Tao and the others. He's also quite wealthy.</p><span class="ch-tag">Side Character</span></div></div>
      <div class="ch"><img src="assets/characters/Dara-profile.png" alt="Dara" class="ch-img"><div class="ch-info"><h3>Dara</h3><div class="ct">ダラ</div><p>A member of Saragi. She appears cool and composed at first glance, but she's deeply affectionate by nature. Like Yoki, she also crafts weapons for Tao and the others.</p><span class="ch-tag">Side Character</span></div></div>
      <div class="ch"><img src="assets/characters/Seno-profile.png" alt="Seno" class="ch-img"><div class="ch-info"><h3>Ryu Seno</h3><div class="ct">リュウ</div><p>The man who trained Tao and Nei. A strict and unforgiving instructor, yet he has a laid-back side—he loves alcohol and can be quite lazy.</p><span class="ch-tag">Side Character</span></div></div>
      <div class="ch"><img src="assets/characters/Yomi-profile.png" alt="Yomi" class="ch-img"><div class="ch-info"><h3>Yomi</h3><div class="ct">よみ</div><p>A mysterious white-haired young man. He is able to remove the binding stake that restrains Alma—something that only Tao was supposed to be capable of pulling out.</p><span class="ch-tag">Antagonist</span></div></div>
      <div class="ch"><img src="assets/characters/Yoru-profile.png" alt="Yoru" class="ch-img"><div class="ch-info"><h3>Yoru</h3><div class="ct">よる</div><p>The alternate personality of Tao's younger brother, Jin, who had gone missing. Though he takes his own life, he is revived as a Maga through the power of Yomi. He possesses the ability to strangle someone to death without directly touching their neck.</p><span class="ch-tag">Antagonist</span></div></div>
      <div class="ch"><img src="assets/characters/Utsuro-profile.png" alt="Utsuro" class="ch-img"><div class="ch-info"><h3>Utsuro</h3><div class="ct">うつろ</div><p>A Maga who died from blood loss and was revived through the power of Yomi. She has an extremely unstable, clingy personality and falls in love easily.</p><span class="ch-tag">Antagonist</span></div></div>
      <div class="ch"><img src="assets/characters/Shizuka-profile.png" alt="Shizuka" class="ch-img"><div class="ch-info"><h3>Shizuka Kisagaya</h3><div class="ct">きさがや　しずか</div><p>A Maga of crushing death. The one responsible for killing Nei's family. He has a foul mouth toward everyone and an extremely rough, violent personality.</p><span class="ch-tag">Member of Yomi's Family</span></div></div>
    </div>
    <div style="margin-top:1.8rem;padding:.9rem 1.2rem;background:var(--surface);border-left:3px solid var(--accent);font-size:.85rem;color:var(--text-muted);font-style:italic;">✦ Community interpretations only. Official lore belongs to Yuto Sano / Shueisha.</div>
  </div>
</section>

<!-- ══ NEWS ══ -->
<section id="news" class="sec">
  <div class="subnav" id="news-subnav">
    <button class="sn-btn active" data-sub="nfeed" data-parent="news">News</button>
    <button class="sn-btn" data-sub="articles" data-parent="news">Articles</button>
    <button class="sn-btn" data-sub="discussion" data-parent="news">Discussion</button>
  </div>
  <div id="nfeed" class="subsec active">
    <div class="news-page-header">
      <div class="news-jp">ニュース</div>
      <div class="news-en">News &amp; Discussions</div>
      <p class="news-desc">Stay updated with the latest chapter discussions, community announcements, and fan theories from the Gokurakugai community.</p>
    </div>
    <div class="news-filters">
      <button class="nf-btn active" onclick="filterNews(this,'all')">All</button>
      <button class="nf-btn" onclick="filterNews(this,'chapter')">Chapter</button>
      <button class="nf-btn" onclick="filterNews(this,'announcement')">Announcement</button>
      <button class="nf-btn" onclick="filterNews(this,'community')">Community</button>
      <button class="nf-btn" onclick="filterNews(this,'official')">Official</button>
    </div>
    <div class="news-empty" id="news-empty" style="display:none;">
      <div class="news-empty-ico"><svg class="icon-xl" style="color:var(--accent);opacity:.45;"><use href="#i-news"/></svg></div>
      <h3>No Posts Yet</h3>
      <p>Community news and announcements will appear here. Check back soon!</p>
    </div>
    <div class="news-grid-3" id="news-grid"></div>
    <div class="never-miss">
      <div class="nm-icon"><svg class="icon-md"><use href="#i-bell"/></svg></div>
      <h3>Never Miss an Update</h3>
      <p>Join our Discord server for real-time chapter drops, event announcements, and community discussions.</p>
      <a href="https://discord.gg/gokurakugai" target="_blank" class="btn btn-p" style="margin:0 auto;">Join Discord</a>
    </div>
  </div>
  <div id="articles" class="subsec">
    <div class="news-page-header">
      <div class="news-jp">記事</div>
      <div class="news-en">Featured Articles</div>
      <p class="news-desc">In-depth analyses, character studies, and lore explorations written by our community.</p>
    </div>
    <div class="news-empty" id="articles-empty" style="display:none;">
      <div class="news-empty-ico"><svg class="icon-xl" style="color:var(--accent);opacity:.45;"><use href="#i-file"/></svg></div>
      <h3>No Articles Yet</h3>
      <p>Community articles and analyses will appear here.</p>
    </div>
    <div class="news-grid-3" id="articles-grid"></div>
  </div>
  <div id="discussion" class="subsec">
    <div class="news-page-header">
      <div class="news-jp">掲示板</div>
      <div class="news-en">Community Discussion</div>
    </div>
    <div id="disc-gate" class="gate" style="display:none;">
      <div class="gate-ico"><svg class="icon-xl"><use href="#i-lock"/></svg></div>
      <h3>Join the Discord server to comment</h3>
      <p>You must be a verified member of our Discord server to participate in discussions.</p>
      <div style="display:flex;gap:.65rem;justify-content:center;flex-wrap:wrap;">
        <button class="btn btn-dc" onclick="dcLogin()">Login with Discord</button>
        <a href="https://discord.gg/gokurakugai" target="_blank" class="btn">Join Server</a>
      </div>
    </div>
    <div id="disc-post-form" style="display:none;">
      <div class="disc-form-wrap">
        <div class="disc-av-row">
          <div class="disc-form-av" id="disc-form-av"></div>
          <div style="flex:1;">
            <select id="disc-topic" class="disc-select">
              <option value="General">General Discussion</option>
              <option value="Theory">Theory Discussion</option>
              <option value="Chapter">Chapter Talk</option>
              <option value="Fan Art">Fan Art</option>
              <option value="Questions">Questions</option>
            </select>
          </div>
        </div>
        <textarea id="disc-text" class="disc-textarea" placeholder="Share your thoughts with the community..."></textarea>
        <div style="display:flex;justify-content:flex-end;">
          <button class="btn btn-p" onclick="submitDiscussion()">Post</button>
        </div>
      </div>
    </div>
    <div id="disc-posts" class="disc-list"></div>
  </div>
</section>

<!-- ══ THEORIES ══ -->
<section id="theories" class="sec">
  <div class="th-page-header">
    <h2><svg class="icon-md icon-accent"><use href="#i-sparkle"/></svg> Fan Theory Submission</h2>
    <p>Share your theories about Gokurakugai with the community. Character backstories, plot predictions, hidden symbolism — we want to hear your ideas.</p>
  </div>
  <div class="dc-wgt-v2">
    <div class="dc-wgt-v2-left">
      <div class="dc-wgt-v2-title">Gokurakugai Discord Server</div>
      <div class="dc-wgt-v2-count"><span class="od"></span><span id="dc-online-ct">Loading...</span></div>
    </div>
    <a href="https://discord.gg/gokurakugai" target="_blank" class="btn btn-dc" style="flex-shrink:0;">Join Server</a>
  </div>
  <div class="th-guidelines">
    <h3><svg class="icon icon-sm" style="margin-right:.3rem;"><use href="#i-clip"/></svg> Submission Guidelines</h3>
    <ul class="th-gl-list">
      <li>Theories must be original and your own work</li>
      <li>Include evidence from the manga to support your theory</li>
      <li>Mark spoilers appropriately if discussing recent chapters</li>
      <li>Be respectful — no bashing other theories or community members</li>
      <li>Approved theories will be featured in our community discussions</li>
    </ul>
  </div>
  <div id="theory-gate" class="gate" style="display:none;">
    <div class="gate-ico"><svg class="icon-xl"><use href="#i-lock"/></svg></div>
    <h3>Server Members Only</h3>
    <p>Submitting theories is exclusive to members of our Discord server. Join and log in to share your theories!</p>
    <div style="display:flex;gap:.65rem;justify-content:center;flex-wrap:wrap;">
      <button class="btn btn-dc" onclick="dcLogin()">Login with Discord</button>
      <a href="https://discord.gg/gokurakugai" target="_blank" class="btn">Join Server</a>
    </div>
  </div>
  <div id="theory-submit-form" style="display:none;">
    <div class="th-submit-wrap">
      <div class="th-form-title">Submit Your Theory</div>
      <div id="th-member-note" class="form-gate-banner">
        <span>🔒</span>
        <span>Server members only. <a href="https://discord.gg/gokurakugai" target="_blank">Join the Gokurakugai Discord</a> to submit theories.</span>
      </div>
      <div class="th-autofill-notice"><span>✦</span> Your identity is auto-filled from your Discord account</div>
      <div id="th-form-fields">
      <div class="th-form-grid">
        <div class="th-form-group"><label>Display Name</label><input type="text" id="th-displayname" class="th-readonly" readonly placeholder="Auto-filled from Discord"></div>
        <div class="th-form-group"><label>Username</label><input type="text" id="th-username" class="th-readonly" readonly placeholder="Auto-filled from Discord"></div>
      </div>
      <div class="th-form-group"><label>User ID</label><input type="text" id="th-userid" class="th-readonly" readonly placeholder="Auto-filled from Discord" style="font-family:monospace;font-size:.88rem;"></div>
      <div class="th-hr"></div>
      <div style="font-family:'Cinzel',serif;font-size:.82rem;color:var(--accent);letter-spacing:.1em;margin-bottom:1.1rem;">Theory Details</div>
      <div class="th-form-group"><label>Theory Title <span style="color:var(--accent)">*</span></label><input type="text" id="th-title" placeholder="Give your theory a catchy title"></div>
      <div class="th-form-grid">
        <div class="th-form-group"><label>Category <span style="color:var(--accent)">*</span></label>
          <select id="th-tag">
            <option value="">Select a category</option>
            <option>Character Origins</option><option>Plot Predictions</option><option>Power System Analysis</option>
            <option>World Building</option><option>Character Relationships</option><option>Hidden Symbolism</option>
            <option>Villain Theories</option><option>Ending Predictions</option><option>Other</option>
          </select>
        </div>
        <div class="th-form-group"><label>Related Chapters</label><input type="text" id="th-chapters" placeholder="e.g., Ch. 1–5, Ch. 42"></div>
      </div>
      <div class="th-form-group"><label>Your Theory <span style="color:var(--accent)">*</span></label><textarea id="th-body" placeholder="Explain your theory in detail..." oninput="updateCount('th-body','th-body-count',500)"></textarea><div class="th-char-count"><span id="th-body-count">0</span>/500 characters</div></div>
      <div class="th-form-group">
        <label>Supporting Images <span style="color:var(--text-muted);font-size:.82em;font-family:'Crimson Pro',serif;letter-spacing:0;text-transform:none;">(Optional)</span></label>
        <div class="th-img-drop" id="th-img-drop" onclick="document.getElementById('th-images').click()">
          <svg class="icon-md icon-accent" style="margin-bottom:.55rem;"><use href="#i-palette"/></svg>
          <div style="font-family:'Cinzel',serif;font-size:.7rem;letter-spacing:.1em;color:var(--accent);margin-bottom:.2rem;">Click to upload images</div>
          <div style="font-size:.8rem;color:var(--text-muted);">PNG, JPG, WEBP — up to 4 images</div>
          <div id="th-img-preview" style="display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.75rem;justify-content:center;"></div>
        </div>
        <input type="file" id="th-images" multiple accept="image/*" style="display:none" onchange="handleThImgUpload(this)">
        <div id="th-img-names" style="font-size:.76rem;color:var(--text-muted);margin-top:.3rem;font-style:italic;"></div>
      </div>
      <div class="th-hr"></div>
      <div class="th-check-row"><input type="checkbox" id="th-spoilers"><label for="th-spoilers"><span><strong>Contains Spoilers</strong> — Check if discussing recent chapters</span></label></div>
      <div class="th-check-row"><input type="checkbox" id="th-agree"><label for="th-agree"><span><strong>I agree to the community guidelines</strong> <span style="color:var(--accent)">*</span></span></label></div>
      <button class="th-submit-btn" id="th-submit-btn" onclick="submitTheory()"><svg class="icon icon-sm"><use href="#i-arrowright"/></svg> Submit Theory</button>
      </div><!-- /th-form-fields -->
    </div>
  </div>
  <div class="th-popular-title"><svg class="icon-md icon-accent"><use href="#i-star"/></svg> Community Theories</div>
  <div id="theories-empty" style="text-align:center;padding:2.5rem;background:var(--surface);border:1px dashed var(--hr);margin-bottom:1.5rem;">
    <svg class="icon-xl" style="color:var(--accent);opacity:.4;margin-bottom:.6rem;display:block;margin-left:auto;margin-right:auto;"><use href="#i-sparkle"/></svg>
    <p style="font-family:'Cinzel',serif;font-size:.82rem;color:var(--text-muted);letter-spacing:.1em;">No theories yet — be the first to submit one!</p>
  </div>
  <div class="th-grid" id="theories-list"></div>
</section>

<!-- ══ RULES ══ -->
<section id="rules" class="sec">
  <div class="rules-page-hdr">
    <h2>Community Rules</h2>
    <p>To maintain a welcoming and positive environment for all <strong style="color:var(--accent)">Gokurakugai</strong> fans, please follow these community guidelines.</p>
  </div>
  <div class="rules-card-grid">
    <div class="rule-card"><div class="rule-card-icon"><svg class="icon-md"><use href="#i-shield"/></svg></div><div class="rule-card-body"><h4>1. Be Respectful</h4><p>Treat all community members with respect and kindness. Harassment, hate speech, discrimination, or personal attacks of any kind will not be tolerated. We are all here because we love Gokurakugai — and that shared love should bring us together, not divide us. This applies across all platforms and channels, whether you're a new member or a founding one. No rank exempts anyone from basic decency.</p></div></div>
    <div class="rule-card"><div class="rule-card-icon"><svg class="icon-md"><use href="#i-msg"/></svg></div><div class="rule-card-body"><h4>2. Stay On Topic</h4><p>Keep discussions relevant to Gokurakugai and related topics. While off-topic conversations are fine in designated channels, please maintain focus in manga discussion areas. Flooding serious discussion channels with unrelated content makes it harder for members to find what they're looking for and disrupts the community's organization.</p></div></div>
    <div class="rule-card"><div class="rule-card-icon"><svg class="icon-md"><use href="#i-warn"/></svg></div><div class="rule-card-body"><h4>3. No Spoilers Without Warning</h4><p>Always use spoiler tags when discussing recent chapters or plot developments. Not everyone reads at the same pace, and not everyone has access to chapters at the same time globally. Use Discord's ||spoiler tags||, Reddit flair, and clear labels on this site. Members who deliberately spoil content will be treated as violating Rule 1 — ruining someone's experience is a form of disrespect.</p></div></div>
    <div class="rule-card"><div class="rule-card-icon"><svg class="icon-md"><use href="#i-ban"/></svg></div><div class="rule-card-body"><h4>4. No Spam or Self-Promotion</h4><p>Avoid excessive posting, spam, or unsolicited self-promotion. Sharing your Gokurakugai fan content is encouraged in the right channels, but repeatedly dropping links, flooding chat with short messages, or advertising unrelated projects without staff approval is prohibited.</p></div></div>
    <div class="rule-card"><div class="rule-card-icon"><svg class="icon-md"><use href="#i-book"/></svg></div><div class="rule-card-body"><h4>5. Support the Official Release</h4><p>Do not share or request pirated scans, unauthorized translations, or illegal aggregator links. Gokurakugai is an ongoing series whose publication depends on reader engagement with official platforms. Read on Manga Plus (free) or VIZ Media, purchase volumes when you're able.</p></div></div>
    <div class="rule-card"><div class="rule-card-icon"><svg class="icon-md"><use href="#i-palette"/></svg></div><div class="rule-card-body"><h4>6. Credit Artists &amp; Creators</h4><p>Always credit the original artist when sharing fan art — name, link to source, and explicit permission where required. Many artists have requested their work not be reshared without permission; those wishes must be respected. Do not use artwork as avatars or banners without permission.</p></div></div>
    <div class="rule-card"><div class="rule-card-icon"><svg class="icon-md"><use href="#i-globe"/></svg></div><div class="rule-card-body"><h4>7. Keep Content Age-Appropriate</h4><p>All content shared in community spaces must be appropriate for a general audience including members as young as thirteen. Explicit sexual content involving characters is strictly prohibited regardless of perceived character age. Extremely graphic violence beyond the manga's own content is not welcome.</p></div></div>
    <div class="rule-card"><div class="rule-card-icon"><svg class="icon-md"><use href="#i-users"/></svg></div><div class="rule-card-body"><h4>8. Respect Staff Decisions</h4><p>Our administrators and moderators volunteer their time to maintain this space. If staff issue a warning, remove a message, or take moderation action, respect that decision — do not argue publicly, circumvent it, or retaliate. If you genuinely believe a decision was wrong, contact staff privately with a calm, constructive message.</p></div></div>
    <div class="rule-card"><div class="rule-card-icon"><svg class="icon-md"><use href="#i-volx"/></svg></div><div class="rule-card-body"><h4>9. No Divisive Real-World Topics</h4><p>Discussions of real-world politics, political figures, religious doctrine, or other divisive non-manga topics are not appropriate in any community channel. This community exists to be a shared space for all fans regardless of political or ideological background.</p></div></div>
    <div class="rule-card"><div class="rule-card-icon"><svg class="icon-md"><use href="#i-file"/></svg></div><div class="rule-card-body"><h4>10. Platform Terms of Service</h4><p>All members must abide by the Terms of Service of whatever platform they are using — Discord, Reddit, Instagram, Twitter/X, etc. This includes age requirements, prohibited content, and acceptable use policies.</p></div></div>
  </div>
  <div class="consequences-box">
    <div class="consequences-title">Consequences for Rule Violations</div>
    <div class="consequences-grid">
      <div class="cq-item"><div class="cq-icon"><svg class="icon-md"><use href="#i-warn"/></svg></div><div class="cq-title">First Offense</div><div class="cq-body"><strong>Warning:</strong> You will receive a verbal or written warning from moderators explaining the rule violation.</div></div>
      <div class="cq-item"><div class="cq-icon"><svg class="icon-md"><use href="#i-clock"/></svg></div><div class="cq-title">Second Offense</div><div class="cq-body"><strong>Temporary Mute/Ban:</strong> Depending on severity, you may be temporarily muted or banned from the community.</div></div>
      <div class="cq-item"><div class="cq-icon"><svg class="icon-md"><use href="#i-ban"/></svg></div><div class="cq-title">Severe/Repeated</div><div class="cq-body"><strong>Permanent Ban:</strong> Severe violations or repeated offenses will result in permanent removal from the community.</div></div>
    </div>
  </div>
  <div class="strikes-wrap">
    <div class="strikes-title">Detailed Strike System</div>
    <p style="text-align:center;max-width:640px;margin:0 auto 1.4rem;font-size:.95rem;color:var(--text-dim);line-height:1.75;">Strikes are cumulative. Severe violations — including hate speech, doxxing, or targeted harassment — may bypass earlier strikes and result in immediate permanent action.</p>
    <div class="strikes-list">
      <div class="sk"><span class="sk-num s1">Strike 1</span><div class="sk-body"><h4>Mute — 1 to 2 Hours</h4><p>A short mute intended as a pause. Staff will send a direct message explaining the specific rule violated. No further action unless rules are broken again.</p></div></div>
      <div class="sk"><span class="sk-num s2">Strike 2</span><div class="sk-body"><h4>Mute — 6 Hours</h4><p>A formal written warning will accompany this mute, outlining the pattern of behavior and future consequences. The member is expected to acknowledge this warning.</p></div></div>
      <div class="sk"><span class="sk-num s3">Strike 3</span><div class="sk-body"><h4>Mute — 12 Hours</h4><p>The member's behavior is now actively monitored by all staff. Members are strongly urged to reach out to a moderator before the mute expires to discuss next steps constructively.</p></div></div>
      <div class="sk"><span class="sk-num s4">Strike 4</span><div class="sk-body"><h4>Mute or Temporary Ban — 48 Hours</h4><p>Either a 48-hour mute or ban at staff discretion. A full internal review of the member's history is conducted and formal documentation of all prior strikes is issued.</p></div></div>
      <div class="sk s5"><span class="sk-num s5">Strike 5</span><div class="sk-body"><h4>Temporary Ban — 1 Week</h4><p>A one-week ban across all community spaces. During the ban, an administrator will contact the member to evaluate whether continued membership is appropriate.</p></div></div>
      <div class="sk s6"><span class="sk-num s6">Strike 6</span><div class="sk-body"><h4>Permanent Ban — No Appeal</h4><p>A permanent ban from all community spaces with no possibility of appeal. Requires full moderation team consensus. All such bans are documented internally.</p></div></div>
    </div>
  </div>
  <div style="padding:1.1rem 1.5rem;background:var(--surface);border:1px solid var(--accent);text-align:center;margin-bottom:1.5rem;">
    <p style="font-family:'Cinzel',serif;font-size:.68rem;letter-spacing:.14em;color:var(--accent);margin-bottom:.45rem;">IMPORTANT NOTICE</p>
    <p style="font-size:.95rem;line-height:1.75;color:var(--text-dim);">If a rule is broken in any channel that isn't being actively moderated, <strong style="color:var(--accent)">please notify any Admin or Moderator immediately</strong>. Do not handle the situation yourself. We will investigate and respond as quickly as possible.</p>
  </div>
  <div class="questions-box">
    <div class="qb-icon"><svg class="icon-xl"><use href="#i-mail"/></svg></div>
    <div class="qb-title">Questions or Concerns?</div>
    <div class="qb-body">If you have questions about these rules or need to report a violation, please contact our moderation team. We are here to help maintain a positive community for all <strong style="color:var(--accent)">Gokurakugai</strong> fans.</div>
    <a href="https://discord.gg/gokurakugai" target="_blank" class="btn btn-p" style="position:relative;">Contact Moderators</a>
  </div>
</section>

<!-- ══ INFO ══ -->
<section id="info" class="sec">
  <div class="sec-hdr">
    <span class="jp">コミュニティ情報</span>
    <span class="en">Community Info</span>
  </div>
  <div class="sdiv"><span>✦</span></div>
  <div class="orn">❧ About the Author ❧</div>
  <div class="au-card" style="margin-bottom:2.5rem;">
    <img src="assets/images/yuto-sano.jpg" alt="Yuto Sano" class="au-img" id="au-img">
    <div class="au-info">
      <h3>Yuto Sano</h3>
      <div class="au-jp">佐野勇斗</div>
      <p><b>Yuto Sano</b> <i>(佐乃夕斗 Sano Yūto)</i>, the creator behind the <em>Gokurakugai</em> manga series, gained recognition as the winner of the 2017 Gessan Newcomer Award Winter Season when they were just 20 years old. Their notable accomplishment includes publishing the oneshot <em>Gokurakugai: Trouble on Third Avenue</em>, which laid the foundation for the ongoing serialized monthly series <em>Gokurakugai</em>, under Jump SQ.</p>
      <div style="display:flex;gap:.65rem;flex-wrap:wrap;">
        <a href="https://www.instagram.com/yuto__sano" target="_blank" class="btn btn-sm"><svg class="icon icon-sm"><use href="#i-insta"/></svg> Instagram</a>
        <a href="https://x.com/Yuto___Sano" target="_blank" class="btn btn-sm"><svg class="icon icon-sm"><use href="#i-x-brand"/></svg> Twitter / X</a>
      </div>
    </div>
  </div>
  <div class="orn">❧ Community Platforms ❧</div>
  <div class="ls-sec">
    <h3>Official Community</h3>
    <div class="sl-grid">
      <a href="https://x.com/gokurakugainews" target="_blank" class="sl"><span class="sl-ico"><svg class="icon" style="width:1.1rem;height:1.1rem;"><use href="#i-x-brand"/></svg></span><div><div class="sl-name">Twitter / X</div><div class="sl-sub">@gokurakugainews</div></div></a>
      <a href="https://x.com/i/communities/1923913403464286699" target="_blank" class="sl"><span class="sl-ico"><svg class="icon" style="width:1.1rem;height:1.1rem;"><use href="#i-users"/></svg></span><div><div class="sl-name">X Community</div><div class="sl-sub">Join our Community</div></div></a>
      <a href="https://www.facebook.com/gokurakugai" target="_blank" class="sl"><span class="sl-ico"><svg class="icon icon-fill" style="width:1.1rem;height:1.1rem;"><use href="#i-fb"/></svg></span><div><div class="sl-name">Facebook Page</div><div class="sl-sub">/gokurakugai</div></div></a>
      <a href="https://www.facebook.com/groups/gokurakugai" target="_blank" class="sl"><span class="sl-ico"><svg class="icon icon-fill" style="width:1.1rem;height:1.1rem;"><use href="#i-fb"/></svg></span><div><div class="sl-name">Facebook Group</div><div class="sl-sub">/groups/gokurakugai</div></div></a>
      <a href="https://www.instagram.com/gokurakugaiwiki" target="_blank" class="sl"><span class="sl-ico"><svg class="icon" style="width:1.1rem;height:1.1rem;"><use href="#i-insta"/></svg></span><div><div class="sl-name">Instagram</div><div class="sl-sub">@gokurakugaiwiki</div></div></a>
      <a href="https://bsky.app/profile/gokurakugai.bsky.social" target="_blank" class="sl"><span class="sl-ico"><svg class="icon icon-fill" style="width:1.1rem;height:1.1rem;"><use href="#i-bsky"/></svg></span><div><div class="sl-name">Bluesky</div><div class="sl-sub">@gokurakugai.bsky.social</div></div></a>
      <a href="https://www.threads.com/@gokurakugaiwiki" target="_blank" class="sl"><span class="sl-ico"><svg class="icon icon-fill" style="width:1.1rem;height:1.1rem;"><use href="#i-threads"/></svg></span><div><div class="sl-name">Threads</div><div class="sl-sub">@gokurakugaiwiki</div></div></a>
      <a href="https://www.tiktok.com/@gokurakugai" target="_blank" class="sl"><span class="sl-ico"><svg class="icon icon-fill" style="width:1.1rem;height:1.1rem;"><use href="#i-tiktok"/></svg></span><div><div class="sl-name">TikTok</div><div class="sl-sub">@gokurakugai</div></div></a>
      <a href="https://www.reddit.com/r/Saragi/" target="_blank" class="sl"><span class="sl-ico"><svg class="icon icon-fill" style="width:1.1rem;height:1.1rem;"><use href="#i-reddit"/></svg></span><div><div class="sl-name">Reddit</div><div class="sl-sub">r/Saragi</div></div></a>
    </div>
  </div>
  <div class="orn">❧ Official Manga ❧</div>
  <div class="ls-sec">
    <h3>Read Official</h3>
    <div class="sl-grid">
      <a href="https://jumpsq.shueisha.co.jp/sqrise/2020winter/gokuraku.html" target="_blank" class="sl"><span class="sl-ico"><svg class="icon" style="width:1.1rem;height:1.1rem;"><use href="#i-sparkle"/></svg></span><div><div class="sl-name">Original Oneshot</div><div class="sl-sub">Jump SQ Rise, 2020</div></div></a>
      <a href="https://jumpsq.shueisha.co.jp/rensai/gokurakugai/" target="_blank" class="sl"><span class="sl-ico"><svg class="icon" style="width:1.1rem;height:1.1rem;"><use href="#i-news"/></svg></span><div><div class="sl-name">Jump Square</div><div class="sl-sub">Official JP Serialization</div></div></a>
      <a href="https://www.viz.com/shonenjump/chapters/gokurakugai" target="_blank" class="sl"><span class="sl-ico"><svg class="icon" style="width:1.1rem;height:1.1rem;"><use href="#i-globe"/></svg></span><div><div class="sl-name">VIZ Media</div><div class="sl-sub">Official English</div></div></a>
      <a href="https://mangaplus.shueisha.co.jp/titles/100230" target="_blank" class="sl"><span class="sl-ico"><svg class="icon" style="width:1.1rem;height:1.1rem;"><use href="#i-book"/></svg></span><div><div class="sl-name">Manga Plus</div><div class="sl-sub">Free · Official · English</div></div></a>
    </div>
  </div>
</section>

<!-- ══ STAFF ══ -->
<section id="staff" class="sec">
  <div class="sec-hdr">
    <span class="jp">スタッフ紹介</span>
    <span class="en">Our Staff</span>
    <span class="sub">Meet the dedicated volunteers behind the Gokurakugai Fan Community. Click any card to view their full profile.</span>
  </div>
  <div class="sdiv"><span>✦</span></div>
  <div class="orn">❧ Administration ❧</div>
  <div class="staff-grid">
    <div class="sc" onclick="openModal('m1')"><div class="sc-av-wrap" id="sc-av-m1"><span class="sc-av-initials">R</span><div class="sc-status-dot" id="sc-dot-m1"></div></div><div class="sc-body"><div class="sc-role">Founder · Administrator</div><div class="sc-name">RION</div><div class="sc-handle">@jetnoire</div></div><button class="sc-view">View Profile</button></div>
    <div class="sc" onclick="openModal('m2')"><div class="sc-av-wrap" id="sc-av-m2"><span class="sc-av-initials">A</span><div class="sc-status-dot" id="sc-dot-m2"></div></div><div class="sc-body"><div class="sc-role">Administrator</div><div class="sc-name">ANDY</div><div class="sc-handle">@resoluteroyalty</div></div><button class="sc-view">View Profile</button></div>
    <div class="sc" onclick="openModal('m3')"><div class="sc-av-wrap" id="sc-av-m3"><span class="sc-av-initials">T</span><div class="sc-status-dot" id="sc-dot-m3"></div></div><div class="sc-body"><div class="sc-role">Administrator</div><div class="sc-name">TORTOL</div><div class="sc-handle">@tortilinni</div></div><button class="sc-view">View Profile</button></div>
    <div class="sc" onclick="openModal('m4')"><div class="sc-av-wrap" id="sc-av-m4"><span class="sc-av-initials">R</span><div class="sc-status-dot" id="sc-dot-m4"></div></div><div class="sc-body"><div class="sc-role">Administrator</div><div class="sc-name">rwottenhrts</div><div class="sc-handle">@rwottenhrts</div></div><button class="sc-view">View Profile</button></div>
    <div class="sc" onclick="openModal('m5')"><div class="sc-av-wrap" id="sc-av-m5"><span class="sc-av-initials">N</span><div class="sc-status-dot" id="sc-dot-m5"></div></div><div class="sc-body"><div class="sc-role">Administrator</div><div class="sc-name">NAZARETH</div><div class="sc-handle">@thenazar3th</div></div><button class="sc-view">View Profile</button></div>
  </div>
  <div class="orn">❧ Moderation Team ❧</div>
  <div class="staff-grid">
    <div class="sc" onclick="openModal('m6')"><div class="sc-av-wrap" id="sc-av-m6"><span class="sc-av-initials">A</span><div class="sc-status-dot" id="sc-dot-m6"></div></div><div class="sc-body"><div class="sc-role">Moderator</div><div class="sc-name">AKKI</div><div class="sc-handle">@siakki</div></div><button class="sc-view">View Profile</button></div>
    <div class="sc" onclick="openModal('m7')"><div class="sc-av-wrap" id="sc-av-m7"><span class="sc-av-initials">M</span><div class="sc-status-dot" id="sc-dot-m7"></div></div><div class="sc-body"><div class="sc-role">Moderator</div><div class="sc-name">MOON</div><div class="sc-handle">@vyrmoon</div></div><button class="sc-view">View Profile</button></div>
    <div class="sc" onclick="openModal('m8')"><div class="sc-av-wrap" id="sc-av-m8"><span class="sc-av-initials">S</span><div class="sc-status-dot" id="sc-dot-m8"></div></div><div class="sc-body"><div class="sc-role">Moderator</div><div class="sc-name">SPRING</div><div class="sc-handle">@userspring</div></div><button class="sc-view">View Profile</button></div>
    <div class="sc" onclick="openModal('m9')"><div class="sc-av-wrap" id="sc-av-m9"><span class="sc-av-initials">A</span><div class="sc-status-dot" id="sc-dot-m9"></div></div><div class="sc-body"><div class="sc-role">Trial Moderator</div><div class="sc-name">ARABELLA</div><div class="sc-handle">@ara679</div></div><button class="sc-view">View Profile</button></div>
  </div>

  <!-- Join Staff -->
  <div class="sdiv" style="margin-top:2.5rem;"><span>✦</span></div>
  <div class="sec-hdr" style="padding-top:1rem;">
    <span class="jp">スタッフ募集</span>
    <span class="en">Join the Staff Team</span>
    <span class="sub">We're always looking for passionate fans to help manage and grow the Gokurakugai community. <strong style="color:var(--accent)">You must be a Discord server member to apply.</strong></span>
  </div>
  <div class="apply-wrap">
    <div id="apply-gate" class="gate" style="display:none">
      <div class="gate-ico"><svg class="icon-xl"><use href="#i-lock"/></svg></div>
      <h3>Discord Login Required</h3>
      <p>To submit a staff application, you must be logged in with Discord and be a member of our server.</p>
      <div style="display:flex;gap:.65rem;justify-content:center;flex-wrap:wrap;">
        <button class="btn btn-dc" onclick="dcLogin()">Login with Discord</button>
        <a href="https://discord.gg/gokurakugai" target="_blank" class="btn">Join Server First</a>
      </div>
    </div>
    <form id="apply-form" class="af" onsubmit="submitApplication(event)">
      <div class="fbox" style="margin-bottom:1.8rem;padding:1.2rem 1.5rem;">
        <p style="font-size:.9rem;color:var(--text-dim);line-height:1.72;">Your application will be submitted to our private staff channel on Discord. Please answer all questions thoroughly — we value depth over brevity. Review time is typically 1–2 weeks.</p>
      </div>
      <div id="apply-member-note" class="form-gate-banner">
        <span>🔒</span>
        <span>Server members only. <a href="https://discord.gg/gokurakugai" target="_blank">Join the Gokurakugai Discord</a> to apply for staff.</span>
      </div>
      <div class="th-autofill-notice" style="margin-bottom:1.2rem;"><span>✦</span> Your identity is auto-filled from your Discord account</div>
      <div id="af-form-fields">
      <div class="fg" style="margin-bottom:1rem;">
        <div class="fr"><label>Display Name</label><input type="text" id="af-displayname" class="th-readonly" readonly placeholder="Auto-filled from Discord"></div>
        <div class="fr"><label>Username</label><input type="text" id="af-username" class="th-readonly" readonly placeholder="Auto-filled from Discord"></div>
      </div>
      <div class="fr" style="margin-bottom:1.4rem;"><label>User ID</label><input type="text" id="af-userid" class="th-readonly" readonly placeholder="Auto-filled from Discord" style="font-family:monospace;font-size:.9rem;"></div>
      <div style="border-top:1px solid var(--hr);margin-bottom:1.4rem;"></div>
      <div class="fg">
        <div class="fr"><label>Discord Username *</label><input type="text" id="af-disc" placeholder="e.g. username#0000" required></div>
        <div class="fr"><label>Age *</label><input type="number" id="af-age" placeholder="Must be 15+" min="15" required></div>
      </div>
      <div class="fg">
        <div class="fr"><label>Timezone *</label><input type="text" id="af-tz" placeholder="e.g. UTC+8 / JST" required></div>
        <div class="fr"><label>Position Applying For *</label>
          <select id="af-pos" required>
            <option value="">— Select a role —</option>
            <option>Moderator</option><option>Senior Moderator</option><option>Content Creator</option>
            <option>Social Media Manager</option><option>Event Coordinator</option><option>Translator</option>
          </select>
        </div>
      </div>
      <div class="fr"><label>How long have you been a member? *</label>
        <select id="af-tenure" required>
          <option value="">— Select —</option>
          <option>Less than 1 month</option><option>1–3 months</option><option>3–6 months</option>
          <option>6–12 months</option><option>Over 1 year</option>
        </select>
      </div>
      <div class="fr"><label>Hours per week available? *</label>
        <select id="af-hours" required>
          <option value="">— Select —</option>
          <option>1–3 hours</option><option>4–7 hours</option><option>8–14 hours</option><option>15+ hours</option>
        </select>
      </div>
      <div class="fr"><label>Prior moderation or community experience? *</label><textarea id="af-exp" placeholder="Describe any previous experience. If none, say so — it won't disqualify you." required></textarea></div>
      <div class="fr"><label>Why do you want to join the staff team? *</label><textarea id="af-why" placeholder="Tell us why you're passionate about this community..." required></textarea></div>
      <div class="fr"><label>How would you handle two members arguing aggressively in a public channel? *</label><textarea id="af-scenario" placeholder="Walk us through your step-by-step approach..." required></textarea></div>
      <div class="fr"><label>Anything else you'd like us to know?</label><textarea id="af-extra" placeholder="Optional — additional information or context..."></textarea></div>
      <div style="display:flex;gap:.8rem;flex-wrap:wrap;align-items:center;">
      </div><!-- /af-form-fields -->
        <button type="submit" id="af-submit-btn" class="btn btn-p">Submit Application</button>
        <span style="font-size:.82rem;color:var(--text-muted);font-style:italic;">Sent directly to our Discord staff channel.</span>
      </div>
    </form>
    <div class="apply-ok" id="apply-ok">
      <div class="ao-ico"><svg class="icon-xl"><use href="#i-check"/></svg></div>
      <h3>Application Submitted!</h3>
      <p>Thank you for applying to join the Gokurakugai staff team. We review all applications carefully and will reach out to you via Discord within 1–2 weeks.</p>
    </div>
  </div>
</section>

</main>

<!-- ════ DISCORD-STYLE STAFF MODAL ════ -->
<div class="dc-modal-ov" id="dc-modal-ov" onclick="closeModalOutside(event)">
  <div class="dc-staff-modal" id="dc-staff-modal">
    <!-- Banner -->
    <div class="dc-sm-banner" id="dc-sm-banner">
      <div class="dc-sm-banner-loading" id="dc-sm-banner-loading"></div>
      <img id="dc-sm-banner-real" src="" alt="" class="dc-sm-banner-real" style="display:none;" crossorigin="anonymous">
      <div class="dc-sm-banner-fallback" id="dc-sm-banner-fallback" style="display:none;">
        <span class="dc-sm-banner-nobanner">No Banner Detected</span>
      </div>
    </div>
    <button class="dc-sm-close" onclick="closeModal()"><svg class="icon" style="width:14px;height:14px;"><use href="#i-x"/></svg></button>
    <!-- Avatar + badges row -->
    <div class="dc-sm-avatar-row">
      <div class="dc-sm-avatar-wrap">
        <div class="dc-sm-avatar" id="dc-sm-avatar"></div>
        <div class="dc-sm-status-dot" id="dc-sm-status-dot"></div>
      </div>
      <div class="dc-sm-badges" id="dc-sm-badges"></div>
    </div>
    <!-- Body -->
    <div class="dc-sm-body">
      <div class="dc-sm-name" id="dc-sm-name"></div>
      <div class="dc-sm-handle-row">
        <span class="dc-sm-handle" id="dc-sm-handle"></span>
        <span class="dc-sm-uid" id="dc-sm-uid"></span>
      </div>
      <div class="dc-sm-divider"></div>
      <!-- Roles -->
      <div class="dc-sm-field">
        <span class="dc-sm-label">Roles</span>
        <div class="dc-sm-roles" id="dc-sm-roles"></div>
      </div>
      <div class="dc-sm-divider"></div>
      <!-- Meta: Account Created / Joined Server / Position -->
      <div class="dc-sm-field">
        <div class="dc-sm-meta-grid" id="dc-sm-meta-grid">
          <div class="dc-sm-meta-item">
            <div class="dc-sm-meta-label">Account Created</div>
            <div class="dc-sm-meta-val" id="dc-sm-created">—</div>
          </div>
          <div class="dc-sm-meta-item">
            <div class="dc-sm-meta-label">Joined Server</div>
            <div class="dc-sm-meta-val" id="dc-sm-joined">—</div>
          </div>
          <div class="dc-sm-meta-item">
            <div class="dc-sm-meta-label">Position</div>
            <div class="dc-sm-meta-val" id="dc-sm-position">—</div>
          </div>
        </div>
      </div>
      <div class="dc-sm-divider"></div>
      <!-- About Me -->
      <div class="dc-sm-field">
        <span class="dc-sm-label">About Me</span>
        <div class="dc-sm-val" id="dc-sm-about"></div>
      </div>
    </div>
  </div>
</div>

<!-- ════ GALLERY LIGHTBOX ════ -->
<div class="gal-lightbox-ov" id="gal-lightbox-ov">
  <div class="gal-lightbox">
    <button class="gal-lb-close" onclick="closeLightbox()"><svg class="icon icon-sm"><use href="#i-x"/></svg></button>
    <button class="gal-lb-prev" id="gal-lb-prev" onclick="lbNav(-1)"><svg class="icon"><use href="#i-arrowleft"/></svg></button>
    <button class="gal-lb-next" id="gal-lb-next" onclick="lbNav(1)"><svg class="icon"><use href="#i-arrowright"/></svg></button>
    <div class="gal-lb-img-wrap">
      <img id="gal-lb-img" src="" alt="">
    </div>
    <div class="gal-lb-info">
      <div class="gal-lb-title" id="gal-lb-title"></div>
      <div class="gal-lb-downloads">
        <span class="gal-lb-dl-label">Download:</span>
        <button class="gal-lb-dl-btn" onclick="lbDownload('high')"><svg class="icon icon-sm"><use href="#i-dl"/></svg> High</button>
        <button class="gal-lb-dl-btn" onclick="lbDownload('medium')"><svg class="icon icon-sm"><use href="#i-dl"/></svg> Medium</button>
        <button class="gal-lb-dl-btn" onclick="lbDownload('low')"><svg class="icon icon-sm"><use href="#i-dl"/></svg> Low</button>
      </div>
      <div class="gal-lb-counter" id="gal-lb-counter"></div>
    </div>
  </div>
</div>

<!-- ════ ARTICLE MODAL ════ -->
<div class="art-modal-ov" id="art-modal-ov" onclick="closeArtModalOutside(event)">
  <div class="art-modal" id="art-modal-box">
    <button class="art-modal-close" onclick="closeArtModal()"><svg class="icon" style="width:14px;height:14px;"><use href="#i-x"/></svg></button>
    <div class="art-modal-hero">
      <div class="art-modal-hero-bg" id="am-hero-bg"></div>
      <div class="art-modal-hero-overlay"></div>
      <div class="art-modal-hero-content">
        <div class="art-modal-badges" id="am-badges"></div>
        <div class="art-modal-title" id="am-title"></div>
      </div>
    </div>
    <div class="art-modal-meta-bar">
      <div class="am-av" id="am-av">?</div>
      <div><div class="am-name" id="am-name"></div><div class="am-date" id="am-date"></div></div>
      <div class="am-read" id="am-read"></div>
      <div class="am-stats" id="am-stats"></div>
    </div>
    <div class="art-modal-body" id="am-body"></div>
    <div class="art-share-bar">
      <span class="art-share-label">Share This Post</span>
      <div class="art-share-btns">
        <button class="art-share-btn" title="Share on X"><svg class="icon icon-sm icon-fill"><use href="#i-x-brand"/></svg></button>
        <button class="art-share-btn" title="Share on Discord"><svg class="icon icon-sm" style="width:14px;height:14px;"><use href="#i-link"/></svg></button>
        <button class="art-share-btn" title="Copy link" onclick="showToast('Link copied!')"><svg class="icon icon-sm"><use href="#i-link"/></svg></button>
      </div>
    </div>
    <div class="art-comments" id="am-comments-wrap">
      <div class="art-comments-title" id="am-comments-title">Comments</div>
      <div id="am-comments-list"></div>
    </div>
    <div class="art-comment-form" id="am-comment-form"></div>
  </div>
</div>

<!-- ════ BACK TO TOP ════ -->
<button id="back-to-top" aria-label="Back to top" onclick="window.scrollTo({top:0,behavior:'smooth'})">
  <svg class="icon" style="width:20px;height:20px;"><use href="#i-arrowup"/></svg>
</button>

<!-- ════ TOAST ════ -->
<div id="toast"></div>

<!-- ════ FOOTER ════ -->
<footer id="ft">
  <div class="ft-grid">
    <div class="ft-col">
      <div class="ft-col-brand">GOKURAKUGAI</div>
      <p class="ft-col-desc">A fan community dedicated to Gokurakugai by Yuto Sano. This is an unofficial fan site. All rights to the manga belong to the author and publishers.</p>
    </div>
    <div class="ft-col">
      <div class="ft-col-title">Community Links</div>
      <ul>
        <li><a href="https://x.com/gokurakugainews" target="_blank">Twitter</a></li>
        <li><a href="https://x.com/i/communities/1923913403464286699" target="_blank">Twitter Community</a></li>
        <li><a href="https://www.facebook.com/gokurakugai" target="_blank">Facebook</a></li>
        <li><a href="https://www.facebook.com/groups/gokurakugai" target="_blank">Facebook Group</a></li>
        <li><a href="https://www.instagram.com/gokurakugaiwiki" target="_blank">Instagram</a></li>
        <li><a href="https://bsky.app/profile/gokurakugai.bsky.social" target="_blank">Bluesky</a></li>
        <li><a href="https://www.threads.com/@gokurakugaiwiki" target="_blank">Threads</a></li>
        <li><a href="https://www.tiktok.com/@gokurakugai" target="_blank">TikTok</a></li>
        <li><a href="https://www.reddit.com/r/Saragi/" target="_blank">Reddit</a></li>
      </ul>
    </div>
    <div class="ft-col">
      <div class="ft-col-title">Official Manga</div>
      <ul>
        <li><a href="https://jumpsq.shueisha.co.jp/sqrise/2020winter/gokuraku.html" target="_blank">Oneshot (SQ Rise)</a></li>
        <li><a href="https://jumpsq.shueisha.co.jp/rensai/gokurakugai/" target="_blank">Serialization (Jump SQ)</a></li>
        <li><a href="https://www.viz.com/shonenjump/chapters/gokurakugai" target="_blank">VIZ Media</a></li>
        <li><a href="https://mangaplus.shueisha.co.jp/titles/100230" target="_blank">MANGA Plus</a></li>
      </ul>
    </div>
    <div class="ft-col">
      <div class="ft-col-title">Author – Yuto Sano</div>
      <ul style="margin-bottom:1.4rem;">
        <li><a href="https://www.instagram.com/yuto__sano" target="_blank">Instagram</a></li>
        <li><a href="https://x.com/Yuto___Sano" target="_blank">Twitter/X</a></li>
      </ul>
      <div class="ft-disc-label">Discord Server</div>
      <a href="https://discord.gg/gokurakugai" target="_blank" class="ft-disc-btn">Join Server</a>
    </div>
  </div>
  <div class="ft-divider"></div>
  <div class="ft-bottom">
    <p class="ft-copy">© 2026 Gokurakugai Fan Community. This is a fan-made site. Gokurakugai © Yuto Sano / Shueisha.</p>
    <p class="ft-rights">All rights reserved to their respective owners.</p>
  </div>
</footer>

<script>
/* ════════════════════════════════════════
   CONFIG
════════════════════════════════════════ */
const CFG = {
  DISCORD_CLIENT_ID: '1472093876369100820',
  GUILD_ID: '995737046725443686',
  WIDGET_API: 'https://discord.com/api/guilds/995737046725443686/widget.json',
  WEBHOOK_URL: 'YOUR_WEBHOOK_URL_HERE',
  // Cloudflare Worker proxy — replace after deploying worker.js
  PROXY_URL: 'https://gkg-discord.gokurakugai.workers.dev',
};

/* ════ THEME ════ */
const html = document.documentElement;
const tt = document.getElementById('tt');
function setTheme(t){ html.setAttribute('data-theme',t); localStorage.setItem('gkg-theme',t); }
function toggleTheme(){ setTheme(html.getAttribute('data-theme')==='dark'?'light':'dark'); }
tt.addEventListener('click',toggleTheme);
tt.addEventListener('keydown',e=>{ if(e.key==='Enter'||e.key===' '){e.preventDefault();tt.click();}});
setTheme(localStorage.getItem('gkg-theme')||'dark');

/* ════ COUNTDOWN ════ */
(function(){
  const bar=document.getElementById('cd-bar');
  document.getElementById('cd-x').addEventListener('click',()=>bar.classList.add('hidden'));
  const BASE_CHAPTER=34, BASE_DATE_JST=new Date('2024-03-04T00:00:00+09:00');
  function getNextTarget(){
    const nowUTC=Date.now();
    const nowJST=new Date(nowUTC+9*3600*1000);
    let y=nowJST.getUTCFullYear(), mo=nowJST.getUTCMonth();
    let candidate=new Date(Date.UTC(y,mo,4)-9*3600*1000);
    if(nowUTC>=candidate.getTime()+24*3600*1000){ mo++; if(mo>11){mo=0;y++;} candidate=new Date(Date.UTC(y,mo,4)-9*3600*1000); }
    const monthsDiff=(y-BASE_DATE_JST.getUTCFullYear())*12+(mo-BASE_DATE_JST.getUTCMonth());
    const chapterNum=BASE_CHAPTER+monthsDiff;
    return{target:candidate,chapter:chapterNum,isReleased:(nowUTC>=candidate.getTime()&&nowUTC<candidate.getTime()+24*3600*1000)};
  }
  const labelEl=document.querySelector('.cd-label');
  function tick(){
    const{target,chapter,isReleased}=getNextTarget();
    if(isReleased){ if(labelEl)labelEl.textContent=`Chapter ${chapter} — RELEASED!`; ['cd-d','cd-h','cd-m','cd-s'].forEach(id=>document.getElementById(id).textContent='✦✦'); return; }
    if(labelEl)labelEl.textContent=`Chapter ${chapter} Release`;
    let diff=target.getTime()-Date.now(); if(diff<0)diff=0;
    const d=Math.floor(diff/86400000);diff%=86400000;
    const h=Math.floor(diff/3600000);diff%=3600000;
    const m=Math.floor(diff/60000);diff%=60000;
    const s=Math.floor(diff/1000);
    document.getElementById('cd-d').textContent=String(d).padStart(2,'0');
    document.getElementById('cd-h').textContent=String(h).padStart(2,'0');
    document.getElementById('cd-m').textContent=String(m).padStart(2,'0');
    document.getElementById('cd-s').textContent=String(s).padStart(2,'0');
  }
  tick(); setInterval(tick,1000);
})();

/* ════ DEEP-LINK ROUTING ════
   Hash format: #tab | #tab/sub | #staff/m1 | #manga/gallery/folder | #manga/gallery/folder/imgIdx
════════════════════════════════════════════════════════ */
const VALID_TABS=['about','manga','news','theories','rules','info','staff'];
const activeSubs={manga:'gallery',news:'nfeed'};
let _skipHashPush=false; // prevent recursive pushState loops

/* Parse the current URL hash into parts */
function parseHash(){
  const raw=window.location.hash.replace(/^#/,'');
  if(!raw)return{tab:null,sub:null,detail:null,extra:null};
  // Ignore OAuth token fragments
  if(raw.startsWith('access_token='))return{tab:null,sub:null,detail:null,extra:null};
  const parts=raw.split('/');
  const tab=VALID_TABS.includes(parts[0])?parts[0]:null;
  return{tab,sub:parts[1]||null,detail:parts[2]||null,extra:parts[3]||null};
}

/* Build a hash string */
function buildHash(tab,sub,detail,extra){
  if(!tab||tab==='about')return window.location.pathname;
  let h='#'+tab;
  if(sub)h+='/'+sub;
  if(detail)h+='/'+detail;
  if(extra!==undefined&&extra!==null)h+='/'+extra;
  return h;
}

/* ════ DISCORD WIDGET — TOTAL MEMBERS ════ */
let widgetLoaded=false;

/* Activate a tab without touching subnav or hash */
function _activateTabOnly(tabId,scroll){
  document.querySelectorAll('.sec').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(l=>l.classList.remove('active'));
  const sec=document.getElementById(tabId);
  if(sec)sec.classList.add('active');
  document.querySelectorAll('.tab').forEach(l=>{if(l.dataset.tab===tabId)l.classList.add('active');});
  if(scroll){const nav=document.getElementById('nav')||document.getElementById('mob-bar');if(nav)window.scrollTo({top:nav.offsetTop-2,behavior:'smooth'});}
  if(tabId==='theories')loadDiscordWidget();
  if(tabId==='staff')loadStaffAvatars();
}

/* Activate a subsection without touching hash */
function _activateSubOnly(parent,sub){
  activeSubs[parent]=sub;
  document.querySelectorAll(`#${parent} .subsec`).forEach(s=>s.classList.remove('active'));
  const el=document.getElementById(sub);
  if(el)el.classList.add('active');
  document.querySelectorAll('.sn-btn').forEach(b=>b.classList.toggle('active',b.dataset.sub===sub&&b.dataset.parent===parent));
}

/* Main entry: activate tab+sub, update URL */
function activateTab(tabId,scroll=true,pushHash=true){
  _activateTabOnly(tabId,scroll);
  const sub=activeSubs[tabId];
  if(sub)_activateSubOnly(tabId,sub);
  if(pushHash&&!_skipHashPush){
    const h=buildHash(tabId,sub||null,null,null);
    history.pushState({tab:tabId,sub:sub||null},null,h);
  }
}

/* Wire tab links */
document.querySelectorAll('.tab').forEach(l=>{
  l.addEventListener('click',e=>{
    e.preventDefault();
    activateTab(l.dataset.tab);
  });
});

/* Subnav buttons — include sub in URL */
document.querySelectorAll('.sn-btn').forEach(b=>{
  b.addEventListener('click',()=>{
    const parent=b.dataset.parent, sub=b.dataset.sub;
    _activateSubOnly(parent,sub);
    const h=buildHash(parent,sub,null,null);
    history.pushState({tab:parent,sub},null,h);
  });
});

/* popstate — restore full state from hash */
window.addEventListener('popstate',e=>{
  // Close any open modals/lightboxes first
  document.getElementById('dc-modal-ov')?.classList.remove('open');
  document.getElementById('gal-lightbox-ov')?.classList.remove('open');
  document.body.style.overflow='';

  const{tab,sub,detail,extra}=parseHash();
  if(!tab)return;
  _skipHashPush=true;
  _activateTabOnly(tab,false);
  // Sync mobile nav
  document.querySelectorAll('.mob-nav-item').forEach(i=>i.classList.toggle('active',i.dataset.tab===tab));

  if(tab==='staff'){
    if(detail&&STAFF_DATA[detail]){openModal(detail,false);}
  } else if(tab==='manga'&&sub==='gallery'){
    if(detail){
      openGalFolder(detail,false);
      if(extra!==null&&extra!==''&&!isNaN(parseInt(extra))){
        const idx=parseInt(extra);
        if(lbImages[idx]){openLightbox(idx,false);}
      }
    } else {
      closeGalFolder(false);
    }
  } else if(sub){
    _activateSubOnly(tab,sub);
  }
  _skipHashPush=false;
});

/* Restore state on first load from hash */
(function(){
  const{tab,sub,detail,extra}=parseHash();
  if(!tab)return;
  _skipHashPush=true;
  _activateTabOnly(tab,false);
  // Sync mobile nav
  document.querySelectorAll('.mob-nav-item').forEach(i=>i.classList.toggle('active',i.dataset.tab===tab));
  if(tab==='staff'){
    if(sub&&STAFF_DATA[sub]){setTimeout(()=>openModal(sub,false),80);}
    else if(detail&&STAFF_DATA[detail]){setTimeout(()=>openModal(detail,false),80);}
  } else if(tab==='manga'&&sub==='gallery'){
    if(detail){
      setTimeout(()=>{
        openGalFolder(detail,false);
        if(extra!==null&&extra!==''&&!isNaN(parseInt(extra))){
          const idx=parseInt(extra);
          setTimeout(()=>{if(lbImages[idx])openLightbox(idx,false);},50);
        }
      },80);
    }
  } else if(sub){
    _activateSubOnly(tab,sub);
  }
  _skipHashPush=false;
})();

/* ════ GALLERY FOLDER SYSTEM ════ */
// GAL_DATA structure: { 'folder-key': [{src, title, srcHigh, srcMed, srcLow}] }
const GAL_DATA = {
  'chapter-covers': [],
  'volume-covers': [],
  'official-illustrations': [],
  'extra-illustrations': [],
  'magazines': [],
  'archived-illustrations': []
};

const GAL_FOLDER_NAMES = {
  'chapter-covers': 'Chapter Colored Covers',
  'volume-covers': 'Volume Covers',
  'official-illustrations': 'Official Illustrations',
  'extra-illustrations': 'Extra Illustrations',
  'magazines': 'Magazines',
  'archived-illustrations': 'Archived Illustrations'
};

let currentFolder = null;
let lbImages = [];
let lbIndex = 0;

// Update folder counts
function updateFolderCounts(){
  Object.keys(GAL_DATA).forEach(k=>{
    const el=document.getElementById('fc-'+k);
    if(el){ const n=GAL_DATA[k].length; el.textContent=n+' image'+(n!==1?'s':''); }
  });
}
updateFolderCounts();

function openGalFolder(key,pushHash=true){
  currentFolder=key;
  const images=GAL_DATA[key]||[];
  document.getElementById('gal-folders-view').style.display='none';
  document.getElementById('gal-folder-view').style.display='block';
  document.getElementById('gal-folder-title').textContent=GAL_FOLDER_NAMES[key]||key;
  const container=document.getElementById('gal-folder-images');
  if(pushHash&&!_skipHashPush) history.pushState({tab:'manga',sub:'gallery',folder:key},null,buildHash('manga','gallery',key,null));
  if(!images.length){
    container.innerHTML=`<div class="gal-folder-empty">
      <div class="gal-empty-icon"><svg class="icon-xl icon-accent"><use href="#i-image"/></svg></div>
      <p>This folder is empty</p>
      <p class="gal-empty-sub">Images will appear here once they are added.</p>
    </div>`;
    lbImages=[];
    return;
  }
  lbImages=images;
  container.innerHTML='<div class="gal-images-grid" id="gal-imgs-grid"></div>';
  const grid=document.getElementById('gal-imgs-grid');
  images.forEach((img,i)=>{
    const div=document.createElement('div');
    div.className='gal-img-thumb';
    div.onclick=()=>openLightbox(i);
    div.innerHTML=`<img src="${img.src}" alt="${escHtml(img.title||'')}"><div class="gal-img-thumb-caption">${escHtml(img.title||'Untitled')}</div>`;
    grid.appendChild(div);
  });
}

function closeGalFolder(pushHash=true){
  currentFolder=null;
  lbImages=[];
  document.getElementById('gal-folder-view').style.display='none';
  document.getElementById('gal-folders-view').style.display='block';
  if(pushHash&&!_skipHashPush) history.pushState({tab:'manga',sub:'gallery'},null,buildHash('manga','gallery',null,null));
}

function openLightbox(idx,pushHash=true){
  lbIndex=idx;
  renderLightbox();
  document.getElementById('gal-lightbox-ov').classList.add('open');
  document.body.style.overflow='hidden';
  if(pushHash&&currentFolder&&!_skipHashPush) history.pushState({tab:'manga',sub:'gallery',folder:currentFolder,img:idx},null,buildHash('manga','gallery',currentFolder,idx));
}
function closeLightbox(pushHash=true){
  document.getElementById('gal-lightbox-ov').classList.remove('open');
  document.body.style.overflow='';
  if(pushHash&&currentFolder&&!_skipHashPush) history.pushState({tab:'manga',sub:'gallery',folder:currentFolder},null,buildHash('manga','gallery',currentFolder,null));
}
function renderLightbox(){
  const img=lbImages[lbIndex];
  if(!img)return;
  document.getElementById('gal-lb-img').src=img.src;
  document.getElementById('gal-lb-img').alt=img.title||'';
  document.getElementById('gal-lb-title').textContent=img.title||'Untitled';
  document.getElementById('gal-lb-counter').textContent=(lbIndex+1)+' / '+lbImages.length;
  document.getElementById('gal-lb-prev').style.display=lbIndex>0?'flex':'none';
  document.getElementById('gal-lb-next').style.display=lbIndex<lbImages.length-1?'flex':'none';
}
function lbNav(dir){
  lbIndex=Math.max(0,Math.min(lbImages.length-1,lbIndex+dir));
  renderLightbox();
  if(currentFolder&&!_skipHashPush) history.replaceState({tab:'manga',sub:'gallery',folder:currentFolder,img:lbIndex},null,buildHash('manga','gallery',currentFolder,lbIndex));
}
function lbDownload(qual){
  const img=lbImages[lbIndex];
  if(!img)return;
  const url=qual==='high'?(img.srcHigh||img.src):qual==='medium'?(img.srcMed||img.src):(img.srcLow||img.src);
  const a=document.createElement('a');
  a.href=url; a.download=(img.title||'image')+'-'+qual+'.jpg'; a.target='_blank';
  document.body.appendChild(a); a.click(); document.body.removeChild(a);
}

// Keyboard nav for lightbox
document.addEventListener('keydown',e=>{
  if(!document.getElementById('gal-lightbox-ov').classList.contains('open'))return;
  if(e.key==='ArrowLeft')lbNav(-1);
  if(e.key==='ArrowRight')lbNav(1);
  if(e.key==='Escape')closeLightbox();
});

// Click outside lightbox to close
document.getElementById('gal-lightbox-ov').addEventListener('click',function(e){
  if(e.target===this)closeLightbox();
});

/* ════ DISCORD OAUTH2 ════ */
let dcUser = null, isMember = false, memberData = null;

function getCurrentTab(){
  for(const s of document.querySelectorAll('.sec')){ if(s.classList.contains('active'))return s.id; }
  return 'about';
}

/* ── Login redirect ──────────────────────────────────────────
   SCOPE: identify + guilds + guilds.members.read
   guilds.members.read allows /users/@me/guilds/:id/member
   which returns the user's full member object (roles, joined_at)
   without needing a bot token.
─────────────────────────────────────────────────────────────*/
function dcLogin(){
  localStorage.setItem('gkg-pretab', getCurrentTab());
  const redirectUri = encodeURIComponent('https://paradise-district.github.io/gokurakugai/');
  const scope       = encodeURIComponent('identify guilds guilds.members.read');
  window.location.href =
    'https://discord.com/api/oauth2/authorize?client_id=' + CFG.DISCORD_CLIENT_ID +
    '&redirect_uri=' + redirectUri + '&response_type=token&scope=' + scope;
}

/* ── Discord API ─────────────────────────────────────────── */

/* Wraps fetch() with an AbortController timeout — prevents infinite hangs */
function _timedFetch(url, opts, ms){
  const ctrl = new AbortController();
  const tid  = setTimeout(() => ctrl.abort(), ms);
  return fetch(url, Object.assign({}, opts, { signal: ctrl.signal }))
         .finally(() => clearTimeout(tid));
}

async function fetchDiscordUser(token){
  let r;
  try {
    r = await _timedFetch('https://discord.com/api/users/@me',
          { headers: { Authorization: 'Bearer ' + token } }, 12000);
  } catch(e){
    if(e.name === 'AbortError'){ const t = new Error('Timed out'); t.isTimeout = true; throw t; }
    throw e;
  }
  if(r.status === 401 || r.status === 403){
    const e = new Error('Token rejected (HTTP ' + r.status + ')'); e.isAuth = true; throw e;
  }
  if(!r.ok) throw new Error('Discord API HTTP ' + r.status);
  const user = await r.json();
  if(!user || !user.id) throw new Error('Empty user from Discord');
  return user;
}

/* Always resolves — never throws. Returns { isMember, memberObj }. */
async function fetchMemberData(token){
  try {
    // First check guild membership via guilds list
    const r = await _timedFetch('https://discord.com/api/users/@me/guilds',
                { headers: { Authorization: 'Bearer ' + token } }, 10000);
    if(r.ok){
      const guilds = await r.json();
      if(Array.isArray(guilds)){
        const inGuild = guilds.some(g => String(g.id) === String(CFG.GUILD_ID));
        if(!inGuild) return { isMember: false, memberObj: null };

        // Member confirmed — now fetch full member object (roles, joined_at, nick, avatar)
        // Requires guilds.members.read scope
        try {
          const mr = await _timedFetch(
            'https://discord.com/api/users/@me/guilds/' + CFG.GUILD_ID + '/member',
            { headers: { Authorization: 'Bearer ' + token } }, 10000
          );
          if(mr.ok){
            const memberObj = await mr.json();
            return { isMember: true, memberObj };
          }
        } catch(me){ console.warn('[GKG] fetchMemberObj (non-fatal):', me.message); }

        return { isMember: true, memberObj: null };
      }
    }
  } catch(e){ console.warn('[GKG] fetchMemberData (non-fatal):', e.message); }
  return { isMember: false, memberObj: null };
}

/* ── Apply user to nav UI (called immediately with real data) ── */
function setDcUser(user, member, mData){
  if(!user || !user.id) return;
  dcUser     = user;
  isMember   = member;
  memberData = mData || null;

  // Nav chip
  const loginBtn = document.getElementById('dc-login-btn');
  const userWrap = document.getElementById('dc-user-wrap');
  if(loginBtn) loginBtn.style.display = 'none';
  if(userWrap) userWrap.style.display = 'block';

  // Username
  const unameEl = document.getElementById('dc-uname');
  if(unameEl) unameEl.textContent = user.global_name || user.username || 'User';

  // Avatar in nav
  const avImg = document.getElementById('dc-av-img');
  const avPh  = document.getElementById('dc-av-ph');
  if(user.avatar){
    const url = 'https://cdn.discordapp.com/avatars/'+user.id+'/'+user.avatar+'.png?size=64';
    if(avImg){ avImg.src = url; avImg.style.display = 'block'; }
    if(avPh)  avPh.style.display = 'none';
  } else {
    if(avPh){ avPh.textContent = (user.username||'U')[0].toUpperCase(); avPh.style.display = 'flex'; }
    if(avImg) avImg.style.display = 'none';
  }

  // Green member dot
  const dot = document.getElementById('dc-dot');
  if(dot) dot.style.display = member ? 'block' : 'none';

  // Persist
  localStorage.setItem('gkg-dc-user',   JSON.stringify(user));
  localStorage.setItem('gkg-dc-member', member ? '1' : '0');
  if(mData) localStorage.setItem('gkg-dc-mdata', JSON.stringify(mData));

  // Autofill forms + gates
  autofillForms(user);
  updateGateUI();
}

/* ── Autofill identity fields on theory + staff forms ─── */
function autofillForms(user){
  const set = (id, val) => { const el = document.getElementById(id); if(el) el.value = val; };
  set('th-displayname', user.global_name || user.username || '');
  set('th-username',    user.username || '');
  set('th-userid',      user.id || '');
  set('af-displayname', user.global_name || user.username || '');
  set('af-username',    user.username || '');
  set('af-userid',      user.id || '');
  set('af-disc',        user.username || '');
}

/* ── Gate / form visibility ─────────────────────────────── */
function updateGateUI(){
  const loggedIn = !!dcUser && !!dcUser.id;
  const isMem    = loggedIn && isMember;

  const profileSec = document.getElementById('profile-sec');
  if(profileSec) profileSec.style.display = loggedIn ? 'block' : 'none';

  const discGate = document.getElementById('disc-gate');
  const discForm = document.getElementById('disc-post-form');
  if(discGate) discGate.style.display = loggedIn ? 'none' : 'block';
  if(discForm) discForm.style.display = isMem ? 'block' : 'none';

  // Theory form
  const thGate = document.getElementById('theory-gate');
  const thForm = document.getElementById('theory-submit-form');
  const thNote = document.getElementById('th-member-note');
  if(thGate) thGate.style.display = loggedIn ? 'none' : 'block';
  if(thForm) thForm.style.display = loggedIn ? 'block' : 'none';
  if(thNote) thNote.style.display = (loggedIn && !isMem) ? 'flex' : 'none';
  ['th-title','th-tag','th-chapters','th-body','th-images','th-spoilers','th-agree'].forEach(id => {
    const el = document.getElementById(id);
    if(el) el.disabled = loggedIn && !isMem;
  });
  const imgDrop = document.getElementById('th-img-drop');
  if(imgDrop) imgDrop.style.pointerEvents = (loggedIn && !isMem) ? 'none' : 'auto';
  const thBtn = document.querySelector('.th-submit-btn');
  if(thBtn){ thBtn.disabled = loggedIn && !isMem; thBtn.style.opacity = (loggedIn && !isMem) ? '.42' : '1'; }

  // Staff form
  const applyGate = document.getElementById('apply-gate');
  const applyForm = document.getElementById('apply-form');
  const applyNote = document.getElementById('apply-member-note');
  if(applyGate) applyGate.style.display = loggedIn ? 'none' : 'block';
  if(applyForm) applyForm.style.display = loggedIn ? 'block' : 'none';
  if(applyNote) applyNote.style.display = (loggedIn && !isMem) ? 'flex' : 'none';
  ['af-disc','af-age','af-tz','af-pos','af-tenure','af-hours','af-exp','af-why','af-scenario','af-extra'].forEach(id => {
    const el = document.getElementById(id);
    if(el) el.disabled = loggedIn && !isMem;
  });
  const applyBtn = document.querySelector('.af button[type="submit"]');
  if(applyBtn){ applyBtn.disabled = loggedIn && !isMem; applyBtn.style.opacity = (loggedIn && !isMem) ? '.42' : '1'; }
}

/* ── Full login sequence ─────────────────────────────────── */
async function doLogin(token){
  const loginBtn = document.getElementById('dc-login-btn');
  const userWrap = document.getElementById('dc-user-wrap');
  const avPh     = document.getElementById('dc-av-ph');
  const uname    = document.getElementById('dc-uname');
  if(loginBtn) loginBtn.style.display = 'none';
  if(userWrap) userWrap.style.display = 'block';
  if(avPh){ avPh.textContent = '…'; avPh.style.display = 'flex'; }
  if(uname) uname.textContent = '…';

  /* Safety net — guarantees UI is restored after 30s no matter what */
  const safety = setTimeout(() => {
    if(loginBtn) loginBtn.style.display = 'flex';
    if(userWrap) userWrap.style.display = 'none';
    dcUser = null; isMember = false; memberData = null;
    updateGateUI();
    showToast('Login timed out — please try again.', 'err');
  }, 30000);

  try {
    const user = await fetchDiscordUser(token);
    let mem = false, memberObj = null;
    try {
      const md = await fetchMemberData(token);
      mem = md.isMember; memberObj = md.memberObj;
    } catch(e){ console.warn('[GKG] Membership check (non-fatal):', e.message); }
    clearTimeout(safety);
    localStorage.setItem('gkg-dc-token', token);
    setDcUser(user, mem, memberObj);
    showToast('Welcome, ' + (user.global_name || user.username || 'there') + '! ✦');
    setTimeout(() => location.reload(), 1400);
  } catch(err){
    clearTimeout(safety);
    console.error('[GKG] doLogin error:', err.message);
    if(loginBtn) loginBtn.style.display = 'flex';
    if(userWrap) userWrap.style.display = 'none';
    if(err.isAuth){
      localStorage.removeItem('gkg-dc-token');
      localStorage.removeItem('gkg-dc-user');
      localStorage.removeItem('gkg-dc-member');
      localStorage.removeItem('gkg-dc-mdata');
    }
    dcUser = null; isMember = false; memberData = null;
    updateGateUI();
    showToast(err.isTimeout ? 'Login timed out — try again.' : err.isAuth ? 'Session expired — log in again.' : 'Login failed — please try again.', 'err');
  }
}

/* ── OAuth redirect handler ──────────────────────────────────
   Runs once when Discord redirects back with #access_token=...
   Sets a flag so restoreSession knows to stand down.
─────────────────────────────────────────────────────────────*/
let _oauthHandled = false;

(function handleOAuthRedirect(){
  // Parse token from URL hash (Discord implicit flow)
  let token = null;
  const rawHash = window.location.hash;
  if(rawHash && rawHash.length > 1){
    const hp = new URLSearchParams(rawHash.substring(1));
    token = hp.get('access_token');
    // Handle Discord error redirects (e.g. user denied)
    const err = hp.get('error');
    if(err){
      history.replaceState(null, null, window.location.pathname);
      updateGateUI();
      showToast('Discord auth cancelled.', 'err');
      return;
    }
  }
  if(!token){
    const qp = new URLSearchParams(window.location.search);
    token = qp.get('access_token') || qp.get('token');
  }
  if(!token) return;

  _oauthHandled = true; // restoreSession will skip

  // Wipe any stale cached data from previous sessions
  localStorage.removeItem('gkg-dc-user');
  localStorage.removeItem('gkg-dc-member');
  localStorage.removeItem('gkg-dc-mdata');

  // Clean the URL immediately
  history.replaceState(null, null, window.location.pathname);
  localStorage.setItem('gkg-dc-token', token);

  // Restore previous tab if navigated away for auth
  const preTab = localStorage.getItem('gkg-pretab');
  if(preTab && typeof activateTab === 'function') activateTab(preTab, false, false);

  showToast('Logging you in…');
  doLogin(token);
})();

/* ── Restore session on page reload ─────────────────────────
   Runs on every normal page load (not after OAuth redirect).
─────────────────────────────────────────────────────────────*/
(function restoreSession(){
  // Stand down if handleOAuthRedirect is already running a fresh login
  if(_oauthHandled) return;

  const token   = localStorage.getItem('gkg-dc-token');
  const rawUser = localStorage.getItem('gkg-dc-user');
  if(!token || !rawUser || rawUser === 'null'){ updateGateUI(); return; }

  let user = null;
  try { user = JSON.parse(rawUser); } catch(e){}

  // Reject placeholder/corrupt data — real Discord snowflakes are 17-19 digits
  if(!user || !user.id || !/^\d{15,20}$/.test(String(user.id))){
    localStorage.removeItem('gkg-dc-user');
    localStorage.removeItem('gkg-dc-member');
    localStorage.removeItem('gkg-dc-mdata');
    updateGateUI();
    return;
  }

  const mem   = localStorage.getItem('gkg-dc-member') === '1';
  const rawMD = localStorage.getItem('gkg-dc-mdata');
  let mData = null;
  try { mData = rawMD ? JSON.parse(rawMD) : null; } catch(e){}

  // Restore UI immediately from cache (no flicker)
  setDcUser(user, mem, mData);

  // Re-validate token silently in background
  fetchDiscordUser(token)
    .then(fresh => fetchMemberData(token)
      .catch(() => ({ isMember: mem, memberObj: mData }))
      .then(({ isMember: m2, memberObj: md2 }) => setDcUser(fresh, m2, md2)))
    .catch(() => {
      // Token expired — keep cached UI visible until explicit logout
    });
})();

/* ── Dropdown toggle ─────────────────────────────────────── */
document.getElementById('dc-btn')?.addEventListener('click', e => {
  e.stopPropagation();
  const btn = e.currentTarget;
  const dd = document.getElementById('dc-dd');
  if(!dd) return;
  const isOpen = dd.classList.contains('open');
  if(!isOpen){
    const rect = btn.getBoundingClientRect();
    const ddHeight = dd.offsetHeight || 120;
    const spaceBelow = window.innerHeight - rect.bottom;
    const spaceAbove = rect.top;
    if(spaceBelow < ddHeight + 16 && spaceAbove > spaceBelow){
      dd.classList.add('drop-up');
    } else {
      dd.classList.remove('drop-up');
    }
  }
  dd.classList.toggle('open');
});
document.addEventListener('click', () => {
  document.getElementById('dc-dd')?.classList.remove('open');
});
document.getElementById('dc-login-btn')?.addEventListener('click', dcLogin);

/* ── Profile modal open/close ─────────────────────────────── */
document.getElementById('dc-profile-btn')?.addEventListener('click', e => {
  e.stopPropagation();
  document.getElementById('dc-dd')?.classList.remove('open');
  openProfile();
});

function closeProfile(){
  document.getElementById('prof-ov').classList.remove('open');
  document.body.style.overflow = '';
}

/* ── Populate the profile modal ─────────────────────────── */
function snowflakeToDate(id){
  try{ return new Date(Number(BigInt(id)>>22n)+1420070400000); } catch(e){ return null; }
}

function roleColor(hexColor){
  if(!hexColor || hexColor === 0) return 'rgba(180,160,120,.7)';
  const hex = typeof hexColor === 'number'
    ? '#'+hexColor.toString(16).padStart(6,'0')
    : hexColor;
  return hex;
}

/* ── Show the profile banner fallback ── */
function showPmBannerFallback(){
  const loading  = document.getElementById('pm-banner-loading');
  const real     = document.getElementById('pm-banner-img');
  const fallback = document.getElementById('pm-banner-fallback');
  if(loading)  loading.style.display  = 'none';
  if(real)     real.style.display     = 'none';
  if(fallback) fallback.style.display = 'flex';
}

/* ── Determine position from role names ── */
function getPositionFromRoles(roleNames){
  const names = roleNames.map(n => n.toLowerCase());
  if(names.some(n => n.includes('owner') || n.includes('founder'))) return 'Owner';
  if(names.some(n => n.includes('admin'))) return 'Administrator';
  if(names.some(n => n.includes('senior mod') || n.includes('seniormoder'))) return 'Senior Moderator';
  if(names.some(n => n.includes('mod'))) return 'Moderator';
  if(names.some(n => n.includes('staff') || n.includes('team'))) return 'Staff';
  if(names.some(n => n.includes('content') || n.includes('creator'))) return 'Content Creator';
  return 'Member';
}

/* ── Determine position from permissions integer ── */
function getPositionFromPerms(permsStr, roleNames){
  try {
    const p = BigInt(permsStr || '0');
    const ADMINISTRATOR  = 8n;
    const MANAGE_GUILD   = 32n;
    const MANAGE_MESSAGES = 8192n;
    if((p & ADMINISTRATOR) === ADMINISTRATOR) return 'Administrator';
    if((p & MANAGE_GUILD)  === MANAGE_GUILD)  return 'Moderator';
    if((p & MANAGE_MESSAGES) === MANAGE_MESSAGES) return 'Moderator';
  } catch(e){}
  return getPositionFromRoles(roleNames);
}

function openProfile(){
  if(!dcUser) return;

  /* ── Set up immediate static content ── */
  const modal = document.getElementById('prof-modal');

  // Banner: show spinner while we fetch
  const pmBannerLoading  = document.getElementById('pm-banner-loading');
  const pmBannerImg      = document.getElementById('pm-banner-img');
  const pmBannerFallback = document.getElementById('pm-banner-fallback');
  if(pmBannerLoading)  pmBannerLoading.style.display  = 'flex';
  if(pmBannerImg)      pmBannerImg.style.display      = 'none';
  if(pmBannerFallback) pmBannerFallback.style.display = 'none';

  // Avatar: show initial while loading
  const pmAv = document.getElementById('pm-av');
  if(pmAv) pmAv.innerHTML = `<span style="font-family:'Cinzel',serif;font-size:2rem;color:var(--accent);">${(dcUser.global_name||dcUser.username||'?')[0].toUpperCase()}</span>`;

  // Static name fields
  const pmDn  = document.getElementById('pm-displayname');
  const pmUn  = document.getElementById('pm-username');
  const pmUid = document.getElementById('pm-uid');
  if(pmDn)  pmDn.textContent  = dcUser.global_name || dcUser.username || '—';
  if(pmUn)  pmUn.textContent  = '@' + (dcUser.username || '—');
  if(pmUid) pmUid.textContent = dcUser.id || '—';

  // Account created from snowflake (no API needed)
  const pmCreated = document.getElementById('pm-created');
  if(pmCreated && dcUser.id){
    const d = snowflakeToDate(dcUser.id);
    pmCreated.textContent = d ? d.toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'}) : '—';
  }

  // Loading placeholders for live fields
  const pmJoined   = document.getElementById('pm-joined');
  const pmPosition = document.getElementById('pm-position');
  const pmRoles    = document.getElementById('pm-roles');
  if(pmJoined)   pmJoined.textContent   = '…';
  if(pmPosition) pmPosition.textContent = '…';
  if(pmRoles)    pmRoles.innerHTML      = '<span class="dc-sm-roles-loading">Loading…</span>';

  // Member badge
  const badgeWrap = document.getElementById('pm-badge-wrap');
  if(badgeWrap){
    if(isMember){
      badgeWrap.innerHTML = '<span class="pm-member-badge pm-badge-yes">✓&nbsp;Verified Member</span>';
    } else {
      badgeWrap.innerHTML = '<span class="pm-member-badge pm-badge-no">✕&nbsp;Not a member of the server</span>';
    }
  }

  // Status dot
  const pmDot = document.getElementById('pm-av-dot');
  if(pmDot) pmDot.style.display = isMember ? 'block' : 'none';

  // Open the modal
  document.getElementById('prof-ov').classList.add('open');
  document.body.style.overflow = 'hidden';
  setTimeout(() => { if(modal) modal.scrollTop = 0; }, 10);

  /* ── Non-member fast path ── */
  if(!isMember){
    showPmBannerFallback();
    // Still try to load their Discord avatar/banner via Worker
    _loadProfileFromWorker(dcUser.id, pmAv, false);
    if(pmJoined)   pmJoined.textContent   = 'Not a member of the server.';
    if(pmPosition) pmPosition.textContent = 'Not a member of the server.';
    if(pmRoles)    pmRoles.innerHTML      = '<span style="font-size:.85rem;color:var(--text-muted);">Not a member of the server.</span>';
    return;
  }

  /* ── Member: load full data from Worker ── */
  _loadProfileFromWorker(dcUser.id, pmAv, true);
}

/* ── Load profile banner + avatar + roles from Worker ── */
async function _loadProfileFromWorker(uid, avEl, isMem){
  const pmBannerLoading  = document.getElementById('pm-banner-loading');
  const pmBannerImg      = document.getElementById('pm-banner-img');
  const pmJoined         = document.getElementById('pm-joined');
  const pmPosition       = document.getElementById('pm-position');
  const pmRoles          = document.getElementById('pm-roles');

  const data = await fetchStaffProfile(uid);

  /* ── Banner ── */
  if(data && data.bannerUrl){
    if(pmBannerImg){
      pmBannerImg.onload  = () => {
        if(pmBannerLoading) pmBannerLoading.style.display = 'none';
        pmBannerImg.style.display = 'block';
      };
      pmBannerImg.onerror = () => showPmBannerFallback();
      pmBannerImg.src = data.bannerUrl;
    }
  } else {
    showPmBannerFallback();
  }

  /* ── Avatar ── */
  if(data && data.avatarUrl && avEl){
    const img = new Image();
    img.crossOrigin = 'anonymous';
    img.onload = () => {
      avEl.innerHTML = '';
      img.style.cssText = 'width:100%;height:100%;object-fit:cover;';
      avEl.appendChild(img);
    };
    img.src = data.avatarUrl;
  }

  if(!isMem){
    // Non-members: only banner/avatar from Worker, fields already set
    return;
  }

  /* ── Member fields ── */
  if(!data){
    // Worker unavailable — use cached memberData
    _applyMemberDataFallback();
    return;
  }

  if(data.member){
    // Joined server
    if(pmJoined){
      pmJoined.textContent = data.member.joined_at
        ? new Date(data.member.joined_at).toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'})
        : '—';
    }

    // Position (from permissions if available, else from role names)
    if(pmPosition){
      if(data.position){
        pmPosition.textContent = data.position;
      } else if(data.member.roles && data.rolesMap){
        const roleNames = data.member.roles.map(id => (data.rolesMap[id]||{}).name||'').filter(Boolean);
        pmPosition.textContent = getPositionFromRoles(roleNames);
      } else {
        pmPosition.textContent = 'Member';
      }
    }

    // Roles — full list with live Discord colors
    if(pmRoles){
      pmRoles.innerHTML = buildRolePillsHtml(data.member.roles, data.rolesMap);
    }
  } else {
    // Worker returned data but no member object
    if(pmJoined)   pmJoined.textContent   = '—';
    if(pmPosition) pmPosition.textContent = 'Member';
    if(pmRoles)    pmRoles.innerHTML      = '<span class="dc-sm-role dc-sm-role-member">Member</span>';
  }
}

/* ── Fallback when Worker is unavailable: use cached memberData ── */
function _applyMemberDataFallback(){
  const pmJoined   = document.getElementById('pm-joined');
  const pmPosition = document.getElementById('pm-position');
  const pmRoles    = document.getElementById('pm-roles');

  // Use cached banner/avatar from user object
  const bannerLoading  = document.getElementById('pm-banner-loading');
  const bannerImg      = document.getElementById('pm-banner-img');
  const user = dcUser;
  if(user && user.banner){
    const ext = user.banner.startsWith('a_') ? 'gif' : 'png';
    if(bannerImg){
      bannerImg.onload  = () => { if(bannerLoading) bannerLoading.style.display='none'; bannerImg.style.display='block'; };
      bannerImg.onerror = () => showPmBannerFallback();
      bannerImg.src = 'https://cdn.discordapp.com/banners/'+user.id+'/'+user.banner+'.'+ext+'?size=960';
    }
  } else {
    showPmBannerFallback();
  }

  // Avatar from user object
  const pmAv = document.getElementById('pm-av');
  if(pmAv && user && user.avatar){
    const img = new Image();
    img.onload = () => {
      pmAv.innerHTML = '';
      img.style.cssText = 'width:100%;height:100%;object-fit:cover;';
      pmAv.appendChild(img);
    };
    img.src = 'https://cdn.discordapp.com/avatars/'+user.id+'/'+user.avatar
      +(user.avatar.startsWith('a_') ? '.gif' : '.png')+'?size=256';
  }

  if(memberData && memberData.joined_at){
    if(pmJoined) pmJoined.textContent = new Date(memberData.joined_at)
      .toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'});
  } else {
    if(pmJoined) pmJoined.textContent = 'Server member';
  }

  // Position + roles from cached role IDs (no colors available without Worker)
  const roleIds = (memberData && Array.isArray(memberData.roles)) ? memberData.roles : [];
  if(pmPosition) pmPosition.textContent = 'Member';
  if(pmRoles) pmRoles.innerHTML = roleIds.length
    ? roleIds.map(() => `<span class="pm-role-pill" style="color:#818cf8;background:#818cf81a;border:1px solid #818cf844">Member</span>`).join('')
    : '<span class="pm-role-pill" style="color:#818cf8;background:#818cf81a;border:1px solid #818cf844">Member</span>';
}

function populateProfileModal(user, member, mData){
  // Legacy wrapper — openProfile() now handles everything
  // This remains for any external callers
  openProfile();
}

/* ── Logout ──────────────────────────────────────────────── */
function doLogout(){
  localStorage.removeItem('gkg-dc-token');
  localStorage.removeItem('gkg-dc-user');
  localStorage.removeItem('gkg-dc-member');
  localStorage.removeItem('gkg-dc-mdata');
  dcUser = null; isMember = false; memberData = null;
  const loginBtn = document.getElementById('dc-login-btn');
  const userWrap = document.getElementById('dc-user-wrap');
  const dot      = document.getElementById('dc-dot');
  const dd       = document.getElementById('dc-dd');
  const avImg    = document.getElementById('dc-av-img');
  const avPh     = document.getElementById('dc-av-ph');
  if(loginBtn) loginBtn.style.display = 'flex';
  if(userWrap) userWrap.style.display = 'none';
  if(dot)      dot.style.display = 'none';
  if(dd)       dd.classList.remove('open');
  if(avImg){ avImg.src = ''; avImg.style.display = 'none'; }
  if(avPh)  avPh.textContent = '?';
  closeProfile();
  updateGateUI();
  showToast('Logged out successfully.');
  setTimeout(() => location.reload(), 1400);
}
document.getElementById('dc-logout')?.addEventListener('click', doLogout);

// Escape key closes profile modal
document.addEventListener('keydown', e => {
  if(e.key === 'Escape') closeProfile();
});

/* ════ DISCORD WIDGET — TOTAL MEMBERS ════ */
function loadDiscordWidget(){
  if(widgetLoaded)return;
  widgetLoaded=true;
  fetch(CFG.WIDGET_API)
    .then(r=>r.json())
    .then(data=>{
      const count=data.presence_count||(data.members||[]).length;
      const el=document.getElementById('dc-online-ct');
      if(el)el.textContent=count+' members online';
    })
    .catch(()=>{ const el=document.getElementById('dc-online-ct'); if(el)el.textContent='Widget unavailable'; });
}

/* ════ DISCUSSION SUBMIT ════ */
function submitDiscussion(){
  if(!dcUser||!isMember){showToast('You must be a server member to post.','err');return;}
  const text=document.getElementById('disc-text').value.trim();
  const topic=document.getElementById('disc-topic').value;
  if(!text){showToast('Please write something first.','err');return;}
  const post=document.createElement('div');
  post.className='dp';
  const initials=(dcUser.username||'U')[0].toUpperCase();
  const avatarHtml=dcUser.avatar?`<img src="https://cdn.discordapp.com/avatars/${dcUser.id}/${dcUser.avatar}.png?size=64" alt="">`:initials;
  post.innerHTML=`<div class="dp-top"><div class="dp-av">${avatarHtml}</div><div><div class="dp-n">${escHtml(dcUser.username||'User')}</div><div class="dp-t">Just now · ${topic}</div></div></div><div class="dp-body">${escHtml(text)}</div><div class="dp-acts"><button class="dp-act">♡ 0</button><button class="dp-act">↩ Reply</button></div>`;
  const list=document.getElementById('disc-posts');
  list.insertBefore(post,list.firstChild);
  document.getElementById('disc-text').value='';
  showToast('Comment posted!');
}

function handleThImgUpload(input){
  const preview=document.getElementById('th-img-preview');
  const names=document.getElementById('th-img-names');
  if(!preview||!names)return;
  preview.innerHTML='';
  const files=Array.from(input.files).slice(0,4);
  if(!files.length){names.textContent='';return;}
  names.textContent=files.map(f=>f.name).join(', ');
  files.forEach(file=>{
    const reader=new FileReader();
    reader.onload=e=>{
      const img=document.createElement('img');
      img.src=e.target.result;
      img.className='th-img-thumb-mini';
      preview.appendChild(img);
    };
    reader.readAsDataURL(file);
  });
}

/* ════ THEORY SUBMIT & VOTING ════ */
const theoryVotes=new Map();
let theoryCounter=0;
function submitTheory(){
  if(!dcUser){showToast('Please log in with Discord first.','err');return;}
  if(!isMember){showToast('Server members only. Please join our Discord.','err');return;}
  if(!isMember){showToast('Server members only. Please join our Discord.','err');return;}
  const title=document.getElementById('th-title').value.trim();
  const body=document.getElementById('th-body').value.trim();
  const tag=document.getElementById('th-tag').value;
  const agree=document.getElementById('th-agree').checked;
  if(!title||!body){showToast('Please fill in title and theory.','err');return;}
  if(!tag){showToast('Please select a category.','err');return;}
  if(!agree){showToast('Please agree to the community guidelines.','err');return;}
  const tid='th-'+(++theoryCounter);
  const el=document.createElement('div');
  el.className='th-gc'; el.dataset.tid=tid;
  const spoilerBadge=document.getElementById('th-spoilers').checked?'<span class="th-gc-cat" style="background:rgba(192,39,45,.2);color:var(--crimson-bright);border-color:rgba(192,39,45,.4);">⚠ Spoilers</span>':'';
  theoryVotes.set(dcUser.id+'_'+tid,'up');
  const avatarHtml=dcUser.avatar?`<img src="https://cdn.discordapp.com/avatars/${dcUser.id}/${dcUser.avatar}.png?size=64" alt="" style="width:100%;height:100%;object-fit:cover;">`:(dcUser.username||'U')[0].toUpperCase();
  el.innerHTML=`<div class="th-gc-top"><span class="th-gc-cat">${escHtml(tag)}</span>${spoilerBadge}</div><div class="th-gc-title">${escHtml(title)}</div><div class="th-gc-body">${escHtml(body.substring(0,140))}${body.length>140?'...':''}</div><div class="th-gc-meta"><div class="th-gc-av">${avatarHtml}</div><span class="th-gc-footer">by ${escHtml(dcUser.username||'You')}</span><span class="th-gc-date">· Just now</span></div><div class="th-gc-actions"><button class="th-vote-up active" onclick="castVote(this,'up','${tid}')">▲ <span>1</span></button><button class="th-vote-down" onclick="castVote(this,'down','${tid}')">▼ <span>0</span></button><span class="th-vote-score">1</span></div>`;
  const list=document.getElementById('theories-list');
  list.insertBefore(el,list.firstChild);
  const empty=document.getElementById('theories-empty'); if(empty)empty.style.display='none';
  ['th-title','th-body','th-chapters'].forEach(id=>{const e=document.getElementById(id);if(e)e.value='';});
  document.getElementById('th-tag').value='';
  document.getElementById('th-agree').checked=false;
  document.getElementById('th-spoilers').checked=false;
  document.getElementById('th-body-count').textContent='0';
  const thImgIn=document.getElementById('th-images'); if(thImgIn)thImgIn.value='';
  const thPrev=document.getElementById('th-img-preview'); if(thPrev)thPrev.innerHTML='';
  const thNm=document.getElementById('th-img-names'); if(thNm)thNm.textContent='';
  showToast('Theory submitted! ✦');
}
function castVote(btn,dir,tid){
  if(!dcUser){showToast('Log in to vote.','err');return;}
  const key=dcUser.id+'_'+tid;
  const card=btn.closest('.th-gc');
  const upBtn=card.querySelector('.th-vote-up');
  const downBtn=card.querySelector('.th-vote-down');
  const scoreEl=card.querySelector('.th-vote-score');
  let ups=parseInt(upBtn.querySelector('span').textContent)||0;
  let downs=parseInt(downBtn.querySelector('span').textContent)||0;
  const prevVote=theoryVotes.get(key);
  if(prevVote===dir){
    if(dir==='up')ups--;else downs--;
    theoryVotes.delete(key);
    upBtn.classList.remove('active'); downBtn.classList.remove('active');
  }else{
    if(prevVote==='up')ups--;if(prevVote==='down')downs--;
    if(dir==='up'){ups++;upBtn.classList.add('active');downBtn.classList.remove('active');}
    else{downs++;downBtn.classList.add('active');upBtn.classList.remove('active');}
    theoryVotes.set(key,dir);
  }
  upBtn.querySelector('span').textContent=ups;
  downBtn.querySelector('span').textContent=downs;
  if(scoreEl)scoreEl.textContent=ups-downs;
}
function filterNews(btn,cat){
  document.querySelectorAll('.nf-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.querySelectorAll('#news-grid .ngc,#news-grid .news-pinned').forEach(card=>{ card.style.display=(cat==='all'||card.dataset.cat===cat)?'':'none'; });
}
function updateCount(textareaId,countId,max){
  const val=document.getElementById(textareaId)?.value.length||0;
  document.getElementById(countId).textContent=val;
}

/* ════ STAFF APPLICATION ════ */
async function submitApplication(e){
  e.preventDefault();
  if(!dcUser){showToast('Please log in with Discord first.','err');return;}
  if(!isMember){showToast('Server members only. Please join our Discord.','err');return;}
  const data={discord:document.getElementById('af-disc').value,age:document.getElementById('af-age').value,timezone:document.getElementById('af-tz').value,position:document.getElementById('af-pos').value,tenure:document.getElementById('af-tenure').value,hours:document.getElementById('af-hours').value,experience:document.getElementById('af-exp').value,why:document.getElementById('af-why').value,scenario:document.getElementById('af-scenario').value,extra:document.getElementById('af-extra').value||'None'};
  const embed={title:'📋 New Staff Application',color:0xC9A84C,fields:[{name:'Discord',value:data.discord,inline:true},{name:'Age',value:data.age,inline:true},{name:'Timezone',value:data.timezone,inline:true},{name:'Position',value:data.position,inline:true},{name:'Tenure',value:data.tenure,inline:true},{name:'Hours/Week',value:data.hours,inline:true},{name:'Experience',value:data.experience||'None',inline:false},{name:'Why They Want to Join',value:data.why,inline:false},{name:'Conflict Scenario',value:data.scenario,inline:false},{name:'Additional Notes',value:data.extra,inline:false}],footer:{text:'Submitted via Gokurakugai Fan Site'},timestamp:new Date().toISOString()};
  if(CFG.WEBHOOK_URL&&CFG.WEBHOOK_URL!=='YOUR_WEBHOOK_URL_HERE'){
    try{ await fetch(CFG.WEBHOOK_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({embeds:[embed]})}); }
    catch(err){ showToast('Submission failed. Please try again.','err'); return; }
  }
  document.getElementById('apply-form').style.display='none';
  document.getElementById('apply-ok').style.display='block';
  showToast('Application submitted! ✦');
}

/* ════ DISCORD-STYLE STAFF MODALS ════ */
const STAFF_DATA={
  m1:{
    uid:'861651187949633547',
    displayName:'RION',username:'jetnoire',
    roles:['Founder','Admin'],roleTags:['founder','admin'],
    about:`Hi hi! I'm Rion (jetnoire), mostly active around shonen animanga spaces and wiki projects. You can call me Rion, Jet, or just Noire if that's easier. 🖤

I started editing wikis out of pure hyperfixation energy (you know how it goes). What began as simply loving a series slowly turned into diving deep into how wikis actually work. I spent weeks learning the ins and outs, from the basics of formatting to more advanced layout work using CSS and HTML, until I was confident enough to start properly revamping and organizing pages.

After my first major project, I expanded into handling and managing other series as well. I'm especially drawn to shonen (with a soft spot for darker themes), though I occasionally branch out when something catches my interest. My main strength lies in designing layouts that actually *feel* like the series, matching themes, refining navigation, cleaning structures, and making everything look cohesive rather than chaotic.

As I gained more experience (I'd say somewhere around that "I know what I'm doing but still learning" stage 😅), I started connecting with more editors and communities. That's when things became less of a solo project and more of a collaborative space for growth.

There was also a brief "let me just try my luck" phase when I applied for the star program. The first attempt didn't go through, which honestly discouraged me a bit. But after some time (and a little push from someone who believed in me), I reapplied, and this time, it worked out. And yeah, that's me.`
  },
  m2:{
    uid:'727231548255895743',
    displayName:'ANDY',username:'resoluteroyalty',
    roles:['Admin'],roleTags:['admin'],
    about:`I am a dedicated enthusiast and loyal administrator/moderator of the Gokurakugai manga community. I have consistently worked to foster a positive, inclusive, and engaging environment for all members.

I embrace responsibility, express my views thoughtfully, and take genuine pleasure in sharing my knowledge, experiences, and advice with others.

I pride myself on being proud, loyal, and honest. I derive deep satisfaction from supporting and assisting those around me.

Motivated by ambition, I am committed to achieving meaningful accomplishments in the years ahead.

My interests span a wide range of subjects, and I approach people, ideas, and life with a distinctive and principled perspective. While I place strong emphasis on health, success, and financial independence, I also value balance, knowing how to relax, enjoy life, and embrace moments of play and leisure.

Occupation: Founder & CEO of a small company, Software Developer, Graphic Designer.

Hobbies: Video games, Digital Design, Music, Content creation.

Skills: Web Design, 3D Modeling, 3D Animation, Software Design, Indie Game Development, Video Editing, Image Editing, Digital Art, Music Production.

Likes: Success, recognition, wealth, personal freedom, roles in leadership, profound and intellectual discussions, politics, psychology, futurism, utopian concepts, and helping others achieve their potential.

Dislikes: Dishonesty, disrespect, disloyalty, low self-worth, betrayal or backstabbing, ingratitude, morally reprehensible behavior, harm to others, apathy toward important topics, and inauthenticity.`
  },
  m3:{
    uid:'932931370894884924',
    displayName:'TORTOL',username:'tortilinni',
    roles:['Admin'],roleTags:['admin'],
    about:`I am a heavy music lover, video game lover, and anime lover with the recent addiction to Gokurakugai. I also play bass.

Some of my favorite bands right now include: Architects, Knocked Loose, 156/Silence, and Archspire.

Some of my favorite anime include: Gachiakuta, Welcome to Demon School Iruma-Kun and Demon Slayer.

What I love about Gokurakugai so far are the characters, art, concepts and world building. I'm also a big fan of the official arts and bonus panels that are blessed to us from time to time.

Other: I like turtles.`
  },
  m4:{
    uid:'1114585051515080704',
    displayName:'rwottenhrts',username:'rwottenhrts',
    roles:['Admin'],roleTags:['admin'],
    about:`Mostly a behind-the-scenes staff member. I've been a big fan of Gokurakugai since the very first simul-pubbed chapter and have followed up with it to this day. I enjoy volunteering, and I spend my free time playing the piano and guitar.`
  },
  m5:{
    uid:'1324486337650360380',
    displayName:'NAZARETH',username:'thenazar3th',
    roles:['Admin'],roleTags:['admin'],
    about:`Hey! I really enjoy building communities and helping give them a strong start. I care a lot about making spaces that feel comfortable, safe, and welcoming for everyone.

I love animals, and I try to live by strong ethical and moral values in how I treat both people and the world around me.

I'm currently studying Dentistry, so I might be a bit busy or slow to respond sometimes, but I'm still around!

I also love reading manga, manhua, manhwa, and novels, so feel free to talk to me about recommendations anytime :)`
  },
  m6:{
    uid:'448594891568709652',
    displayName:'AKKI',username:'siakki',
    roles:['Moderator'],roleTags:['mod'],
    about:`Full time project manager and content editor, self taught traditional artist, spending free time at the gym, playing video games or watching anime. Love travelling, writing, collecting manga and all the cats of the world.

Gokurakugai: I think the story is interesting so far, love the attention to character designs and the overall clean and pretty manga style.`
  },
  m7:{
    uid:'717012902275448845',
    displayName:'MOON',username:'vyrmoon',
    roles:['Moderator'],roleTags:['mod'],
    about:`I like video editing, and designing, I'm a big fan of reading manhwa/manga.

Gokurakugai: I got drawn into it mainly because of the art and covers, but I enjoy the overall theme and story too.`
  },
  m8:{
    uid:'456747461323784202',
    displayName:'SPRING',username:'userspring',
    roles:['Moderator'],roleTags:['mod'],
    about:`To be added...`
  },
  m9:{
    uid:'808887501418266624',
    displayName:'ARABELLA',username:'ara679',
    roles:['Trial Moderator'],roleTags:['trialmod'],
    about:`My brother recommended I read Gokurakugai over a year ago, and I quickly fell in love with the series. I've gotten busy with school and work in the past few months but in my free time I enjoy going for walks, taking care of my many houseplants, and playing games, typically the Sims 4 or One Piece Bounty Rush.`
  }
};

/* ════ DISCORD STAFF MODAL — WORKER-BASED LIVE DATA ════
   Discord's API does NOT allow client-side code to look up other
   users' avatars, banners, or guild membership using an OAuth
   Bearer token. Bearer tokens only work for the logged-in user's
   OWN data. To look up any other user, a Bot token is required —
   and bot tokens must NEVER be exposed client-side.

   SOLUTION: A Cloudflare Worker (worker.js, deployed separately)
   acts as a secure proxy. It holds the bot token in a secret
   environment variable and exposes a read-only endpoint:

     GET {PROXY_URL}/profile/{userId}

   The Worker fetches user data, guild member data, and all roles
   from Discord's API using the bot token, then returns a safe
   JSON payload with avatar URL, banner URL, member info, and
   full role list with names + colors. No secrets are exposed.

   SETUP (one-time):
   1. Deploy worker.js to Cloudflare Workers (free tier)
   2. Add secret: wrangler secret put DISCORD_BOT_TOKEN
   3. Set CFG.PROXY_URL to your worker URL above
══════════════════════════════════════════════════════════ */

/* ── Session cache: uid → Worker response ── */
const _staffProfileCache = {};

/* ── Format a Date as "Month D, YYYY" ── */
function fmtDate(d){
  if(!d) return '—';
  return d.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});
}

/* ── Fetch staff profile from Worker — always resolves ── */
async function fetchStaffProfile(uid){
  if(_staffProfileCache[uid] !== undefined) return _staffProfileCache[uid];
  const url = CFG.PROXY_URL;
  if(!url || url === 'YOUR_WORKER_URL_HERE'){
    console.warn('[GKG] PROXY_URL not configured. Set CFG.PROXY_URL to your Cloudflare Worker URL.');
    _staffProfileCache[uid] = null;
    return null;
  }
  try{
    const r = await _timedFetch(`${url}/profile/${uid}`, {}, 12000);
    if(!r.ok) throw new Error('proxy:'+r.status);
    const data = await r.json();
    _staffProfileCache[uid] = data;
    return data;
  }catch(e){
    console.warn('[GKG] fetchStaffProfile '+uid+':', e.message);
    _staffProfileCache[uid] = null;
    return null;
  }
}

/* ── Build role pill HTML with live Discord colors ── */
function buildRolePillsHtml(roleIds, rolesMap){
  if(!roleIds || !roleIds.length || !rolesMap){
    return '<span class="dc-sm-roles-loading">Not a member of the server</span>';
  }
  const roles = roleIds
    .map(id => rolesMap[id])
    .filter(r => r && r.name !== '@everyone')
    .sort((a,b) => (b.position||0) - (a.position||0));
  if(!roles.length) return '<span class="dc-sm-roles-loading">Member</span>';
  return roles.map(role => {
    const c = role.colorHex;
    const style = c
      ? `color:${c};background:${c}1a;border:1px solid ${c}40;`
      : `color:var(--text-muted);background:var(--surface2);border:1px solid var(--hr);`;
    return `<span class="dc-sm-role-live" style="${style}"><span class="dc-sm-role-dot" style="background:${c||'var(--text-muted)'};"></span>${escHtml(role.name)}</span>`;
  }).join('');
}

/* ── Show the fallback banner (site header + glass blur + label) ── */
function showBannerFallback(){
  document.getElementById('dc-sm-banner-loading').style.display  = 'none';
  document.getElementById('dc-sm-banner-real').style.display     = 'none';
  document.getElementById('dc-sm-banner-fallback').style.display = 'flex';
}

/* ── Load avatars + status dots into staff grid cards ────────────
   Avatars: fetched via Worker proxy (real Discord CDN URLs).
   Status:  fetched from the public Discord Widget API, which
            returns presence (online/idle/dnd) for members who
            have opted into widget visibility. Staff not visible
            in the widget keep the default grey dot (unknown).
   Staggered to stay well within rate limits.
────────────────────────────────────────────────────────────────*/
let _staffAvatarsLoaded = false;
async function loadStaffAvatars(){
  if(_staffAvatarsLoaded) return;
  _staffAvatarsLoaded = true;

  /* ── Fetch widget presence independently (fire-and-forget) ── */
  fetch(CFG.WIDGET_API)
    .then(r => r.json())
    .then(data => {
      const presenceMap = {};
      if(Array.isArray(data.members)){
        for(const m of data.members){
          if(m.username && m.status){
            presenceMap[m.username.toLowerCase()] = m.status;
          }
        }
      }
      /* Apply status dots after widget resolves */
      for(const [id, d] of Object.entries(STAFF_DATA)){
        const dot = document.getElementById('sc-dot-'+id);
        if(!dot) continue;
        const status = presenceMap[d.username.toLowerCase()];
        if(status === 'online' || status === 'idle' || status === 'dnd'){
          dot.classList.add(status);
        }
      }
    })
    .catch(() => {}); // widget unavailable → dots stay grey

  /* ── Load avatars staggered to stay within rate limits ── */
  const entries = Object.entries(STAFF_DATA);
  for(let i = 0; i < entries.length; i++){
    const [id, d] = entries[i];
    if(i > 0) await new Promise(res => setTimeout(res, 180));
    const wrap = document.getElementById('sc-av-'+id);
    if(!wrap) continue;

    fetchStaffProfile(d.uid).then(data => {
      if(!data?.avatarUrl) return;
      const img = document.createElement('img');
      img.alt    = d.displayName;
      img.onload = () => {
        /* Preserve the status dot element when swapping in the avatar */
        const dot = wrap.querySelector('.sc-status-dot');
        wrap.innerHTML = '';
        wrap.appendChild(img);
        if(dot) wrap.appendChild(dot);
      };
      img.onerror = () => {}; // keep initials on failure
      img.src = data.avatarUrl;
    });
  }
}

/* ── Open staff modal ────────────────────────────────────────── */
async function openModal(id, pushHash=true){
  const d = STAFF_DATA[id];
  if(!d) return;

  const uid = d.uid;

  /* Populate static fields immediately so modal feels instant */
  document.getElementById('dc-sm-name').textContent   = d.displayName;
  document.getElementById('dc-sm-handle').textContent = '@'+d.username;
  document.getElementById('dc-sm-uid').textContent    = uid;
  document.getElementById('dc-sm-about').textContent  = d.about;

  /* Account created: derived from Discord snowflake — no API call */
  const created = snowflakeToDate(uid);
  document.getElementById('dc-sm-created').textContent = fmtDate(created);

  /* Live fields: show loading placeholders */
  document.getElementById('dc-sm-joined').textContent   = '…';
  document.getElementById('dc-sm-position').textContent = '…';
  document.getElementById('dc-sm-roles').innerHTML      = '<span class="dc-sm-roles-loading">Loading…</span>';

  /* Top-right badges from STAFF_DATA (always visible) */
  document.getElementById('dc-sm-badges').innerHTML = d.roles
    .map(r => `<span class="dc-sm-badge">${escHtml(r)}</span>`).join('');

  /* Avatar: show initial while loading */
  const avEl = document.getElementById('dc-sm-avatar');
  avEl.innerHTML = `<span style="font-family:'Cinzel',serif;font-size:2rem;font-weight:700;color:var(--accent);">${escHtml(d.displayName[0])}</span>`;

  /* Banner: show spinner */
  document.getElementById('dc-sm-banner-loading').style.display  = 'flex';
  document.getElementById('dc-sm-banner-real').style.display     = 'none';
  document.getElementById('dc-sm-banner-fallback').style.display = 'none';

  /* Status dot: copy from card dot so modal matches card instantly */
  const modalDot = document.getElementById('dc-sm-status-dot');
  if(modalDot){
    modalDot.className = 'dc-sm-status-dot';
    const cardDot = document.getElementById('sc-dot-' + id);
    if(cardDot){
      if(cardDot.classList.contains('online')) modalDot.classList.add('online');
      else if(cardDot.classList.contains('idle')) modalDot.classList.add('idle');
      else if(cardDot.classList.contains('dnd'))  modalDot.classList.add('dnd');
    }
  }

  /* Open the modal */
  document.getElementById('dc-modal-ov').classList.add('open');
  document.body.style.overflow = 'hidden';
  setTimeout(() => document.getElementById('dc-staff-modal').scrollTop = 0, 10);
  if(pushHash && !_skipHashPush)
    history.pushState({tab:'staff',modal:id}, null, buildHash('staff',id,null,null));

  /* Fetch live data from Worker */
  const data = await fetchStaffProfile(uid);

  /* ── Worker unavailable / not configured ── */
  if(!data){
    showBannerFallback();
    document.getElementById('dc-sm-joined').textContent   = '—';
    document.getElementById('dc-sm-position').textContent = d.roles[0] || '—';
    const ROLE_CLASS_MAP={founder:'dc-sm-role-founder',admin:'dc-sm-role-admin',mod:'dc-sm-role-mod',trialmod:'dc-sm-role-trialmod',member:'dc-sm-role-member'};
    document.getElementById('dc-sm-roles').innerHTML = d.roles.map((r,i) => {
      const tag = d.roleTags[i] || d.roleTags[0];
      return `<span class="dc-sm-role ${ROLE_CLASS_MAP[tag]||'dc-sm-role-member'}">${escHtml(r)}</span>`;
    }).join('');
    return;
  }

  /* ── Banner ── */
  if(data.bannerUrl){
    const bannerImg = document.getElementById('dc-sm-banner-real');
    bannerImg.onload  = () => {
      document.getElementById('dc-sm-banner-loading').style.display = 'none';
      bannerImg.style.display = 'block';
    };
    bannerImg.onerror = () => showBannerFallback();
    bannerImg.src = data.bannerUrl;
  } else {
    showBannerFallback();
  }

  /* ── Avatar ── */
  if(data.avatarUrl){
    const img = new Image();
    img.crossOrigin = 'anonymous';
    img.onload = () => {
      avEl.innerHTML = '';
      img.style.cssText = 'width:100%;height:100%;object-fit:cover;';
      avEl.appendChild(img);
    };
    img.src = data.avatarUrl;
  }

  /* ── Member data ── */
  if(data.member){
    document.getElementById('dc-sm-joined').textContent =
      data.member.joined_at ? fmtDate(new Date(data.member.joined_at)) : '—';
    document.getElementById('dc-sm-position').textContent = data.position || 'Member';
    document.getElementById('dc-sm-roles').innerHTML =
      buildRolePillsHtml(data.member.roles, data.rolesMap);
  } else {
    document.getElementById('dc-sm-joined').textContent   = 'Not a member of the server.';
    document.getElementById('dc-sm-position').textContent = 'Not a member of the server.';
    document.getElementById('dc-sm-roles').innerHTML =
      '<span class="dc-sm-roles-loading">Not a member of the server.</span>';
  }
}

function closeModal(pushHash=true){ document.getElementById('dc-modal-ov').classList.remove('open'); document.body.style.overflow=''; if(pushHash&&!_skipHashPush)history.pushState({tab:'staff'},null,buildHash('staff',null,null,null)); }
function closeModalOutside(e){ if(e.target===document.getElementById('dc-modal-ov'))closeModal(); }
document.addEventListener('keydown',e=>{ if(e.key==='Escape'){ closeModal(); closeLightbox(); closeArtModal(); } });

/* ════ TOAST ════ */
var toastTimer; // var not let — hoisted so showToast() can safely call it before this line executes
function showToast(msg,type=''){
  const t=document.getElementById('toast');
  t.textContent=msg; t.className='show'+(type?' '+type:'');
  clearTimeout(toastTimer); toastTimer=setTimeout(()=>t.className='',3000);
}

/* ════ HELPERS ════ */
function escHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

/* ════ COMMUNITY STATS ════ */
(function loadCommunityStats(){
  const staffCount=document.querySelectorAll('.sc').length;
  const statStaff=document.getElementById('stat-staff');
  if(statStaff)statStaff.textContent=staffCount||'9';

  // Discord TOTAL member count via widget
  fetch(CFG.WIDGET_API)
    .then(r=>r.json())
    .then(data=>{
      const el=document.getElementById('stat-discord');
      // approximate_member_count = total members (not just online)
      if(el){
        const count=data.approximate_member_count||data.member_count||'—';
        el.textContent=typeof count==='number'?count.toLocaleString():count;
      }
      // Also update theories tab widget
      const ctEl=document.getElementById('dc-online-ct');
      if(ctEl){
        const online=data.presence_count||(data.members||[]).length;
        ctEl.textContent=online+' members online';
      }
    })
    .catch(()=>{ const el=document.getElementById('stat-discord'); if(el)el.textContent='—'; });

  (function(){
    const BASE_CHAPTER=34;
    const BASE_DATE=new Date('2024-03-04T00:00:00+09:00');
    const now=new Date();
    const y=now.getUTCFullYear(), mo=now.getUTCMonth();
    const by=BASE_DATE.getUTCFullYear(), bmo=BASE_DATE.getUTCMonth();
    const monthsDiff=(y-by)*12+(mo-bmo);
    const thisFourth=new Date(Date.UTC(y,mo,4)-9*3600*1000);
    const chapter=BASE_CHAPTER+monthsDiff+(Date.now()>=thisFourth.getTime()?0:-1);
    const el=document.getElementById('stat-chapters');
    if(el)el.textContent=Math.max(chapter,BASE_CHAPTER);
  })();
})();

/* ════ BACK TO TOP ════ */
(function(){
  const btn=document.getElementById('back-to-top');
  window.addEventListener('scroll',()=>{ btn.classList.toggle('visible',window.scrollY>400); },{passive:true});
})();

/* ════ NEWS RENDERING ════ */
const NEWS_DB=[];
const ARTICLE_DB=[];

function renderNewsGrid(){
  const grid=document.getElementById('news-grid');
  const empty=document.getElementById('news-empty');
  if(!grid)return;
  grid.innerHTML='';
  if(!NEWS_DB.length){ if(empty)empty.style.display='block'; return; }
  if(empty)empty.style.display='none';
  const pinned=NEWS_DB.filter(a=>a.pinned);
  const regular=NEWS_DB.filter(a=>!a.pinned);
  pinned.forEach(a=>grid.insertAdjacentHTML('beforeend',renderPinnedCard(a)));
  regular.forEach(a=>grid.insertAdjacentHTML('beforeend',renderNewsCard(a)));
  attachNewsHandlers(grid);
}
function renderArticlesGrid(){
  const grid=document.getElementById('articles-grid');
  const empty=document.getElementById('articles-empty');
  if(!grid)return;
  grid.innerHTML='';
  if(!ARTICLE_DB.length){ if(empty)empty.style.display='block'; return; }
  if(empty)empty.style.display='none';
  ARTICLE_DB.forEach(a=>grid.insertAdjacentHTML('beforeend',renderNewsCard(a,true)));
  attachNewsHandlers(grid);
}
function attachNewsHandlers(grid){
  grid.querySelectorAll('[data-article-id]').forEach(el=>{
    el.addEventListener('click',e=>{
      if(e.target.closest('.ngc-share-btn'))return;
      const id=el.dataset.articleId;
      const art=NEWS_DB.find(a=>a.id===id)||ARTICLE_DB.find(a=>a.id===id);
      if(art)openArtModal(id,art);
    });
  });
  grid.querySelectorAll('.ngc-share-btn').forEach(btn=>btn.addEventListener('click',e=>{ e.stopPropagation(); handleShare(btn); }));
}
function renderPinnedCard(a){
  const shareUrl=encodeURIComponent(window.location.href+'#'+a.id);
  return `<div class="news-pinned" data-article-id="${a.id}" data-cat="${a.cat||''}"><span class="news-pin-badge">📌 PINNED</span><div class="news-pin-img"><div class="news-pin-img-bg" style="background:${a.heroGrad||'linear-gradient(135deg,#3a0505,#C0272D)'};display:flex;align-items:center;justify-content:center;"><span style="font-size:5rem;opacity:.38;">${a.heroEmoji||'📕'}</span></div><div class="news-pin-timer">⏱ ${a.readTime||'5 min'} read</div></div><div class="news-pin-content"><div class="news-pin-badges"><span class="nb nb-featured">${a.badge||'NEWS'}</span></div><div class="news-pin-title">${escHtml(a.title)}</div><div class="news-pin-body">${escHtml(a.excerpt||'')}</div><div class="news-pin-author"><div class="np-av">${a.authorInit||'?'}</div><span>${escHtml(a.author||'Author')}</span><span>· ${a.date||''}</span><div class="np-stats">♡ ${a.likes||0} 💬 ${a.comments||0}</div></div><div style="margin-top:.8rem;"><button class="ngc-read-btn">Read More →</button></div></div></div>`;
}
function renderNewsCard(a){
  const shareUrl=encodeURIComponent(window.location.href+'#'+a.id);
  return `<div class="ngc" data-cat="${a.cat||''}" data-article-id="${a.id}"><div class="ngc-img"><div class="ngc-img-inner" style="background:${a.heroGrad||'linear-gradient(135deg,#1a0505,var(--accent))'};display:flex;align-items:center;justify-content:center;"><span style="font-size:3rem;opacity:.35;">${a.heroEmoji||'📰'}</span></div><span class="ngc-badge" style="background:${a.badgeColor||'var(--accent)'};">${a.badge||'NEWS'}</span><div class="ngc-timer">⏱ ${a.readTime||'5 min'}</div></div><div class="ngc-body"><div class="ngc-meta"><div class="ngc-av">${a.authorInit||'?'}</div><span class="ngc-author">${escHtml(a.author||'Author')}</span><span class="ngc-date">· ${a.date||''}</span></div><div class="ngc-title">${escHtml(a.title)}</div><div class="ngc-excerpt">${escHtml(a.excerpt||'')}</div>${(a.tags||[]).length?`<div class="ngc-tags">${a.tags.map(t=>`<span class="ngc-tag">${escHtml(t)}</span>`).join('')}</div>`:''}<div class="ngc-footer"><span class="ngc-likes">♡ ${a.likes||0} 💬 ${a.comments||0}</span><button class="ngc-read-btn">Read More →</button></div></div></div>`;
}
function handleShare(btn){
  const type=btn.dataset.share;
  const url=btn.dataset.url?decodeURIComponent(btn.dataset.url):window.location.href;
  const title=btn.dataset.title?decodeURIComponent(btn.dataset.title):'Gokurakugai Community';
  if(type==='x')window.open(`https://x.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(url)}`,'_blank','width=600,height=450');
  else if(type==='discord')navigator.clipboard.writeText(url).then(()=>showToast('Link copied — paste it in Discord!')).catch(()=>showToast('Copy failed','err'));
  else if(type==='copy')navigator.clipboard.writeText(url).then(()=>showToast('Link copied!')).catch(()=>showToast('Copy failed','err'));
}
renderNewsGrid();
renderArticlesGrid();

(function(){ const list=document.getElementById('theories-list'); const empty=document.getElementById('theories-empty'); if(list&&empty)empty.style.display=list.children.length===0?'block':'none'; })();

/* ════ ARTICLE MODAL ════ */
function openArtModal(id,data){
  const d=data;
  if(!d)return;
  document.getElementById('am-hero-bg').innerHTML=`<span>${d.heroEmoji||'📰'}</span>`;
  document.getElementById('am-badges').innerHTML=`<span class="nb nb-featured">${d.badge||'NEWS'}</span>`;
  document.getElementById('am-title').textContent=d.title;
  document.getElementById('am-av').textContent=d.authorInit||'?';
  document.getElementById('am-name').textContent=d.author||'Author';
  document.getElementById('am-date').innerHTML=`${d.date||''} &nbsp;·`;
  document.getElementById('am-read').innerHTML=`⏱ ${d.readTime||'5 min read'}`;
  document.getElementById('am-stats').innerHTML=`<span>♡ ${d.likes||0}</span><span>💬 ${Array.isArray(d.commentsData)?d.commentsData.length:(d.comments||0)}</span>`;
  document.getElementById('am-body').innerHTML=d.body||'<p>Full article content coming soon.</p>';
  const comments=d.commentsData||d.comments||[];
  const commentsList=document.getElementById('am-comments-list');
  const commentsTitle=document.getElementById('am-comments-title');
  const commentCount=Array.isArray(comments)?comments.length:(typeof comments==='number'?comments:0);
  commentsTitle.innerHTML=`💬 Comments (${commentCount})`;
  if(Array.isArray(comments)){
    commentsList.innerHTML=comments.map(c=>`<div class="ac"><div class="ac-top"><div class="ac-av">${c.init||'?'}</div><div class="ac-name">${escHtml(c.name||'User')}</div>${c.role?`<span class="ac-role ${c.role==='Staff'?'staff':''}">${c.role}</span>`:''}<div class="ac-date">${c.date||''}</div></div><div class="ac-body">${escHtml(c.body||'')}</div><div class="ac-acts"><button class="ac-act">♡ ${c.likes||0}</button><button class="ac-act">↩ Reply</button></div></div>`).join('');
  }
  const formWrap=document.getElementById('am-comment-form');
  if(dcUser&&isMember){
    formWrap.innerHTML=`<div style="margin-bottom:.6rem;font-family:'Cinzel',serif;font-size:.65rem;letter-spacing:.14em;color:var(--accent);text-transform:uppercase;">Leave a Comment</div><textarea class="art-comment-input" id="am-comment-text" placeholder="Share your thoughts..."></textarea><button class="btn btn-p btn-sm" onclick="submitArtComment('${id}')">Post Comment</button>`;
  }else if(dcUser&&!isMember){
    formWrap.innerHTML=`<div class="art-disc-cta"><p>Join the Discord server to comment.</p><a href="https://discord.gg/gokurakugai" target="_blank" class="btn btn-p">Join Server</a></div>`;
  }else{
    formWrap.innerHTML=`<div class="art-disc-cta"><p>Log in with Discord to join the discussion.</p><button class="btn btn-dc" onclick="dcLogin()">Login with Discord</button></div>`;
  }
  document.querySelectorAll('.art-share-btn').forEach((btn,i)=>{
    btn.onclick=null;
    if(i===0)btn.onclick=()=>window.open(`https://x.com/intent/tweet?text=${encodeURIComponent(d.title)}&url=${encodeURIComponent(window.location.href+'#'+id)}`,'_blank','width=600,height=450');
    if(i===1)btn.onclick=()=>navigator.clipboard.writeText(window.location.href+'#'+id).then(()=>showToast('Link copied — paste it in Discord!'));
    if(i===2)btn.onclick=()=>navigator.clipboard.writeText(window.location.href+'#'+id).then(()=>showToast('Link copied!'));
  });
  document.getElementById('art-modal-ov').classList.add('open');
  document.body.style.overflow='hidden';
  setTimeout(()=>document.getElementById('art-modal-box').scrollTop=0,10);
}
function submitArtComment(articleId){
  if(!dcUser){showToast('Please log in with Discord first.','err');return;}
  if(!isMember){showToast('Server members only. Please join our Discord.','err');return;}
  const text=document.getElementById('am-comment-text').value.trim();
  if(!text){showToast('Please write something.','err');return;}
  const list=document.getElementById('am-comments-list');
  const el=document.createElement('div');
  el.className='ac';
  const avatarHtml=dcUser.avatar?`<img src="https://cdn.discordapp.com/avatars/${dcUser.id}/${dcUser.avatar}.png?size=64" alt="">`:(dcUser.username||'U')[0].toUpperCase();
  el.innerHTML=`<div class="ac-top"><div class="ac-av">${avatarHtml}</div><div class="ac-name">${escHtml(dcUser.username||'You')}</div><div class="ac-date">Just now</div></div><div class="ac-body">${escHtml(text)}</div><div class="ac-acts"><button class="ac-act">♡ 0</button><button class="ac-act">↩ Reply</button></div>`;
  list.appendChild(el);
  document.getElementById('am-comment-text').value='';
  const t=document.getElementById('am-comments-title');
  const num=(t.textContent.match(/\d+/)||[0])[0];
  t.innerHTML=`💬 Comments (${parseInt(num)+1})`;
  showToast('Comment posted!');
}
function closeArtModal(){ document.getElementById('art-modal-ov').classList.remove('open'); document.body.style.overflow=''; }
function closeArtModalOutside(e){ if(e.target===document.getElementById('art-modal-ov'))closeArtModal(); }

/* ════ MOBILE NAV ════ */
(function(){
  const menuBtn=document.getElementById('mob-menu-btn');
  const drawerOv=document.getElementById('mob-drawer-ov');
  const drawer=document.getElementById('mob-drawer');
  if(!menuBtn||!drawer)return;
  function openMobDrawer(){ drawer.classList.add('open'); drawerOv.classList.add('open'); document.body.style.overflow='hidden'; }
  window.closeMobDrawer=function(){ drawer.classList.remove('open'); drawerOv.classList.remove('open'); document.body.style.overflow=''; };
  window.openMobDrawer=openMobDrawer;
  menuBtn.addEventListener('click',openMobDrawer);
  const desktopCtrl=document.querySelector('.nav-ctrl');
  const drawerCtrl=document.getElementById('mob-drawer-ctrl');
  if(desktopCtrl&&drawerCtrl){
    const clone=desktopCtrl.cloneNode(true);
    drawerCtrl.innerHTML=''; drawerCtrl.appendChild(clone);
    const cloneTrack=drawerCtrl.querySelector('.tt-track');
    if(cloneTrack)cloneTrack.addEventListener('click',toggleTheme);
    const cloneLoginBtn=drawerCtrl.querySelector('#dc-login-btn');
    if(cloneLoginBtn)cloneLoginBtn.addEventListener('click',dcLogin);
    const cloneDcBtn=drawerCtrl.querySelector('#dc-btn');
    const cloneDcDd=drawerCtrl.querySelector('#dc-dd');
    if(cloneDcBtn&&cloneDcDd){
      // Always open upward — the ctrl strip is always at the drawer's bottom
      cloneDcDd.classList.add('drop-up');
      cloneDcBtn.addEventListener('click',e=>{
        e.stopPropagation();
        cloneDcDd.classList.toggle('open');
      });
      document.addEventListener('click',()=>{ cloneDcDd.classList.remove('open'); });
    }
    const cloneProfileBtn=drawerCtrl.querySelector('#dc-profile-btn');
    if(cloneProfileBtn){ cloneProfileBtn.addEventListener('click', e=>{ e.stopPropagation(); cloneDcDd&&cloneDcDd.classList.remove('open'); closeMobDrawer(); openProfile(); }); }
    const cloneLogout=drawerCtrl.querySelector('#dc-logout');
    if(cloneLogout){ cloneLogout.addEventListener('click', ()=>{ closeMobDrawer(); doLogout(); }); }
  }
  function syncMobActive(tab){ document.querySelectorAll('.mob-nav-item').forEach(i=>i.classList.toggle('active',i.dataset.tab===tab)); }
  document.querySelectorAll('.mob-nav-item:not(.has-sub)').forEach(item=>{
    item.addEventListener('click',()=>{ const tab=item.dataset.tab; if(!tab)return; syncMobActive(tab); activateTab(tab); closeMobDrawer(); });
  });
  const mangaItem=document.querySelector('.mob-nav-item.has-sub');
  if(mangaItem){ mangaItem.querySelector('.mob-nav-row').addEventListener('click',e=>{ e.stopPropagation(); const sub=document.getElementById('mob-manga-sub'); const isOpen=mangaItem.classList.contains('sub-open'); mangaItem.classList.toggle('sub-open',!isOpen); if(sub)sub.style.display=isOpen?'none':'block'; }); }
  document.querySelectorAll('.mob-sub-item').forEach(si=>{
    si.addEventListener('click',()=>{
      const tab=si.dataset.tab, sub=si.dataset.sub;
      syncMobActive(tab); activateTab(tab); 
      setTimeout(()=>{ document.querySelectorAll('.sn-btn').forEach(b=>b.classList.toggle('active',b.dataset.sub===sub&&b.dataset.parent===tab)); document.querySelectorAll('#manga .subsec').forEach(s=>s.classList.remove('active')); const target=document.getElementById(sub); if(target)target.classList.add('active'); },50);
      closeMobDrawer();
    });
  });
  document.querySelectorAll('a.tab[data-tab],button.tab[data-tab]').forEach(el=>el.addEventListener('click',()=>syncMobActive(el.dataset.tab)));
})();

// Initial gate UI
updateGateUI();
</script>
</body>
</html>
